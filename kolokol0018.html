<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ö–æ–ª–æ–∫–æ–ª—å–Ω—ã–π –∑–≤—É–∫ + –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    body {
      padding: 5px;
      max-width: 800px;
      margin: 0 auto;
      background-color: #b3bcf1;
      font-size: 0.85rem;
    }
    .card {
      box-shadow: 0 4px 6px rgba(0,0,0,0.05);
      background-color: #b3bcf1;
      margin-bottom: 10px;
      border: none;
    }
    .btn-group-custom {
      display: flex;
      gap: 5px;
      flex-wrap: wrap;
    }
    .btn-group-custom .btn {
      flex: 1;
      min-width: 120px;
    }
    .info-text {
      font-size: 0.8rem;
      color: #495057;
    }
    .input-group-custom {
      display: flex;
      gap: 5px;
    }
    .input-group-custom > * {
      flex: 1;
    }
    .form-control {
    transition: 
    background-color 0.3s ease,
    border-color 0.3s ease,
    box-shadow 0.3s ease;
    }
    
    .form-control:focus {
    background-color: #f1f8e9;
    border-color: #4fc3f7;
    box-shadow: 0 0 8px rgba(79, 195, 247, 0.6);
    }
    
    footer {
      margin-top: 20px;
      padding-top: 10px;
      border-top: 1px solid #dee2e6;
      text-align: center;
      font-size: 0.8rem;
      color: #6c757d;
    }
    #chakrasAccordion .accordion-button {
    padding: 0.6rem 0.5rem;
    font-size: 0.9rem;
    }
    .preset-link {
      cursor: pointer;
      color: #0d6efd;
      text-decoration: underline;
    }
    .preset-link:hover {
      text-decoration: none;
    }
    .highlight {
      background-color: #ffecb3 !important;
      box-shadow: 0 0 8px rgba(255, 193, 7, 0.6) !important;
      transition: all 0.5s ease;
    }
    .saved-sets-container {
      margin-top: 20px;
      padding: 15px;
      background-color: #f8f9fa;
      border-radius: 5px;
      border: 1px solid #dee2e6;
    }
    .saved-set-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 10px;
      margin-bottom: 5px;
      background-color: white;
      border-radius: 4px;
      border: 1px solid #dee2e6;
      transition: all 0.3s ease;
    }
    .saved-set-item:hover {
      background-color: #e9ecef;
    }
    .set-name {
      cursor: pointer;
      flex-grow: 1;
    }
    .set-name:hover {
      text-decoration: underline;
      color: #0d6efd;
    }
    .delete-set {
      cursor: pointer;
      color: #dc3545;
      margin-left: 10px;
    }
    .sets-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      gap: 5px;
      flex-wrap: wrap;
    }
    .csv-buttons {
      display: flex;
      gap: 5px;
    }
    .hidden {
      display: none;
    }
    .container {
    max-width: 800px;
    margin-top: 10px;
    margin-bottom: 10px;
    }
    .header {
    text-align: center;
    margin-bottom: 20px;
    padding: 10px;
    background: #fff;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    border: 1px solid #eee;
    }
    .frequencies-list {
    background: #fff;
    padding: 10px;
    border-radius: 10px;
    margin-bottom: 10px;
    text-align: center;
    font-size: 0.9rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    border: 1px solid #eee;
    }
    .accordion {
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    .accordion-item {
    background: #fff;
    border: 1px solid #eee;
    margin-bottom: 8px;
    border-radius: 8px !important;
    transition: all 0.2s ease;
    }
    .accordion-button {
    background: #9fc3;  
    color: #333;
    font-weight: 600;
    font-size: 0.9rem;
    padding: 9px 12px;
    border-radius: 8px !important;
    box-shadow: none !important;
    }
    .accordion-button:not(.collapsed) {
    background: #9fc3f;
    color: #333;
    box-shadow: none;
    }
    .accordion-button:focus {
    box-shadow: none;
    }
    .accordion-button::after {
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%23333'%3e%3cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3e%3c/svg%3e");
    background-size: 0.9rem;
    }
    .accordion-body {
    background: #9fc1;
    padding: 10px;
    border-top: 1px solid #eee;
    color: #444;
    font-size: 0.85rem;
    }
    .chakra-info {
    display: flex;
    align-items: flex-start;
    margin-bottom: 10px;
    }
    .chakra-icon {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 12px;
    font-size: 1rem;
    flex-shrink: 0;
    background: #f0f0f0;
    color: #555;
    }
    .frequency-badge {
    background: #e9ecef;
    padding: 3px 10px;
    border-radius: 15px;
    font-weight: bold;
    margin-right: 8px;
    font-size: 0.9rem;
    color: #495057;
    }
    .footer {
    text-align: center;
    margin-top: 15px;
    font-size: 0.85rem;
    color: #6c757d;
    }
    h1 {
    font-weight: 600;
    font-size: 1.2rem;
    color: #333;
    }
    .subtitle {
    color: #6c757d;
    font-size: 0.95rem;
    }
    .badge {
    font-weight: 500;
    padding: 5px 10px;
    margin: 0 4px;
    border-radius: 12px;
    font-size: 0.9rem;
    }
    .accordion-button:not(.collapsed) .chakra-icon {
    background-color: #e9ecef;
    }
    .accordion-button:not(.collapsed) .frequency-badge {
    background-color: #dee2e6;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –æ—Å—Ü–∏–ª–æ–≥—Ä–∞—Ñ–∞ */
    #oscilloscope {
    width: 100%;
    height: 200px;
    background: #000;
    border-radius: 4px;
    display: block;
    }
    
    .oscilloscope-path {
    stroke: #00ff00;
    stroke-width: 1.5;
    fill: none;
    opacity: 0.9;
    filter: drop-shadow(0 0 2px #00ff00);
    transition: opacity 0.3s ease;
    }
    
    .oscilloscope-grid {
    stroke: #333;
    stroke-width: 0.5;
    fill: none;
    opacity: 0.5;
    }
    
    .oscilloscope-axis {
    stroke: #666;
    stroke-width: 1;
    fill: none;
    opacity: 0.7;
    }
    
    /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –≥—Ä–æ–º–∫–æ—Å—Ç–∏ */
    .volume-indicator {
    margin: 10px 0;
    }
    
    .progress-bar {
    transition: width 0.1s ease;
    }
    
    /* –î–æ–±–∞–≤–∏—Ç—å –≤ —Å—Ç–∏–ª–∏ */
    @keyframes blink {
    0% { opacity: 1; }
    50% { opacity: 0.3; }
    100% { opacity: 1; }
    }
    
    .blink-warning {
    animation: blink 0.8s infinite;
    }
  </style>
</head>
<body>
  <div class="container-fluid p-0">
    <div class="card p-0 mb-2">
      <h5 class="mb-2 mt-2 text-center">üîî –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ö–æ–ª–æ–∫–æ–ª—å–Ω–æ–≥–æ –ó–≤—É–∫–∞</h6>

      <div class="mb-2 mt-1">
        <label class="form-label mb-1"><b>–†–µ–∂–∏–º –∑–≤—É–∫–∞:</b></label>
        <select class="form-select form-select-sm" id="audioMode">
          <option value="stereo">–û–±—ã—á–Ω–æ–µ —Å—Ç–µ—Ä–µ–æ</option>
          <option value="stereo90" selected>–®–∏—Ä–æ–∫–æ–µ —Å—Ç–µ—Ä–µ–æ 90¬∞</option>
        </select>
      </div>

      <div class="mb-2 mt-1">
        <label class="form-label mb-1"><b>–í—ã–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞:</b></label>
        <select class="form-select form-select-sm" id="instrument">
          <option value="bell">–ö–æ–ª–æ–∫–æ–ª</option>
          <option value="bowl">–ß–∞—à–∞</option>
          <option value="smallbell">–ö–æ–ª–æ–∫–æ–ª—å—á–∏–∫</option>
          <option value="custom">–°–≤–æ–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</option>
        </select>
      </div>
      <div class="mb-2">
      	<label class="form-label mb-1"><b>–û—Å–Ω–æ–≤–Ω–∞—è —á–∞—Å—Ç–æ—Ç–∞ (–ì—Ü):</b></label>
      	<input type="number" class="form-control form-control-sm" id="freq" value="174">
      </div>
      
      <div class="input-group-custom mb-2">
      	<div class="mb-2">
      		<label class="form-label mb-1"><small>–í—Ä–µ–º—è –∞—Ç–∞–∫–∏ (—Å):</small></label>
      		<input type="number" class="form-control form-control-sm" id="attack" value="0.01" min="0.001" step="0.001">
      	</div>
      	<div>
      		<label class="form-label mb-1"><small>–ó–≤—É—á–∞–Ω–∏–µ (—Å)</small></label>
      		<input type="number" class="form-control form-control-sm" id="long" value="1.99" min="0" step="0.1">
      	</div>
      	<div>
      		<label class="form-label mb-1"><small>–ó–∞—Ç—É—Ö–∞–Ω–∏–µ (—Å)</small></label>
      		<input type="number" class="form-control form-control-sm" id="release" value="3.5" min="0.001" step="0.1">
      	</div>
      </div>

      <div class="mb-2">
        <label class="form-label mb-1"><b>–û–±–µ—Ä—Ç–æ–Ω–∞ (–º–Ω–æ–∂–∏—Ç–µ–ª—å:–∞–º–ø–ª–∏—Ç—É–¥–∞):</b></label>
        <textarea class="form-control form-control-sm" id="partials" rows="1" style="resize: none; overflow-y: hidden;" oninput="this.style.height='auto'; this.style.height=this.scrollHeight+'px'">1:0.4, 2:1.0, 2.4:0.6, 3:0.3, 4:0.2, 6:0.1, 8:0.05</textarea>
      </div>

      <div class="mb-2">
        <label class="form-label mb-1"><b>–ù–∞–±–æ—Ä —á–∞—Å—Ç–æ—Ç (–ì—Ü, —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é):</b></label>
        <input class="form-control form-control-sm" id="setFrequencies" placeholder="500, 625, 750" value="96; 216; 256; 336; 576">
      </div>

      <div class="mb-2 form-check form-switch">
        <input class="form-check-input" type="checkbox" id="loopSet" checked>
        <label class="form-check-label" for="loopSet">–ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–µ –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–Ω–∏–µ</label>
      </div>

      <div class="input-group-custom mb-2">
        <div>
          <label class="form-label mb-1"><small>–ü–∞—É–∑–∞ –º–µ–∂–¥—É —É–¥–∞—Ä–∞–º–∏ (–º—Å)</small></label>
          <input type="number" class="form-control form-control-sm" id="hitDelay" value="1000">
        </div>
        <div>
          <label class="form-label mb-1"><small>–ü–∞—É–∑–∞ –º–µ–∂–¥—É —Ü–∏–∫–ª–∞–º–∏ (–º—Å)</small></label>
          <input type="number" class="form-control form-control-sm" id="cycleDelay" value="3000">
        </div>
      </div>

      <div class="btn-group-custom mb-2">
        <button id="toggle" class="btn btn-success btn-sm">‚ñ∂Ô∏è –°—Ç–∞—Ä—Ç</button>
        <button id="save" class="btn btn-outline-primary btn-sm">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å WAV</button>
        <button id="playSet" class="btn btn-primary btn-sm">üîî –ü—Ä–æ–∏–≥—Ä–∞—Ç—å –Ω–∞–±–æ—Ä</button>
        <button id="saveSetBtn" class="btn btn-outline-secondary btn-sm">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞–±–æ—Ä</button>
      </div>
      
      <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –≥—Ä–æ–º–∫–æ—Å—Ç–∏ -->
      <div class="volume-indicator">
        <div class="progress" style="height: 5px;">
          <div id="volumeBar" class="progress-bar bg-success" role="progressbar" style="width: 0%"></div>
        </div>
      </div>
    </div>
    
    <div class="card p-3 mt-3">
      <h6 class="text-center">üî¥ –û—Å—Ü–∏–ª–ª–æ–≥—Ä–∞—Ñ (—Ñ–∏–≥—É—Ä—ã –õ–∏—Å—Å–∞–∂—É)</h6>
      <svg id="oscilloscope" width="100%" height="200" style="background: #000; border-radius: 4px;"></svg>
      <div class="text-center mt-2">
        <small class="text-muted">–õ–µ–≤—ã–π –∫–∞–Ω–∞–ª (X) vs –ü—Ä–∞–≤—ã–π –∫–∞–Ω–∞–ª (Y)</small>
      </div>
    </div>

    <div class="card p-3 mt-3">
    <p class="info-text">–ß–∞—Å—Ç–æ—Ç—ã –∑–≤—É–∫–æ–≤ —Ü–µ—Ä–∫–æ–≤–Ω—ã—Ö –∫–æ–ª–æ–∫–æ–ª–æ–≤ –º–æ–≥—É—Ç –≤–∞—Ä—å–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ —à–∏—Ä–æ–∫–∏—Ö –ø—Ä–µ–¥–µ–ª–∞—Ö, –Ω–æ –æ–±—ã—á–Ω–æ –æ–Ω–∏ –ª–µ–∂–∞—Ç –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ –æ—Ç 60 –ì—Ü –¥–æ 2000 –ì—Ü.<br> 
    –ó–≤—É—á–∞–Ω–∏–µ –∫–æ–ª–æ–∫–æ–ª–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –µ–≥–æ —Ä–∞–∑–º–µ—Ä–∞, —Ñ–æ—Ä–º—ã, —Ç–æ–ª—â–∏–Ω—ã —Å—Ç–µ–Ω–æ–∫, –º–∞—Ç–µ—Ä–∏–∞–ª–∞ –∏, –∫–æ–Ω–µ—á–Ω–æ –∂–µ, –æ—Ç —Ç–æ–≥–æ, –∫–∞–∫ –µ–≥–æ —É–¥–∞—Ä—è—é—Ç.</p>
    <p class="info-text">–ß–∞—Å—Ç–æ—Ç–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ç–æ–Ω–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç 60 –ì—Ü –¥–æ 200 –ì—Ü. –ù–∞–ø—Ä–∏–º–µ—Ä, –∫–æ–ª–æ–∫–æ–ª "–°—ã—Å–æ–π" (2000 –ø—É–¥–æ–≤) –∏–º–µ–µ—Ç —á–∞—Å—Ç–æ—Ç—É 131 –ì—Ü, –∞ –∫–æ–ª–æ–∫–æ–ª "–õ–µ–±–µ–¥—å" (500 –ø—É–¥–æ–≤) - 196 –ì—Ü.</p>
    <p class="info-text"><b>–°–æ–≤–µ—Ç:</b> –ü–æ–¥–±–∏—Ä–∞–π—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –∏ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –∑–∞–¥–∞–≤–∞–π—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞, —á—Ç–æ–± –¥–æ–±–∏—Ç—å—Å—è –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ –∑–≤—É–∫–∞. –°—É–º–º–∞ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ –∞–º–ø–ª–∏—Ç—É–¥ –æ–±–µ—Ä—Ç–æ–Ω–æ–≤ –Ω–µ –¥–æ–ª–∂–Ω–∞ –ø—Ä–µ–≤—ã—à–∞—Ç—å 2.7.<br>
    <b>–ü—Ä–∏–º–µ—Ä –æ–±–µ—Ä—Ç–æ–Ω–æ–≤ –¥–ª—è –∫–æ–ª–æ–∫–æ–ª–∞:</b></p>
    <ul>
    <li><a href="#" class="preset-link">–ö–æ–ª–æ–∫–æ–ª —Å –Ω–∏–∑–∫–æ–π —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é</a>: 1.0:1.0, 1.5:0.7, 2.4:0.4, 2.9:0.2, 3.8:0.1</li>
    <li><a href="#" class="preset-link">–¶–µ—Ä–∫–æ–≤–Ω—ã–π –∫–æ–ª–æ–∫–æ–ª</a>: 1.0:0.9, 1.33:1.0, 1.8:0.6, 2.1:0.3, 2.8:0.15</li>
    <li><a href="#" class="preset-link">—Ñ–ª–∞–Ω–¥—Ä–∏–π—Å–∫–∏–π</a>: 1.00:1.0, 1.20:0.8, 1.51:0.5, 2.05:0.3, 2.55:0.2, 3.05:0.1</li>
    <li><a href="#" class="preset-link">–∞–∑–∏–∞—Ç—Å–∫–∏–π, —Ç–æ–Ω–∫–∏–π –±—Ä–æ–Ω–∑–æ–≤—ã–π</a>: 1.00:1.0, 1.25:0.9, 1.68:0.6, 2.30:0.3, 3.00:0.1</li>
    <li><a href="#" class="preset-link">–≤–∞—Ä–∏–∞—Ü–∏—è 1</a>: 1:1, 2.1:0.7, 3.2:0.5, 4.5:0.3, 5.8:0.1, 7:0.03, 11:0.02</li>
    <li><a href="#" class="preset-link">–≤–∞—Ä–∏–∞—Ü–∏—è 2</a>: 1:5, 2:20, 2.4:5, 3:10, 4:40, 4.8:5, 6:5, 8:10</li>
    <li><a href="#" class="preset-link">—Å–º–µ—â—ë–Ω–Ω—ã–π –§–∏–±–æ–Ω–∞—á–∏ 0.618:1:1.618...</a>: <br>1:1, 1.618:0.5, 2.618:0.333, 4.236:0.25, 6.854:0.2, 11.089:0.167, 17.942:0.143, 29.03:0.125, 46.971:0.111, 75.999:0.1</li>
    <li><a href="#" class="preset-link">–ø—Ä—è–º–æ–π –§–∏–±–æ–Ω–∞—á–∏</a>:<br>1.618:1, 2.618:0.5, 4.236:0.333, 6.854:0.25, 11.089:0.2, 17.942:0.167, 29.03:0.143, 46.971:0.125, 75.999:0.111</li>
    <li><a href="#" class="preset-link">–∑–æ–ª–æ—Ç–æ–µ —Å–µ—á–µ–Ω–∏–µ 2:3:5:8...</a>: <br>1:1, 2:0.631, 3:0.43, 5:0.333, 8:0.270, 13:0.2276, 21:0.1965</li>
    <li><a href="#" class="preset-link">–æ–±—Ä–∞—Ç–Ω—ã–π –§–∏–±–æ–Ω–∞—á–∏</a>: <br>1.000:1.000, 1.618:0.618, 2.618:0.382, 4.236:0.236,	6.854:0.146, 11.090:0.090, 17.944:0.056, 29.034:0.034, 46.993:0.021, 76.036:0.013</li>
    </ul>
    <p><b>–ü—Ä–∏–º–µ—Ä –æ–±–µ—Ä—Ç–æ–Ω–æ–≤ –¥–ª—è –ø–æ—é—â–∏—Ö —á–∞—à:</b></p>
    <ul>
    <li><a href="#" class="preset-link">–ú–∞–ª–∞—è –º–µ–¥–Ω–∞—è —á–∞—à–∞</a>: 1: 1.0:1.0, 1.02:0.9, 1.5:0.6, 2.1:0.4, 2.7:0.2, 3.3:0.1</li>
    <li><a href="#" class="preset-link">–ë–æ–ª—å—à–∞—è –±—Ä–æ–Ω–∑–æ–≤–∞—è —á–∞—à–∞</a>: 1.0:1.0, 1.48:0.7, 2.05:0.5, 2.6:0.3, 3.2:0.15</li>
    <li><a href="#" class="preset-link">–≤—ã—Å–æ–∫–∞—è –≤–∏–±—Ä–∞—Ü–∏—è, –ª—ë–≥–∫–∞—è</a>: 1.00:1.0, 1.03:0.85, 1.55:0.6, 2.20:0.4, 2.85:0.2, 3.5:0.05</li>
    <li><a href="#" class="preset-link">—Å—Ç–∞—Ä–∞—è —á–∞—à–∞ —Å –¥–≤–æ–π–Ω–æ–π —á–∞—Å—Ç–æ—Ç–æ–π</a>: 1.00:1.0, 1.01:0.95, 1.50:0.5, 2.02:0.3, 2.98:0.1</li>
    <li><a href="#" class="preset-link">–≤–∞—Ä–∏–∞—Ü–∏—è</a>: 0.6:0.4, 1:1.1, 2.03:0.3, 2.87:0.25, 5.37:0.1, 8.57:0.08, 11.95:0.05, 21.24:0.02, 34:0.017</li>
    </ul>
    
    <p class="info-text"><b>–ü–æ —á–∞—Å—Ç–æ—Ç–∞–º</b> - –Ω–∞ —Å–∞–π—Ç–µ <a href="https://www.planetware.de/octave/" target="_blank">Planetware</a> –ø—Ä–∏–≤–µ–¥—ë–Ω —Å–ø–∏—Å–æ–∫ —á–∞—Å—Ç–æ—Ç –ø–ª–∞–Ω–µ—Ç –Ω–∞—à–µ–π —Å–æ–ª–Ω–µ—á–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã - —ç—Ç–æ –ø–µ—Ä–∏–æ–¥—ã –æ–±—Ä–∞—â–µ–Ω–∏—è –æ–∫—Ç–∞–≤–Ω–æ —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–µ –¥–æ –∑–≤—É–∫–æ–≤–∞–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞.<br>
    –≠—Ç–æ—Ç —Å–ø–∏—Å–æ–∫ —Å–æ–¥–µ—Ä–∂–∏—Ç —á–∞—Å—Ç–æ—Ç—ã –≤ –≥–µ—Ä—Ü–∞—Ö:</p>
    <p><i class="fas fa-wave-square me-2"></i>–ü–ª–∞–Ω–µ—Ç—ã: 
    126.22, 141.27, 221.23, 144.72, 194.18, 210.42, 136.10, 183.58, 147.85, 207.36, 140.64, 211.44, 172.06 –ì—Ü
    </p>
    
    </div>
    
    <div class="container">
    <div class="header">
    <h1><i class="fas fa-music me-2"></i>–ß–∞—Å—Ç–æ—Ç—ã –ß–∞–∫—Ä –í–æ–∑–Ω–µ—Å–µ–Ω–∏—è</h1>
    <p class="subtitle">–¶–µ–ª–∏—Ç–µ–ª—å–Ω—ã–µ –≤–∏–±—Ä–∞—Ü–∏–∏ –¥–ª—è –≥–∞—Ä–º–æ–Ω–∏–∑–∞—Ü–∏–∏ —ç–Ω–µ—Ä–≥–∏–∏</p>
    <p><i class="fas fa-wave-square me-2"></i>–ß–∞—Å—Ç–æ—Ç—ã: 
    174, 285, 396, 417, 528, 639, 741, 852, 963 –ì—Ü
    </p>
    </div>
    
    <div class="accordion" id="chakrasAccordion">
    <!-- –ù—É–ª–µ–≤–∞—è —á–∞–∫—Ä–∞ -->
    <div class="accordion-item">
    <h2 class="accordion-header" id="headingOne">
    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
    <span class="frequency-badge">174 –ì—Ü</span> –ù—É–ª–µ–≤–∞—è —á–∞–∫—Ä–∞
    </button>
    </h2>
    <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#chakrasAccordion">
    <div class="accordion-body">
    <div class="chakra-info">
    <div class="chakra-icon">
    <i class="fas fa-mountain"></i>
    </div>
    <div>
    <h6>–ë–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ —á—É–≤—Å—Ç–≤–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</h6>
    <p class="mb-1">–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –∞–Ω–µ—Å—Ç–µ—Ç–∏–∫: —É–º–µ–Ω—å—à–∞–µ—Ç —Ñ–∏–∑–∏—á–µ—Å–∫—É—é –∏ –¥—É—à–µ–≤–Ω—É—é –±–æ–ª—å, —Å–æ–∑–¥–∞—ë—Ç —á—É–≤—Å—Ç–≤–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏. –ë–∞–∑–æ–≤–∞—è —á–∞—Å—Ç–æ—Ç–∞ –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ —Å–µ–∞–Ω—Å–∞–º.</p>
    </div>
    </div>
    </div>
    </div>
    </div>
    
    <!-- –ú—É–ª–∞–¥—Ö–∞—Ä–∞ -->
    <div class="accordion-item">
    <h2 class="accordion-header" id="headingTwo">
    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
    <span class="frequency-badge">285 –ì—Ü</span> –ú—É–ª–∞–¥—Ö–∞—Ä–∞
    </button>
    </h2>
    <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#chakrasAccordion">
    <div class="accordion-body">
    <div class="chakra-info">
    <div class="chakra-icon">
    <i class="fas fa-seedling"></i>
    </div>
    <div>
    <h6>–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∫–∞–Ω–µ–π –∏ –æ–º–æ–ª–æ–∂–µ–Ω–∏–µ</h6>
    <p class="mb-1">–£—Å–∫–æ—Ä—è–µ—Ç —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∫–ª–µ—Ç–æ–∫, "–ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç" –ø–∞–º—è—Ç—å –ø–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω—ã—Ö –æ—Ä–≥–∞–Ω–æ–≤. –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –æ—Ç —á—É–≤—Å—Ç–≤–∞ –≤–∏–Ω—ã.</p>
    </div>
    </div>
    </div>
    </div>
    </div>
    
    <!-- –°–≤–∞–¥—Ö–∏—Å—Ç–∞–Ω–∞ -->
    <div class="accordion-item">
    <h2 class="accordion-header" id="headingThree">
    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
    <span class="frequency-badge">396 –ì—Ü</span> –°–≤–∞–¥—Ö–∏—Å—Ç–∞–Ω–∞
    </button>
    </h2>
    <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#chakrasAccordion">
    <div class="accordion-body">
    <div class="chakra-info">
    <div class="chakra-icon">
    <i class="fas fa-water"></i>
    </div>
    <div>
    <h6>–°–Ω—è—Ç–∏–µ —Å—Ç—Ä–∞—Ö–æ–≤ –∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–∞–º–º</h6>
    <p class="mb-1">–£—Å—Ç—Ä–∞–Ω—è–µ—Ç –ø–æ–¥—Å–æ–∑–Ω–∞—Ç–µ–ª—å–Ω—ã–µ –±–ª–æ–∫–∏, —Å—Ç—Ä–∞—Ö–∏, –ª–æ–∂–Ω—ã–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏. –ü–æ–º–æ–≥–∞–µ—Ç –ø—Ä–µ–æ–¥–æ–ª–µ—Ç—å —á—É–≤—Å—Ç–≤–æ –≤–∏–Ω—ã –∏ –ø—Ä–∏–≤–ª–µ—á—å —É—Å–ø–µ—Ö.</p>
    </div>
    </div>
    </div>
    </div>
    </div>
    
    <!-- –ú–∞–Ω–∏–ø—É—Ä–∞ -->
    <div class="accordion-item">
    <h2 class="accordion-header" id="headingFour">
    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
    <span class="frequency-badge">417 –ì—Ü</span> –ú–∞–Ω–∏–ø—É—Ä–∞
    </button>
    </h2>
    <div id="collapseFour" class="accordion-collapse collapse" aria-labelledby="headingFour" data-bs-parent="#chakrasAccordion">
    <div class="accordion-body">
    <div class="chakra-info">
    <div class="chakra-icon">
    <i class="fas fa-sun"></i>
    </div>
    <div>
    <h6>–ê–∫—Ç–∏–≤–∞—Ü–∏—è —ç–Ω–µ—Ä–≥–∏–∏ –∏ –∏–Ω–∏—Ü–∏–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ–Ω</h6>
    <p class="mb-1">–°—Ç–∏–º—É–ª–∏—Ä—É–µ—Ç —ç–Ω–µ—Ä–≥–∏—é –¥–ª—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏: –ª–æ–º–∞–µ—Ç —Å—Ç–∞—Ä—ã–µ —à–∞–±–ª–æ–Ω—ã –ø–æ–≤–µ–¥–µ–Ω–∏—è, –æ–±–ª–µ–≥—á–∞–µ—Ç –ø—Ä–∏–Ω—è—Ç–∏–µ –ø–µ—Ä–µ–º–µ–Ω.</p>
    </div>
    </div>
    </div>
    </div>
    </div>
    
    <!-- –ê–Ω–∞—Ö–∞—Ç–∞ -->
    <div class="accordion-item">
    <h2 class="accordion-header" id="headingFive">
    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFive" aria-expanded="false" aria-controls="collapseFive">
    <span class="frequency-badge">528 –ì—Ü</span> –ê–Ω–∞—Ö–∞—Ç–∞
    </button>
    </h2>
    <div id="collapseFive" class="accordion-collapse collapse" aria-labelledby="headingFive" data-bs-parent="#chakrasAccordion">
    <div class="accordion-body">
    <div class="chakra-info">
    <div class="chakra-icon">
    <i class="fas fa-heart"></i>
    </div>
    <div>
    <h6>–ò—Å—Ü–µ–ª–µ–Ω–∏–µ –î–ù–ö –∏ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏–µ –ª—é–±–≤–∏</h6>
    <p class="mb-1">–ö–ª—é—á–µ–≤–∞—è "—á–∞—Å—Ç–æ—Ç–∞ –î–ù–ö": –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω–æ–π –î–ù–ö. –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ –∏ –ª—é–±–æ–≤—å.</p>
    </div>
    </div>
    </div>
    </div>
    </div>
    
    <!-- –í–∏—à—É–¥–¥—Ö–∞ -->
    <div class="accordion-item">
    <h2 class="accordion-header" id="headingSix">
    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSix" aria-expanded="false" aria-controls="collapseSix">
    <span class="frequency-badge">639 –ì—Ü</span> –í–∏—à—É–¥–¥—Ö–∞
    </button>
    </h2>
    <div id="collapseSix" class="accordion-collapse collapse" aria-labelledby="headingSix" data-bs-parent="#chakrasAccordion">
    <div class="accordion-body">
    <div class="chakra-info">
    <div class="chakra-icon">
    <i class="fas fa-comments"></i>
    </div>
    <div>
    <h6>–ì–∞—Ä–º–æ–Ω–∏–∑–∞—Ü–∏—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π –∏ –±–µ–∑—É—Å–ª–æ–≤–Ω–∞—è –ª—é–±–æ–≤—å</h6>
    <p class="mb-1">–ì–∞—Ä–º–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –æ—Ç–Ω–æ—à–µ–Ω–∏—è, —Ä–∞–∑–≤–∏–≤–∞–µ—Ç —ç–º–ø–∞—Ç–∏—é –∏ —Ç–µ—Ä–ø–∏–º–æ—Å—Ç—å. –ü–æ–º–æ–≥–∞–µ—Ç –≤ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–∏ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–≤—è–∑–µ–π.</p>
    </div>
    </div>
    </div>
    </div>
    </div>
    
    <!-- –ê–¥–∂–Ω–∞ -->
    <div class="accordion-item">
    <h2 class="accordion-header" id="headingSeven">
    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSeven" aria-expanded="false" aria-controls="collapseSeven">
    <span class="frequency-badge">741 –ì—Ü</span> –ê–¥–∂–Ω–∞
    </button>
    </h2>
    <div id="collapseSeven" class="accordion-collapse collapse" aria-labelledby="headingSeven" data-bs-parent="#chakrasAccordion">
    <div class="accordion-body">
    <div class="chakra-info">
    <div class="chakra-icon">
    <i class="fas fa-eye"></i>
    </div>
    <div>
    <h6>–û—á–∏—â–µ–Ω–∏–µ –∏ —Ä–∞—Å–∫—Ä—ã—Ç–∏–µ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è</h6>
    <p class="mb-1">–û—á–∏—â–∞–µ—Ç –æ—Ä–≥–∞–Ω–∏–∑–º –æ—Ç —Ç–æ–∫—Å–∏–Ω–æ–≤ –∏ –º–µ–Ω—Ç–∞–ª—å–Ω—ã—Ö "–ø–∞—Ä–∞–∑–∏—Ç–æ–≤". –£—Å–∏–ª–∏–≤–∞–µ—Ç –∏–Ω—Ç—É–∏—Ü–∏—é, –ø–æ–º–æ–≥–∞–µ—Ç –Ω–∞–π—Ç–∏ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ.</p>
    </div>
    </div>
    </div>
    </div>
    </div>
    
    <!-- –°–∞—Ö–∞—Å—Ä–∞—Ä–∞ -->
    <div class="accordion-item">
    <h2 class="accordion-header" id="headingEight">
    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseEight" aria-expanded="false" aria-controls="collapseEight">
    <span class="frequency-badge">852 –ì—Ü</span> –°–∞—Ö–∞—Å—Ä–∞—Ä–∞
    </button>
    </h2>
    <div id="collapseEight" class="accordion-collapse collapse" aria-labelledby="headingEight" data-bs-parent="#chakrasAccordion">
    <div class="accordion-body">
    <div class="chakra-info">
    <div class="chakra-icon">
    <i class="fas fa-crown"></i>
    </div>
    <div>
    <h6>–ê–∫—Ç–∏–≤–∞—Ü–∏—è –∏–Ω—Ç—É–∏—Ü–∏–∏ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–≤—è–∑–µ–π</h6>
    <p class="mb-1">–ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –≤—ã—Å—à–∏–µ –ø—Å–∏—Ö–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏: —è—Å–Ω–æ–≤–∏–¥–µ–Ω–∏–µ, –∏–Ω—Ç—É–∏—Ü–∏—é. –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –Ω–µ–π—Ä–æ–Ω–Ω—ã–µ —Å–≤—è–∑–∏.</p>
    </div>
    </div>
    </div>
    </div>
    </div>
    
    <!-- –ù–∞–¥–∫–æ—Ä–æ–Ω–Ω–∞—è -->
    <div class="accordion-item">
    <h2 class="accordion-header" id="headingNine">
    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseNine" aria-expanded="false" aria-controls="collapseNine">
    <span class="frequency-badge">963 –ì—Ü</span> –ù–∞–¥–∫–æ—Ä–æ–Ω–Ω–∞—è —á–∞–∫—Ä–∞
    </button>
    </h2>
    <div id="collapseNine" class="accordion-collapse collapse" aria-labelledby="headingNine" data-bs-parent="#chakrasAccordion">
    <div class="accordion-body">
    <div class="chakra-info">
    <div class="chakra-icon">
    <i class="fas fa-star"></i>
    </div>
    <div>
    <h6>–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –≤—ã—Å—à–∏–º —Å–æ–∑–Ω–∞–Ω–∏–µ–º</h6>
    <p class="mb-1">–û—Ç–∫—Ä—ã–≤–∞–µ—Ç –∫–∞–Ω–∞–ª —Å–≤—è–∑–∏ —Å –≤—ã—Å—à–∏–º–∏ —Å–∏–ª–∞–º–∏, —Å—Ç–∏—Ä–∞–µ—Ç –≥—Ä–∞–Ω–∏—Ü—ã –º–µ–∂–¥—É –ª–∏—á–Ω–æ—Å—Ç—å—é –∏ –∫–æ—Å–º–æ—Å–æ–º.</p>
    </div>
    </div>
    </div>
    </div>
    </div>
    </div>
    
    <div class="footer">
    <p>–î–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–µ —á–∞—Å—Ç–æ—Ç –≤ –Ω–∞—É—à–Ω–∏–∫–∞—Ö –ø–æ 15-30 –º–∏–Ω—É—Ç –≤ –¥–µ–Ω—å</p>
    </div>
    </div>
    
    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –Ω–∞–±–æ—Ä–æ–≤ -->
    <div class="saved-sets-container">
    <div class="sets-header">
    <h5>–°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –Ω–∞–±–æ—Ä—ã —á–∞—Å—Ç–æ—Ç</h5>
    <div class="csv-buttons btn-group-custom mb-2">       
    <button id="clearSets" class="btn btn-sm btn-outline-danger">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ</button>
    <button id="exportCSV" class="btn btn-sm btn-outline-success">–≠–∫—Å–ø–æ—Ä—Ç CSV</button>
    <button id="importCSV" class="btn btn-sm btn-outline-info">–ò–º–ø–æ—Ä—Ç CSV</button>
    </div>
    </div>
    <div id="savedSetsList"></div>
    <input type="file" id="csvFileInput" class="hidden" accept=".csv">
    </div>
    
    <div class="text-center mb-2">
    <a href="http://www.mif-ua.com/m/archive/article/51055" target="_blank">–ü—Ä–æ –∫–æ–ª–æ–∫–æ–ª–∞</a><br>
    <a href="https://meweryk.github.io/midi/calc_music.html">–ê–Ω–∞–ª–∏–∑ –º—É–∑—ã–∫–∞–ª—å–Ω–æ–≥–æ —Å—Ç—Ä–æ—è —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π</a><br>
    <a href="https://meweryk.github.io/midi/index.html">–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —á–∞—Å—Ç–æ—Ç</a><br>
    <a href="https://meweryk.github.io/Wave-of-land/index.html" target="_blank">–î—Ä—É–≥–∏–µ –ø—Ä–æ–µ–∫—Ç—ã</a>
    </div>
    <div class="text-center">
    <p class="mb-0">¬© –ê–≤—Ç–æ—Ä</p>
    </div>
    
    </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞–±–æ—Ä–∞ -->
  <div class="modal fade" id="saveSetModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞–±–æ—Ä —á–∞—Å—Ç–æ—Ç</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="setNameInput" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–∞–±–æ—Ä–∞:</label>
            <input type="text" class="form-control" id="setNameInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ">
          </div>
          <div class="mb-3">
            <label class="form-label">–ß–∞—Å—Ç–æ—Ç—ã:</label>
            <div id="setFrequenciesPreview" class="form-control" style="height: auto; min-height: 38px;"></div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
          <button type="button" class="btn btn-primary" id="confirmSaveSet">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  	
  <script>
    // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
    const MAX_FREQUENCIES = 100;
    const MAX_PARTIALS = 15;
    const MAX_REPEATS = 20;
    const MAX_DURATION = 600;
    const VOLUME_MULTIPLIER = 0.9; // –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π –º–Ω–æ–∂–∏—Ç–µ–ª—å –≥—Ä–æ–º–∫–æ—Å—Ç–∏

    const instrumentPresets = {
      bell: '1:0.4, 2:1.0, 2.4:0.6, 3:0.3, 4:0.2, 6:0.1, 8:0.05',
      bowl: '0.6:0.4, 1:1.1, 2.03:0.3, 2.87:0.25, 5.37:0.1, 8.57:0.08, 11.95:0.05, 21.24:0.02',
      smallbell: '1:1.0, 2:0.6, 3:0.3, 4:0.1',
    };

    const presetValues = {
      "–ö–æ–ª–æ–∫–æ–ª —Å –Ω–∏–∑–∫–æ–π —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é": "1.0:1.0, 1.5:0.7, 2.4:0.4, 2.9:0.2, 3.8:0.1",
      "–¶–µ—Ä–∫–æ–≤–Ω—ã–π –∫–æ–ª–æ–∫–æ–ª": "1.0:0.9, 1.33:1.0, 1.8:0.6, 2.1:0.3, 2.8:0.15",
      "—Ñ–ª–∞–Ω–¥—Ä–∏–π—Å–∫–∏–π": "1.00:1.0, 1.20:0.8, 1.51:0.5, 2.05:0.3, 2.55:0.2, 3.05:0.1",
      "–∞–∑–∏–∞—Ç—Å–∫–∏–π, —Ç–æ–Ω–∫–∏–π –±—Ä–æ–Ω–∑–æ–≤—ã–π": "1.00:1.0, 1.25:0.9, 1.68:0.6, 2.30:0.3, 3.00:0.1",
      "–≤–∞—Ä–∏–∞—Ü–∏—è 1": "1:1, 2.1:0.7, 3.2:0.5, 4.5:0.3, 5.8:0.1, 7:0.03, 11:0.02",
      "–≤–∞—Ä–∏–∞—Ü–∏—è 2": "1:5, 2:20, 2.4:5, 3:10, 4:40, 4.8:5, 6:5, 8:10",
      "—Å–º–µ—â—ë–Ω–Ω—ã–π –§–∏–±–æ–Ω–∞—á–∏ 0.618:1:1.618...": "1:1, 1.618:0.5, 2.618:0.333, 4.236:0.25, 6.854:0.2, 11.089:0.167, 17.942:0.143, 29.03:0.125, 46.971:0.111, 75.999:0.1",
      "–ø—Ä—è–º–æ–π –§–∏–±–æ–Ω–∞—á–∏": "1.618:1, 2.618:0.5, 4.236:0.333, 6.854:0.25, 11.089:0.2, 17.942:0.167, 29.03:0.143, 46.971:0.125, 75.999:0.111",
      "–∑–æ–ª–æ—Ç–æ–µ —Å–µ—á–µ–Ω–∏–µ 2:3:5:8...": "1:1, 2:0.631, 3:0.43, 5:0.333, 8:0.270, 13:0.2276, 21:0.1965",
      "–æ–±—Ä–∞—Ç–Ω—ã–π –§–∏–±–æ–Ω–∞—á–∏": "1.000:1.000, 1.618:0.618, 2.618:0.382, 4.236:0.236, 6.854:0.146, 11.090:0.090, 17.944:0.056, 29.034:0.034, 46.993:0.021, 76.036:0.013",
      "–ú–∞–ª–∞—è –º–µ–¥–Ω–∞—è —á–∞—à–∞": "1:1.0, 1.02:0.9, 1.5:0.6, 2.1:0.4, 2.7:0.2, 3.3:0.1",
      "–ë–æ–ª—å—à–∞—è –±—Ä–æ–Ω–∑–æ–≤–∞—è —á–∞—à–∞": "1.0:1.0, 1.48:0.7, 2.05:0.5, 2.6:0.3, 3.2:0.15",
      "–≤—ã—Å–æ–∫–∞—è –≤–∏–±—Ä–∞—Ü–∏—è, –ª—ë–≥–∫–∞—è": "1.00:1.0, 1.03:0.85, 1.55:0.6, 2.20:0.4, 2.85:0.2, 3.5:0.05",
      "—Å—Ç–∞—Ä–∞—è —á–∞—à–∞ —Å –¥–≤–æ–π–Ω–æ–π —á–∞—Å—Ç–æ—Ç–æ–π": "1.00:1.0, 1.01:0.95, 1.50:0.5, 2.02:0.3, 2.98:0.1",
      "–≤–∞—Ä–∏–∞—Ü–∏—è": "0.6:0.4, 1:1.1, 2.03:0.3, 2.87:0.25, 5.37:0.1, 8.57:0.08, 11.95:0.05, 21.24:0.02, 34:0.017"
    };

    // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
    const instrumentSelect = document.getElementById('instrument');
    const freqInput = document.getElementById('freq');
    const partialsInput = document.getElementById('partials');
    const toggleBtn = document.getElementById('toggle');
    const saveBtn = document.getElementById('save');
    const playSetBtn = document.getElementById('playSet');
    const setFreqsInput = document.getElementById('setFrequencies');
    const loopCheckbox = document.getElementById('loopSet');
    const hitDelayInput = document.getElementById('hitDelay');
    const cycleDelayInput = document.getElementById('cycleDelay');
    const volumeBar = document.getElementById('volumeBar');

    // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –∞—É–¥–∏–æ –∏ –æ—Å—Ü–∏–ª–ª–æ–≥—Ä–∞—Ñ–∞
    let audioCtx;
    let analyserLeft, analyserRight;
    let dataArrayLeft, dataArrayRight;
    let bufferLength;
    let oscilloscopeSvg;
    let oscilloscopePath;
    let isPlaying = false;
    let isPlayingSet = false;

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ—Å—Ü–∏–ª–ª–æ–≥—Ä–∞—Ñ–∞
    function initOscilloscope() {
        oscilloscopeSvg = document.getElementById('oscilloscope');
        if (!oscilloscopeSvg) return;
        
        oscilloscopeSvg.innerHTML = '';
        
        const width = oscilloscopeSvg.clientWidth || 800;
        const height = 200;
        
        // –°–æ–∑–¥–∞–µ–º —Å–µ—Ç–∫—É
        const grid = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        grid.setAttribute('class', 'oscilloscope-grid');
        
        let gridPath = '';
        
        // –£–í–ï–õ–ò–ß–ò–í–ê–ï–ú —Å–µ—Ç–∫—É –¥–ª—è –±–æ–ª—å—à–µ–≥–æ –º–∞—Å—à—Ç–∞–±–∞
        const cellSize = Math.min(width, height) / 4;
        
        for (let i = 1; i <= 3; i++) {
            const posX = (width / 2) + (i - 2) * cellSize;
            const posY = (height / 2) + (i - 2) * cellSize;
            
            // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏
            gridPath += `M ${posX} 0 V ${height} `;
            // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏
            gridPath += `M 0 ${posY} H ${width} `;
        }
        
        grid.setAttribute('d', gridPath);
        
        // –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–µ –æ—Å–∏
        const axisX = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        axisX.setAttribute('class', 'oscilloscope-axis');
        axisX.setAttribute('d', `M ${width/2} 0 V ${height}`);
        
        const axisY = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        axisY.setAttribute('class', 'oscilloscope-axis');
        axisY.setAttribute('d', `M 0 ${height/2} H ${width}`);
        
        oscilloscopeSvg.appendChild(grid);
        oscilloscopeSvg.appendChild(axisX);
        oscilloscopeSvg.appendChild(axisY);
        
        // –°–æ–∑–¥–∞–µ–º –ø—É—Ç—å –¥–ª—è —Ñ–∏–≥—É—Ä—ã –õ–∏—Å—Å–∞–∂—É
        oscilloscopePath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        oscilloscopePath.setAttribute('class', 'oscilloscope-path');
        oscilloscopeSvg.appendChild(oscilloscopePath);
    }

    // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Å—Ü–∏–ª–ª–æ–≥—Ä–∞—Ñ–∞
    function updateOscilloscope() {
        if (!analyserLeft || !analyserRight) return;
        
        requestAnimationFrame(updateOscilloscope);
        
        analyserLeft.getByteTimeDomainData(dataArrayLeft);
        analyserRight.getByteTimeDomainData(dataArrayRight);
        
        const width = oscilloscopeSvg.clientWidth || 800;
        const height = 200;
        const centerX = width / 2;
        const centerY = height / 2;
        
        // –£–ú–ï–ù–¨–®–ê–ï–ú –º–∞—Å—à—Ç–∞–± –¥–æ 60% (–±—ã–ª–æ 90%)
        const scale = Math.min(width, height) * 0.45; // –£–º–µ–Ω—å—à–µ–Ω–æ —Å 0.45 –¥–æ 0.3
        
        let pathData = '';
        const step = Math.max(1, Math.floor(bufferLength / 400));
        
        for (let i = 0; i < bufferLength; i += step) {
            const x = (dataArrayLeft[i] / 128.0 - 1.0);
            const y = (dataArrayRight[i] / 128.0 - 1.0);
            
            const screenX = centerX + x * scale;
            const screenY = centerY + y * scale;
            
            if (i === 0) {
                pathData += `M ${screenX} ${screenY} `;
            } else {
                pathData += `L ${screenX} ${screenY} `;
            }
        }
        
        oscilloscopePath.setAttribute('d', pathData);
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –≥—Ä–æ–º–∫–æ—Å—Ç–∏
        updateVolumeIndicator();
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –≥—Ä–æ–º–∫–æ—Å—Ç–∏ - –° –ó–ê–©–ò–¢–û–ô –û–¢ –ö–õ–ò–ü–ü–ò–ù–ì–ê
    function updateVolumeIndicator() {
    if (!analyserLeft || !volumeBar) return;
    
    const timeData = new Uint8Array(bufferLength);
    analyserLeft.getByteTimeDomainData(timeData);
    
    let peak = 0;
    let sumSquares = 0;
    
    for (let i = 0; i < bufferLength; i++) {
    const amplitude = (timeData[i] - 128) / 128;
    const absAmplitude = Math.abs(amplitude);
    
    if (absAmplitude > peak) peak = absAmplitude;
    sumSquares += amplitude * amplitude;
    }
    
    const rms = Math.sqrt(sumSquares / bufferLength);
    
    // –û–°–ù–û–í–ù–û–ô –ê–õ–ì–û–†–ò–¢–ú: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–∏—Å–∫ –∫–ª–∏–ø–ø–∏–Ω–≥–∞
    let volumePercent;
    let isClipping = false;
    
    if (peak > 0.99) {
    // –ö–õ–ò–ü–ü–ò–ù–ì - —Å–∏–≥–Ω–∞–ª –æ–±—Ä–µ–∑–∞–µ—Ç—Å—è
    volumePercent = 100;
    isClipping = true;
    } else if (peak > 0.9) {
    // –û–ü–ê–°–ù–ê–Ø –ó–û–ù–ê - –≤–æ—Ç-–≤–æ—Ç –±—É–¥–µ—Ç –∫–ª–∏–ø–ø–∏–Ω–≥
    volumePercent = 90 + (peak - 0.9) * 100; // 90-100%
    } else if (peak > 0.7) {
    // –í–´–°–û–ö–ê–Ø –≥—Ä–æ–º–∫–æ—Å—Ç—å
    volumePercent = 70 + (peak - 0.7) * 100; // 70-90%
    } else if (peak > 0.3) {
    // –°–†–ï–î–ù–Ø–Ø –≥—Ä–æ–º–∫–æ—Å—Ç—å  
    volumePercent = 30 + (peak - 0.3) * 100; // 30-70%
    } else {
    // –ù–ò–ó–ö–ê–Ø –≥—Ä–æ–º–∫–æ—Å—Ç—å
    volumePercent = peak * 100; // 0-30%
    }
    
    volumePercent = Math.min(100, volumePercent);
    
    // –û–ë–ù–û–í–õ–ï–ù–ò–ï –ò–ù–î–ò–ö–ê–¢–û–†–ê
    volumeBar.style.width = `${volumePercent}%`;
    
    if (isClipping) {
    volumeBar.className = 'progress-bar bg-danger';
    volumeBar.style.background = 'linear-gradient(90deg, #ff0000, #cc0000)';
    volumeBar.innerHTML = 'üî¥';
    
    // –ú–∏–≥–∞–Ω–∏–µ –ø—Ä–∏ –∫–ª–∏–ø–ø–∏–Ω–≥–µ
    volumeBar.style.animation = volumeBar.style.animation ? '' : 'blink 0.5s infinite';
    } else if (volumePercent > 90) {
    volumeBar.className = 'progress-bar bg-warning';
    volumeBar.style.background = 'linear-gradient(90deg, #ff8800, #ff6600)';
    volumeBar.innerHTML = 'üü°';
    volumeBar.style.animation = '';
    } else if (volumePercent > 70) {
    volumeBar.className = 'progress-bar bg-success';
    volumeBar.style.background = 'linear-gradient(90deg, #44ff44, #00cc00)';
    volumeBar.innerHTML = 'üü¢';
    volumeBar.style.animation = '';
    } else if (volumePercent > 30) {
    volumeBar.className = 'progress-bar bg-info';
    volumeBar.style.background = 'linear-gradient(90deg, #4488ff, #0066cc)';
    volumeBar.innerHTML = 'üîµ';
    volumeBar.style.animation = '';
    } else {
    volumeBar.className = 'progress-bar bg-secondary';
    volumeBar.style.background = 'linear-gradient(90deg, #888888, #666666)';
    volumeBar.innerHTML = '‚ö´ ';
    volumeBar.style.animation = '';
    }
    
    // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –≤ –∫–æ–Ω—Å–æ–ª—å –ø—Ä–∏ –∫–ª–∏–ø–ø–∏–Ω–≥–µ
    if (isClipping) {
    console.error(`üö® –ö–õ–ò–ü–ü–ò–ù–ì! Peak: ${peak.toFixed(3)}`);
    } else if (peak > 0.95) {
    console.warn(`‚ö†Ô∏è –û–ü–ê–°–ù–û–°–¢–¨ –ö–õ–ò–ü–ü–ò–ù–ì–ê! Peak: ${peak.toFixed(3)}`);
    }
    }

    // –û—á–∏—Å—Ç–∫–∞ –æ—Å—Ü–∏–ª–ª–æ–≥—Ä–∞—Ñ–∞
    function stopOscilloscope() {
        if (oscilloscopePath) {
            oscilloscopePath.setAttribute('d', '');
        }
        if (volumeBar) {
            volumeBar.style.width = '0%';
            volumeBar.className = 'progress-bar bg-success';
        }
    }

    // –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∞–º–ø–ª–∏—Ç—É–¥
    function normalizePartials(partials) {
        if (!partials || partials.length === 0) return [];
        
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–≤–∞–¥—Ä–∞—Ç—ã –∞–º–ø–ª–∏—Ç—É–¥ –¥–ª—è —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–æ–π –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏
        const totalEnergy = partials.reduce((sum, p) => sum + Math.pow(p.amp, 2), 0);
        const rms = Math.sqrt(totalEnergy);
        
        if (rms === 0) return partials;
        
        const normalized = partials.map(p => ({
            ratio: p.ratio,
            amp: Math.round((p.amp / rms) * 10000) / 10000
        }));
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É–º–º—ã –∞–º–ø–ª–∏—Ç—É–¥
        const sumAmplitudes = normalized.reduce((sum, p) => sum + p.amp, 0);
        console.log(`–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è: RMS=${rms.toFixed(4)}, –°—É–º–º–∞ –∞–º–ø–ª–∏—Ç—É–¥=${sumAmplitudes.toFixed(4)}`);
        
        return normalized;
    }

    function parsePartials(inputText) {
        return inputText.split(',').map(p => {
            const [r, a] = p.trim().split(':').map(Number);
            return (!isNaN(r) && !isNaN(a)) ? { ratio: r, amp: a } : null;
        }).filter(Boolean);
    }

    function createImpulseResponse(ctx, duration = 3, decay = 2) {
        const len = ctx.sampleRate * duration;
        const buffer = ctx.createBuffer(2, len, ctx.sampleRate);
        for (let ch = 0; ch < 2; ch++) {
            const data = buffer.getChannelData(ch);
            for (let i = 0; i < len; i++) {
                data[i] = (Math.random() * 2 - 1) * Math.pow(1 - i / len, decay);
            }
        }
        return buffer;
    }

    // –®–∏—Ä–æ–∫–æ–ø–æ–ª–æ—Å–Ω–æ–µ —Å—Ç–µ—Ä–µ–æ —Å–æ —Å–¥–≤–∏–≥–æ–º —Ñ–∞–∑—ã 90¬∞ - –ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ï
    function createStereo90Bell(f0, partial, index, total, startTime, attack, sustain, release, convolver, nodeList) {
        const oscLeft = audioCtx.createOscillator();
        const gainLeft = audioCtx.createGain();
        const oscRight = audioCtx.createOscillator();
        const gainRight = audioCtx.createGain();
        
        oscLeft.type = 'sine';
        oscRight.type = 'sine';
        
        const baseFreq = f0 * partial.ratio + (Math.random() * 2 - 1);
        oscLeft.frequency.value = baseFreq;
        oscRight.frequency.value = baseFreq;
        
        const vibrato = audioCtx.createOscillator();
        const vibratoGain = audioCtx.createGain();
        vibrato.frequency.value = 5 + Math.random() * 2;
        vibratoGain.gain.value = 1 + Math.random();
        
        vibrato.connect(vibratoGain);
        vibratoGain.connect(oscLeft.frequency);
        vibratoGain.connect(oscRight.frequency);
        
        const endTime = startTime + attack + sustain + release;
        const fadeOutTime = 0.2; // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –∑–∞—Ç—É—Ö–∞–Ω–∏—è
        
        // –õ–µ–≤—ã–π –∫–∞–Ω–∞–ª - –ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ï –ó–ê–¢–£–•–ê–ù–ò–ï
        gainLeft.gain.setValueAtTime(0, startTime);
        gainLeft.gain.linearRampToValueAtTime(partial.amp * VOLUME_MULTIPLIER, startTime + attack);
        if (sustain > 0) {
            gainLeft.gain.setValueAtTime(partial.amp * VOLUME_MULTIPLIER, startTime + attack + sustain);
        }
        // –≠–ö–°–ü–û–ù–ï–ù–¶–ò–ê–õ–¨–ù–û–ï –∑–∞—Ç—É—Ö–∞–Ω–∏–µ –≤–º–µ—Å—Ç–æ –ª–∏–Ω–µ–π–Ω–æ–≥–æ
        gainLeft.gain.exponentialRampToValueAtTime(0.001, endTime + fadeOutTime);
        
        // –ü—Ä–∞–≤—ã–π –∫–∞–Ω–∞–ª - –ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ï –ó–ê–¢–£–•–ê–ù–ò–ï
        gainRight.gain.setValueAtTime(0, startTime);
        gainRight.gain.linearRampToValueAtTime(partial.amp * VOLUME_MULTIPLIER, startTime + attack);
        if (sustain > 0) {
            gainRight.gain.setValueAtTime(partial.amp * VOLUME_MULTIPLIER, startTime + attack + sustain);
        }
        gainRight.gain.exponentialRampToValueAtTime(0.001, endTime + fadeOutTime);
        
        const phaseShiftTime = 1 / (4 * baseFreq);
        
        oscLeft.connect(gainLeft);
        oscRight.connect(gainRight);
        
        const merger = audioCtx.createChannelMerger(2);
        gainLeft.connect(merger, 0, 0);
        gainRight.connect(merger, 0, 1);
        merger.connect(convolver);
        
        oscLeft.start(startTime);
        oscRight.start(startTime + phaseShiftTime);
        vibrato.start(startTime);
        
        // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –≤—Ä–µ–º—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –∑–∞—Ç—É—Ö–∞–Ω–∏—è
        oscLeft.stop(endTime + fadeOutTime + 0.1);
        oscRight.stop(endTime + fadeOutTime + 0.1 + phaseShiftTime);
        vibrato.stop(endTime + fadeOutTime + 0.1);
        
        nodeList.push(oscLeft, oscRight, gainLeft, gainRight, vibrato, vibratoGain, merger);
    }

    // –û–±—ã—á–Ω–æ–µ —Å—Ç–µ—Ä–µ–æ - –ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ï
    function createStereoBell(f0, partial, index, total, startTime, attack, sustain, release, convolver, nodeList) {
        const panPosition = (index / total) * 2 - 1;
        
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        const panner = audioCtx.createStereoPanner();
        
        osc.type = 'sine';
        osc.frequency.value = f0 * partial.ratio + (Math.random() * 2 - 1);
        panner.pan.value = panPosition;
        
        const vibrato = audioCtx.createOscillator();
        const vibratoGain = audioCtx.createGain();
        vibrato.frequency.value = 5 + Math.random() * 2;
        vibratoGain.gain.value = 1 + Math.random();
        
        vibrato.connect(vibratoGain).connect(osc.frequency);
        
        const endTime = startTime + attack + sustain + release;
        const fadeOutTime = 0.2;
        
        // –ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ï –ó–ê–¢–£–•–ê–ù–ò–ï
        gain.gain.setValueAtTime(0, startTime);
        gain.gain.linearRampToValueAtTime(partial.amp * VOLUME_MULTIPLIER, startTime + attack);
        if (sustain > 0) {
            gain.gain.setValueAtTime(partial.amp * VOLUME_MULTIPLIER, startTime + attack + sustain);
        }
        gain.gain.exponentialRampToValueAtTime(0.001, endTime + fadeOutTime);
        
        osc.connect(gain).connect(panner).connect(convolver);
        osc.start(startTime);
        osc.stop(endTime + fadeOutTime + 0.1);
        vibrato.start(startTime);
        vibrato.stop(endTime + fadeOutTime + 0.1);
        
        nodeList.push(osc, gain, panner, vibrato, vibratoGain);
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∑–≤—É–∫–∞ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
    function startBell(f0, partials) {
        return new Promise((resolve, reject) => {
            try {
                const attackTime = parseFloat(document.getElementById('attack').value) || 0.01;
                const sustainTime = parseFloat(document.getElementById('long').value) || 0;
                const releaseTime = parseFloat(document.getElementById('release').value) || 3.5;
                const audioMode = document.getElementById('audioMode').value;

                if (!audioCtx) {
                    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                    initOscilloscope();
                }

                const normalizedPartials = normalizePartials(partials);
                
                const convolver = audioCtx.createConvolver();
                convolver.buffer = createImpulseResponse(audioCtx);

                // –°–æ–∑–¥–∞–µ–º –¥–≤–∞ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞ –¥–ª—è —Å—Ç–µ—Ä–µ–æ –∫–∞–Ω–∞–ª–æ–≤
                analyserLeft = audioCtx.createAnalyser();
                analyserRight = audioCtx.createAnalyser();
                
                analyserLeft.fftSize = 2048;
                analyserRight.fftSize = 2048;
                
                bufferLength = analyserLeft.frequencyBinCount;
                dataArrayLeft = new Uint8Array(bufferLength);
                dataArrayRight = new Uint8Array(bufferLength);

                const masterGain = audioCtx.createGain();
                masterGain.gain.value = 1.0;
                
                const splitter = audioCtx.createChannelSplitter(2);
                convolver.connect(splitter);
                splitter.connect(analyserLeft, 0);
                splitter.connect(analyserRight, 1);
                splitter.connect(masterGain);
                masterGain.connect(audioCtx.destination);

                const now = audioCtx.currentTime;
                const currentNodes = [];

                const limitedPartials = normalizedPartials.slice(0, MAX_PARTIALS);
                
                limitedPartials.forEach((p, index) => {
                    if (audioMode === 'stereo90') {
                        createStereo90Bell(f0, p, index, limitedPartials.length, now, 
                                        attackTime, sustainTime, releaseTime, convolver, currentNodes);
                    } else {
                        createStereoBell(f0, p, index, limitedPartials.length, now,
                                        attackTime, sustainTime, releaseTime, convolver, currentNodes);
                    }
                });

                updateOscilloscope();
                
                setTimeout(() => {
                    try {
                        currentNodes.forEach(node => {
                            try {
                                if (node.stop) node.stop();
                                node.disconnect();
                            } catch(e) {
                                console.warn('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ —É–∑–ª–∞:', e);
                            }
                        });
                        stopOscilloscope();
                        resolve();
                    } catch (error) {
                        reject(error);
                    }
                }, (attackTime + sustainTime + releaseTime + 0.4) * 1000); // –£–≤–µ–ª–∏—á–µ–Ω–æ –≤—Ä–µ–º—è –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –∑–∞—Ç—É—Ö–∞–Ω–∏—è
                
            } catch (error) {
                reject(error);
            }
        });
    }

    // –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è offline-—Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —Å —à–∏—Ä–æ–∫–æ–ø–æ–ª–æ—Å–Ω—ã–º —Å—Ç–µ—Ä–µ–æ 90¬∞
    function createStereo90BellOffline(ctx, f0, partial, index, total, startTime, attack, sustain, release, convolver) {
        const oscLeft = ctx.createOscillator();
        const gainLeft = ctx.createGain();
        const oscRight = ctx.createOscillator();
        const gainRight = ctx.createGain();
        
        oscLeft.type = 'sine';
        oscRight.type = 'sine';
        
        const baseFreq = f0 * partial.ratio + (Math.random() * 2 - 1);
        oscLeft.frequency.value = baseFreq;
        oscRight.frequency.value = baseFreq;
        
        const vibrato = ctx.createOscillator();
        const vibratoGain = ctx.createGain();
        vibrato.frequency.value = 5 + Math.random() * 2;
        vibratoGain.gain.value = 1 + Math.random();
        
        vibrato.connect(vibratoGain);
        vibratoGain.connect(oscLeft.frequency);
        vibratoGain.connect(oscRight.frequency);
        
        const endTime = startTime + attack + sustain + release;
        const fadeOutTime = 0.2;
        
        // –° –ú–ù–û–ñ–ò–¢–ï–õ–ï–ú –ì–†–û–ú–ö–û–°–¢–ò
        gainLeft.gain.setValueAtTime(0, startTime);
        gainLeft.gain.linearRampToValueAtTime(partial.amp * VOLUME_MULTIPLIER, startTime + attack);
        if (sustain > 0) {
            gainLeft.gain.setValueAtTime(partial.amp * VOLUME_MULTIPLIER, startTime + attack + sustain);
        }
        gainLeft.gain.exponentialRampToValueAtTime(0.001, endTime + fadeOutTime);
        
        gainRight.gain.setValueAtTime(0, startTime);
        gainRight.gain.linearRampToValueAtTime(partial.amp * VOLUME_MULTIPLIER, startTime + attack);
        if (sustain > 0) {
            gainRight.gain.setValueAtTime(partial.amp * VOLUME_MULTIPLIER, startTime + attack + sustain);
        }
        gainRight.gain.exponentialRampToValueAtTime(0.001, endTime + fadeOutTime);
        
        const phaseShiftTime = 1 / (4 * baseFreq);
        
        oscLeft.connect(gainLeft);
        oscRight.connect(gainRight);
        
        const merger = ctx.createChannelMerger(2);
        gainLeft.connect(merger, 0, 0);
        gainRight.connect(merger, 0, 1);
        merger.connect(convolver);
        
        oscLeft.start(startTime);
        oscRight.start(startTime + phaseShiftTime);
        vibrato.start(startTime);
        
        oscLeft.stop(endTime + fadeOutTime + 0.1);
        oscRight.stop(endTime + fadeOutTime + 0.1 + phaseShiftTime);
        vibrato.stop(endTime + fadeOutTime + 0.1);
    }

    // –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ —Å—Ç–µ—Ä–µ–æ
    function createStereoBellOffline(ctx, f0, partial, index, total, startTime, attack, sustain, release, convolver) {
        const panPosition = (index / total) * 2 - 1;
        
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        const panner = ctx.createStereoPanner();
        
        osc.type = 'sine';
        osc.frequency.value = f0 * partial.ratio + (Math.random() * 2 - 1);
        panner.pan.value = panPosition;
        
        const vibrato = ctx.createOscillator();
        const vibratoGain = ctx.createGain();
        vibrato.frequency.value = 5 + Math.random() * 2;
        vibratoGain.gain.value = 1 + Math.random();
        
        vibrato.connect(vibratoGain).connect(osc.frequency);
        
        const endTime = startTime + attack + sustain + release;
        const fadeOutTime = 0.2;
        
        // –° –ú–ù–û–ñ–ò–¢–ï–õ–ï–ú –ì–†–û–ú–ö–û–°–¢–ò
        gain.gain.setValueAtTime(0, startTime);
        gain.gain.linearRampToValueAtTime(partial.amp * VOLUME_MULTIPLIER, startTime + attack);
        if (sustain > 0) {
            gain.gain.setValueAtTime(partial.amp * VOLUME_MULTIPLIER, startTime + attack + sustain);
        }
        gain.gain.exponentialRampToValueAtTime(0.001, endTime + fadeOutTime);
        
        osc.connect(gain).connect(panner).connect(convolver);
        osc.start(startTime);
        osc.stop(endTime + fadeOutTime + 0.1);
        vibrato.start(startTime);
        vibrato.stop(endTime + fadeOutTime + 0.1);
    }

    // –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –æ—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–ª—è offline
    function generateBellForOffline(ctx, startTime, f0, partials, convolverBuffer) {
        const audioMode = document.getElementById('audioMode').value;
        const attackTime = parseFloat(document.getElementById('attack').value) || 0.01;
        const sustainTime = parseFloat(document.getElementById('long').value) || 0;
        const releaseTime = parseFloat(document.getElementById('release').value) || 5.5;
        
        const normalizedPartials = normalizePartials(partials);
        
        // –°–û–ó–î–ê–ï–ú –û–¢–î–ï–õ–¨–ù–´–ô CONVOLVER –î–õ–Ø –ö–ê–ñ–î–û–ô –ß–ê–°–¢–û–¢–´
        const convolver = ctx.createConvolver();
        convolver.buffer = convolverBuffer;
        
        const masterGain = ctx.createGain();
        masterGain.gain.value = 1.0; // –ú–Ω–æ–∂–∏—Ç–µ–ª—å —É–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö gain
        
        convolver.connect(masterGain);
        masterGain.connect(ctx.destination);
        
        const limitedPartials = normalizedPartials.slice(0, MAX_PARTIALS);
        
        limitedPartials.forEach((p, index) => {
            if (audioMode === 'stereo90') {
                createStereo90BellOffline(ctx, f0, p, index, limitedPartials.length, startTime, 
                                        attackTime, sustainTime, releaseTime, convolver);
            } else {
                createStereoBellOffline(ctx, f0, p, index, limitedPartials.length, startTime,
                                      attackTime, sustainTime, releaseTime, convolver);
            }
        });
    }

    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è WAV —ç–∫—Å–ø–æ—Ä—Ç–∞
    function bufferToWav(buffer) {
        const numChannels = buffer.numberOfChannels;
        const sampleRate = buffer.sampleRate;
        const format = 3;
        const bitDepth = 32;
        const bytesPerSample = bitDepth / 8;
        const blockAlign = numChannels * bytesPerSample;
        
        const dataLength = buffer.length * numChannels * bytesPerSample;
        const bufferSize = 44 + dataLength;
        const arrayBuffer = new ArrayBuffer(bufferSize);
        const view = new DataView(arrayBuffer);
        
        writeString(view, 0, 'RIFF');
        view.setUint32(4, 36 + dataLength, true);
        writeString(view, 8, 'WAVE');
        writeString(view, 12, 'fmt ');
        view.setUint32(16, 16, true);
        view.setUint16(20, format, true);
        view.setUint16(22, numChannels, true);
        view.setUint32(24, sampleRate, true);
        view.setUint32(28, sampleRate * blockAlign, true);
        view.setUint16(32, blockAlign, true);
        view.setUint16(34, bitDepth, true);
        writeString(view, 36, 'data');
        view.setUint32(40, dataLength, true);
        
        let offset = 44;
        for (let i = 0; i < buffer.length; i++) {
            for (let ch = 0; ch < numChannels; ch++) {
                const sample = buffer.getChannelData(ch)[i];
                view.setFloat32(offset, sample, true);
                offset += 4;
            }
        }
        
        return new Blob([view], { type: 'audio/wav' });
    }
    
    function writeString(view, offset, string) {
        for (let i = 0; i < string.length; i++) {
            view.setUint8(offset + i, string.charCodeAt(i));
        }
    }
    
    function downloadWav(blob, filename) {
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        setTimeout(() => {
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }, 100);
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
    toggleBtn.onclick = () => {
        const f0 = parseFloat(freqInput.value);
        const partials = parsePartials(partialsInput.value);
        if (isPlaying || isNaN(f0) || !partials.length) return;
        
        isPlaying = true;
        toggleBtn.textContent = '‚è≥ –ó–≤—É–∫...';
        toggleBtn.classList.remove('btn-success');
        toggleBtn.classList.add('btn-secondary');
        
        startBell(f0, partials).then(() => {
            isPlaying = false;
            toggleBtn.textContent = '‚ñ∂Ô∏è –°—Ç–∞—Ä—Ç';
            toggleBtn.classList.remove('btn-secondary');
            toggleBtn.classList.add('btn-success');
        }).catch(error => {
            console.error('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:', error);
            isPlaying = false;
            toggleBtn.textContent = '‚ñ∂Ô∏è –°—Ç–∞—Ä—Ç';
            toggleBtn.classList.remove('btn-secondary');
            toggleBtn.classList.add('btn-success');
            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–∏ –∑–≤—É–∫–∞: ' + error.message);
        });
    };

    playSetBtn.onclick = async () => {
        if (isPlayingSet) {
            isPlayingSet = false;
            playSetBtn.textContent = 'üîî –ü—Ä–æ–∏–≥—Ä–∞—Ç—å –Ω–∞–±–æ—Ä';
            playSetBtn.classList.remove('btn-danger');
            playSetBtn.classList.add('btn-primary');
            return;
        }
        
        if (!oscilloscopeSvg || oscilloscopeSvg.children.length === 0) {
            initOscilloscope();
        }
        
        isPlayingSet = true;
        playSetBtn.textContent = '‚èπ –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å';
        playSetBtn.classList.remove('btn-primary');
        playSetBtn.classList.add('btn-danger');
        
        let freqs = setFreqsInput.value
            .split(/[,;]+/)
            .map(v => parseFloat(v.trim()))
            .filter(v => !isNaN(v))
            .filter(v => v >= 80 && v <= 10000);
        
        if (freqs.length === 0) {
            isPlayingSet = false;
            playSetBtn.textContent = 'üîî –ü—Ä–æ–∏–≥—Ä–∞—Ç—å –Ω–∞–±–æ—Ä';
            playSetBtn.classList.remove('btn-danger');
            playSetBtn.classList.add('btn-primary');
            return;
        }
        
        const partials = parsePartials(partialsInput.value);
        if (partials.length === 0) {
            isPlayingSet = false;
            playSetBtn.textContent = 'üîî –ü—Ä–æ–∏–≥—Ä–∞—Ç—å –Ω–∞–±–æ—Ä';
            playSetBtn.classList.remove('btn-danger');
            playSetBtn.classList.add('btn-primary');
            return;
        }
        
        const hitDelay = parseInt(hitDelayInput.value) || 0;
        const cycleDelay = parseInt(cycleDelayInput.value) || 0;

        try {
            do {
                for (const freq of freqs) {
                    if (!isPlayingSet) break;
                    await startBell(freq, partials);
                    if (!isPlayingSet) break;
                    await new Promise(resolve => setTimeout(resolve, hitDelay));
                }
                if (!isPlayingSet) break;
                if (!loopCheckbox.checked) break;
                await new Promise(resolve => setTimeout(resolve, cycleDelay));
            } while (isPlayingSet && loopCheckbox.checked);
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –Ω–∞–±–æ—Ä–∞:', error);
            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞–±–æ—Ä–∞: ' + error.message);
        } finally {
            isPlayingSet = false;
            playSetBtn.textContent = 'üîî –ü—Ä–æ–∏–≥—Ä–∞—Ç—å –Ω–∞–±–æ—Ä';
            playSetBtn.classList.remove('btn-danger');
            playSetBtn.classList.add('btn-primary');
        }
    };

    // –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø —Ñ—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è WAV —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–æ–º –Ω–∞–±–æ—Ä–∞ —á–∞—Å—Ç–æ—Ç
    saveBtn.onclick = async () => {
        let freqs = setFreqsInput.value.split(/[,;]+/)
            .map(v => parseFloat(v.trim()))
            .filter(v => !isNaN(v));
        
        if (freqs.length === 0) {
            alert("–ù–∞–±–æ—Ä —á–∞—Å—Ç–æ—Ç –ø—É—Å—Ç. –î–æ–±–∞–≤—å—Ç–µ —á–∞—Å—Ç–æ—Ç—ã.");
            return;
        }
        
        if (freqs.length > MAX_FREQUENCIES) {
            alert(`–ü—Ä–µ–≤—ã—à–µ–Ω–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å—Ç–æ—Ç: ${MAX_FREQUENCIES}`);
            return;
        }
        
        const repeats = prompt("–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–æ–≤ –Ω–∞–±–æ—Ä–∞ —á–∞—Å—Ç–æ—Ç:", "1");
        if (!repeats || isNaN(repeats) || parseInt(repeats) <= 0) {
            return;
        }
        const repeatCount = parseInt(repeats);
        
        if (repeatCount > MAX_REPEATS) {
            alert(`–ü—Ä–µ–≤—ã—à–µ–Ω–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–æ–≤: ${MAX_REPEATS}`);
            return;
        }
        
        let filenamePrefix = "";
        switch (instrumentSelect.value) {
            case "bell": filenamePrefix = "–ö–æ–ª–æ–∫–æ–ª"; break;
            case "bowl": filenamePrefix = "–ß–∞—à–∞"; break;
            case "smallbell": filenamePrefix = "–ö–æ–ª–æ–∫–æ–ª—å—á–∏–∫–∏"; break;
        }
        
        const additionalName = prompt("–í–≤–µ–¥–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è —Ñ–∞–π–ª–∞:", "");
        const filename = (filenamePrefix ? filenamePrefix + "-" : "") + 
            (additionalName || "–∑–≤—É–∫") + ".wav";
        
        const partials = parsePartials(partialsInput.value);
        if (partials.length === 0) {
            alert("–û—à–∏–±–∫–∞: –Ω–µ –∑–∞–¥–∞–Ω—ã –æ–±–µ—Ä—Ç–æ–Ω–∞.");
            return;
        }
        
        const hitDelay = parseInt(hitDelayInput.value) || 0;
        const cycleDelay = parseInt(cycleDelayInput.value) || 0;
        
        const attackTime = parseFloat(document.getElementById('attack').value) || 0.01;
        const sustainTime = parseFloat(document.getElementById('long').value) || 0;
        const releaseTime = parseFloat(document.getElementById('release').value) || 5.5;
        const bellDuration = attackTime + sustainTime + releaseTime + 0.4;
        
        const hitDelayInSeconds = hitDelay / 1000;
        const cycleDelayInSeconds = cycleDelay / 1000;
        
        const cycleDuration = freqs.length * bellDuration + 
            (freqs.length - 1) * hitDelayInSeconds + 
            cycleDelayInSeconds;
        const totalDuration = cycleDuration * repeatCount;
        
        if (totalDuration > MAX_DURATION) {
            alert(`–ü—Ä–µ–≤—ã—à–µ–Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (${MAX_DURATION} —Å–µ–∫). –£–º–µ–Ω—å—à–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å—Ç–æ—Ç –∏–ª–∏ –ø–æ–≤—Ç–æ—Ä–æ–≤.`);
            return;
        } else {
            alert(`–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å ${totalDuration} —Å–µ–∫. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ–∞–π–ª–∞ –∑–∞–π–º—ë—Ç –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è.`);
        }
        
        const sampleRate = 44100;
        const offlineCtx = new OfflineAudioContext(2, totalDuration * sampleRate, sampleRate);
        
        const convolverBuffer = createImpulseResponse(offlineCtx);
        
        // –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –õ–û–ì–ò–ö–ê - –∫–∞–∂–¥–∞—è —á–∞—Å—Ç–æ—Ç–∞ –≤ —Å–≤–æ–µ–º –≤—Ä–µ–º–µ–Ω–Ω–æ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª–µ
        for (let repeat = 0; repeat < repeatCount; repeat++) {
            let cycleStartTime = repeat * cycleDuration;
            
            for (let i = 0; i < freqs.length; i++) {
                const bellStartTime = cycleStartTime + i * (bellDuration + hitDelayInSeconds);
                generateBellForOffline(offlineCtx, bellStartTime, freqs[i], partials, convolverBuffer);
            }
        }
        
        try {
            const renderedBuffer = await offlineCtx.startRendering();
            const wavBlob = bufferToWav(renderedBuffer);
            downloadWav(wavBlob, filename);
            alert(`–§–∞–π–ª "${filename}" —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!`);
        } catch (e) {
            console.error("–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:", e);
            alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ñ–∞–π–ª–∞: " + e.message);
        }
    };

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    document.addEventListener('DOMContentLoaded', function() {
        initOscilloscope();
        renderSavedSets();
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
        instrumentSelect.addEventListener('change', () => {
            if (instrumentSelect.value !== 'custom') {
                document.getElementById('partials').value = instrumentPresets[instrumentSelect.value];
            }
        });
    });

    // –ö–æ–¥ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞–±–æ—Ä–æ–≤ —á–∞—Å—Ç–æ—Ç
    const SAVED_SETS_KEY = 'savedFrequencySets';
    
    function getSavedSets() {
        const data = localStorage.getItem(SAVED_SETS_KEY);
        if (!data) return {};
        try {
            return JSON.parse(data);
        } catch (e) {
            console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ –Ω–∞–±–æ—Ä–æ–≤:", e);
            return {};
        }
    }
    
    function saveFrequencySet(name, frequencies) {
        const savedSets = getSavedSets();
        savedSets[name] = frequencies;
        localStorage.setItem(SAVED_SETS_KEY, JSON.stringify(savedSets));
        renderSavedSets();
    }
    
    function deleteFrequencySet(name) {
        const savedSets = getSavedSets();
        delete savedSets[name];
        localStorage.setItem(SAVED_SETS_KEY, JSON.stringify(savedSets));
        renderSavedSets();
    }
    
    function clearAllSets() {
        localStorage.removeItem(SAVED_SETS_KEY);
        renderSavedSets();
    }
    
    function renderSavedSets() {
        const savedSets = getSavedSets();
        const container = document.getElementById('savedSetsList');
        container.innerHTML = '';
        
        const keys = Object.keys(savedSets);
        if (keys.length === 0) {
            container.innerHTML = '<div class="text-center py-3">–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –Ω–∞–±–æ—Ä–æ–≤</div>';
            return;
        }
        
        const sortedNames = keys.sort();
        sortedNames.forEach(name => {
            const frequencies = savedSets[name];
            const setElement = document.createElement('div');
            setElement.className = 'saved-set-item';
            
            const nameElement = document.createElement('div');
            nameElement.className = 'set-name';
            nameElement.textContent = name;
            nameElement.title = frequencies.join(', ');
            
            nameElement.addEventListener('click', () => {
                setFreqsInput.value = frequencies.join(', ');
                setFreqsInput.classList.add('highlight');
                setTimeout(() => {
                    setFreqsInput.classList.remove('highlight');
                }, 1000);
            });
            
            const deleteElement = document.createElement('span');
            deleteElement.className = 'delete-set';
            deleteElement.innerHTML = '‚ùå';
            deleteElement.title = '–£–¥–∞–ª–∏—Ç—å –Ω–∞–±–æ—Ä';
            
            deleteElement.addEventListener('click', (e) => {
                e.stopPropagation();
                if (confirm(`–£–¥–∞–ª–∏—Ç—å –Ω–∞–±–æ—Ä "${name}"?`)) {
                    deleteFrequencySet(name);
                }
            });
            
            setElement.appendChild(nameElement);
            setElement.appendChild(deleteElement);
            container.appendChild(setElement);
        });
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –∏ CSV
    document.getElementById('saveSetBtn').addEventListener('click', () => {
        const freqs = setFreqsInput.value
            .split(/[,;]+/) 
            .map(v => parseFloat(v.trim()))
            .filter(v => !isNaN(v))
            .filter(v => v >= 80 && v <= 10000);
        
        if (freqs.length === 0) {
            alert('–î–æ–±–∞–≤—å—Ç–µ —á–∞—Å—Ç–æ—Ç—ã –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞–±–æ—Ä–∞');
            return;
        }
        
        document.getElementById('setFrequenciesPreview').textContent = freqs.join(', ');
        document.getElementById('setNameInput').value = '';
        
        const modal = new bootstrap.Modal(document.getElementById('saveSetModal'));
        modal.show();
    });
    
    document.getElementById('confirmSaveSet').addEventListener('click', () => {
        const name = document.getElementById('setNameInput').value.trim();
        const freqsText = document.getElementById('setFrequenciesPreview').textContent;
        
        if (!name) {
            alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è –Ω–∞–±–æ—Ä–∞');
            return;
        }
        
        const freqs = freqsText.split(',')
            .map(v => parseFloat(v.trim()))
            .filter(v => !isNaN(v));
        
        saveFrequencySet(name, freqs);
        
        const modal = bootstrap.Modal.getInstance(document.getElementById('saveSetModal'));
        modal.hide();
        
        alert(`–ù–∞–±–æ—Ä "${name}" —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω—ë–Ω!`);
    });
    
    document.getElementById('clearSets').addEventListener('click', () => {
        if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –Ω–∞–±–æ—Ä—ã?')) {
            clearAllSets();
        }
    });
    
    // CSV —Ñ—É–Ω–∫—Ü–∏–∏
    function exportToCSV() {
        const savedSets = getSavedSets();
        if (Object.keys(savedSets).length === 0) {
            alert("–ù–µ—Ç –Ω–∞–±–æ—Ä–æ–≤ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞");
            return;
        }
        
        let csvContent = "–ù–∞–∑–≤–∞–Ω–∏–µ,–ß–∞—Å—Ç–æ—Ç—ã\n";
        for (const [name, frequencies] of Object.entries(savedSets)) {
            const escapedName = name.includes(',') ? `"${name}"` : name;
            csvContent += `${escapedName},${frequencies.join(',')}\n`;
        }
        
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'frequency_sets.csv';
        document.body.appendChild(a);
        a.click();
        setTimeout(() => {
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }, 100);
    }
    
    function importFromCSV(file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const content = e.target.result;
                const lines = content.split('\n').slice(1);
                const savedSets = getSavedSets();
                let importedCount = 0;
                
                for (const line of lines) {
                    if (!line.trim()) continue;
                    
                    let parts = [];
                    let inQuotes = false;
                    let current = '';
                    
                    for (let i = 0; i < line.length; i++) {
                        const char = line[i];
                        if (char === '"') {
                            inQuotes = !inQuotes;
                        } else if (char === ',' && !inQuotes) {
                            parts.push(current);
                            current = '';
                        } else {
                            current += char;
                        }
                    }
                    parts.push(current);
                    
                    if (parts.length < 2) continue;
                    
                    const name = parts[0].trim();
                    const frequencies = parts.slice(1)
                        .map(v => parseFloat(v.trim()))
                        .filter(v => !isNaN(v))
                        .filter(v => v >= 80 && v <= 10000);
                    
                    if (name && frequencies.length > 0) {
                        savedSets[name] = frequencies;
                        importedCount++;
                    }
                }
                
                if (importedCount > 0) {
                    localStorage.setItem(SAVED_SETS_KEY, JSON.stringify(savedSets));
                    renderSavedSets();
                    alert(`–£—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞–±–æ—Ä–æ–≤: ${importedCount}`);
                } else {
                    alert("–ù–µ —É–¥–∞–ª–æ—Å—å –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∏ –æ–¥–Ω–æ–≥–æ –Ω–∞–±–æ—Ä–∞");
                }
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ CSV:", error);
                alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ —Ñ–∞–π–ª–∞: " + error.message);
            }
        };
        reader.readAsText(file);
    }
    
    document.getElementById('exportCSV').addEventListener('click', exportToCSV);
    document.getElementById('importCSV').addEventListener('click', () => {
        document.getElementById('csvFileInput').click();
    });
    
    document.getElementById('csvFileInput').addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
            if (confirm("–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–±–æ—Ä—ã –∏–∑ CSV? –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –Ω–∞–±–æ—Ä—ã —Å —Ç–∞–∫–∏–º–∏ –∂–µ –∏–º–µ–Ω–∞–º–∏ –±—É–¥—É—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω—ã.")) {
                importFromCSV(file);
            }
        }
        e.target.value = '';
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø—Ä–µ—Å–µ—Ç–æ–≤
    document.querySelectorAll('.preset-link').forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const presetName = this.textContent;
            const presetValue = presetValues[presetName];
            
            if (presetValue) {
                const partialsInput = document.getElementById('partials');
                partialsInput.value = presetValue;
                
                const event = new Event('input', { bubbles: true });
                partialsInput.dispatchEvent(event);
                
                partialsInput.focus();
                partialsInput.classList.add('highlight');
                setTimeout(() => partialsInput.classList.remove('highlight'), 1000);
                
                document.getElementById('instrument').value = 'custom';
            }
        });
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ä–µ—Å–∞–π–∑–∞ –æ–∫–Ω–∞ –¥–ª—è –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∏ –æ—Å—Ü–∏–ª–ª–æ–≥—Ä–∞—Ñ–∞
    window.addEventListener('resize', initOscilloscope);
  </script>
</body>
</html>
