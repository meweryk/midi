<!DOCTYPE html>
<html lang="ru">
<head>
    <!--
  Copyright 2024 meweryk

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.

    –õ–∏—Ü–µ–Ω–∑–∏—Ä–æ–≤–∞–Ω–æ –ø–æ–¥ Apache License, Version 2.0 (–¥–∞–ª–µ–µ "–õ–∏—Ü–µ–Ω–∑–∏—è");
  –≤—ã –Ω–µ –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ—Ç —Ñ–∞–π–ª –∫—Ä–æ–º–µ –∫–∞–∫ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –õ–∏—Ü–µ–Ω–∑–∏–µ–π.
  –í—ã –º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –∫–æ–ø–∏—é –õ–∏—Ü–µ–Ω–∑–∏–∏ –ø–æ –∞–¥—Ä–µ—Å—É:

      http://www.apache.org/licenses/LICENSE-2.0

  –ï—Å–ª–∏ —ç—Ç–æ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ –ø—Ä–∏–º–µ–Ω–∏–º–æ–º—É –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤—É –∏–ª–∏ –Ω–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–æ –≤ –ø–∏—Å—å–º–µ–Ω–Ω–æ–π —Ñ–æ—Ä–º–µ,
  –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ, —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ–º–æ–µ –ø–æ –õ–∏—Ü–µ–Ω–∑–∏–∏, —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –Ω–∞ —É—Å–ª–æ–≤–∏—è—Ö "–ö–ê–ö –ï–°–¢–¨",
  –ë–ï–ó –∫–∞–∫–∏—Ö-–ª–∏–±–æ –≥–∞—Ä–∞–Ω—Ç–∏–π –∏–ª–∏ —É—Å–ª–æ–≤–∏–π —è–≤–Ω—ã—Ö –∏–ª–∏ –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ–º—ã—Ö.
-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="./manifest.json">
    <link rel="icon" href="./icon-192.png">
    <meta name="theme-color" content="#3a4a58">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —á–∞—Å—Ç–æ—Ç —Å FM –º–æ–¥—É–ª—è—Ü–∏–µ–π</title>
    <style>
        :root {
            --primary-color: #3a4a58;
            --secondary-color: #5d7b94;
            --accent-color: #6bb9f0;
            --background-color: #a6c2ec;
            --control-bg: #e8ecef;
            --border-color: #d1d9e0;
            --text-color: #333;
            --success-color: #7bc67e;
            --danger-color: #f28b82;
            --info-color: #8ab4f8;
        }
        
        body {
            font-family: 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            /* –£–º–µ–Ω—å—à–∞–µ–º –æ—Ç—Å—Ç—É–ø—ã, —á—Ç–æ–±—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –∫–æ—Ä–æ—Ç–∫–æ–π —à–∞–ø–∫–µ/–ø–æ–¥–≤–∞–ª—É */
            padding-top: 45px; /* –ù–æ–≤—ã–π –æ—Ç—Å—Ç—É–ø –¥–ª—è –∫–æ—Ä–æ—Ç–∫–æ–π —à–∞–ø–∫–∏ */
            padding-bottom: 45px; /* –ù–æ–≤—ã–π –æ—Ç—Å—Ç—É–ø –¥–ª—è –ø–æ–¥–≤–∞–ª–∞ */
            margin-left: auto; /* –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ */
            margin-right: auto; /* –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ */
            min-height: 100vh; 
            display: flex;
            flex-direction: column;
            /*margin: 10px;*/
            max-width: 800px;
            font-size: 0.9em;
            background-color: var(--background-color);
            color: var(--text-color);
        }
        li {
            font-size: 0.8em;
        }
        .control {
            margin: 8px 0;
            padding: 10px;
            border: 1px solid var(--border-color);
            background: var(--control-bg);
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .control-block {
            margin: 10px 0;
            padding: 10px;
            border: 1px solid var(--border-color);
            background: var(--control-bg);
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        } 
        .frequency-item {
            margin: 6px 0;
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
            position: relative;
        }
        .divider {
            height: 2px;
            background: #999;
            margin: 10px 0;
            width: 100%;
        }
        .color-box {
            width: 25px;
            height: 25px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 8px;
            border: 1px solid var(--border-color);
            text-align: center;
        }
        th {
            background-color: var(--secondary-color);
            color: white;
        }
        input[type="range"] {
            width: 120px;
            height: 6px;
            border-radius: 3px;
            background: var(--border-color);
            appearance: none;
            -webkit-appearance: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--secondary-color);
            cursor: pointer;
        }
        input[type="range"].phase-shift {
            width: 160px;
        }
        input[type="range"].phase-shift::-webkit-slider-thumb {
            background: var(--accent-color);
        }
        button {
            padding: 8px 12px;
            cursor: pointer;
            border-radius: 6px;
            font-size: 0.9em;
            border: none;
            transition: all 0.2s ease;
        }
        .main-btn {
            background: var(--secondary-color);
            color: white;
        }
        button.main-btn.active {
            background-color: var(--success-color);
        }
        .remove-btn {
            background: var(--danger-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: auto;
            font-weight: bold;
        }
        .pan-selector {
            margin: 0 5px;
            padding: 5px;
            width: 60px;
            font-size: 0.9em;
            border-radius: 4px;
            border: 1px solid var(--border-color);
            background: white;
        }
        .phase-control {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        input[type="number"] {
            font-size: 0.9em;
            padding: 5px;
            width: 80px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: white;
        }
        .wave-controls {
            margin-top: 8px;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        .wave-btn {
            padding: 8px 12px;
            cursor: pointer;
            border-radius: 6px;
            font-size: 0.9em;
            background: var(--secondary-color);
            color: white;
        }
        .wave-btn.active {
            background-color: var(--success-color);
        }
        .fm-controls {
            margin-top: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
            padding: 10px;
            background: rgba(107, 185, 240, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(107, 185, 240, 0.3);
        }
        .fm-label {
            font-weight: 600;
            color: var(--text-color);
        }
        .info-button {
            font-size: 18px;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            text-align: center;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal {
            display: none; 
            position: fixed;
            z-index: 1;
            left: 0; top: 0;
            width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: var(--background-color);
            margin: 15% auto;
            padding: 25px;
            border-radius: 12px;
            width: 320px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            position: relative;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 20px;
            font-weight: bold;
            color: var(--secondary-color);
            cursor: pointer;
        }

        .close:hover {
            color: var(--primary-color);
        }
        
        .name-prompt-modal {
        	display: none;
        	position: fixed;
        	z-index: 2;
        	left: 0;
        	top: 0;
        	width: 100%;
        	height: 100%;
        	background-color: rgba(0,0,0,0.5);
        }
        
        .name-prompt-content {
        	background-color: var(--background-color);
        	margin: 20% auto;
        	padding: 20px;
        	border-radius: 8px;
        	width: 320px;
        	box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }
        
        .save-list-container {
            margin: 10px 0;
        }
        
        .saved-lists-header {
            cursor: pointer;
            padding: 10px;
            background: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
        }
        
        .saved-lists-header::after {
            content: "‚ñº";
            font-size: 0.8em;
        }
        
        .saved-lists-content {
            display: none;
            margin-top: 8px;
            border: 1px solid var(--border-color);
            padding: 10px;
            border-radius: 6px;
            background: white;
        }
        
        .saved-list-btn {
            display: block;
            width: 100%;
            margin: 3px 0;
            padding: 7px;
            text-align: left;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .saved-list-btn:hover {
            background: #f0f4f8;
            border-color: var(--accent-color);
        }
        
        .delete-preset-btn {
        	background: var(--danger-color);
        	color: white;
        	border: none;
        	border-radius: 50%;
        	width: 28px;
        	height: 28px;
        	display: flex;
        	align-items: center;
        	justify-content: center;
        	cursor: pointer;
        	margin-left: 10px;
        	font-weight: bold;
        	transition: all 0.2s ease;
        }
        
        .delete-preset-btn:hover {
        	transform: scale(1.1);
        }
        
        #saveListBtn, #exportBtn, #importBtn {
            margin-top: 20px;
            padding: 10px 16px;
            background: var(--success-color);
            color: white;
            border: none;
            margin-right: 8px;
            font-weight: 500;
        }
        
        #exportBtn {
            background: var(--accent-color);
        }
        
        #importBtn {
            background: #FF9800;
        }
        
        .info-container {
            margin: 10px 0;
        }
        
        .info-header {
            cursor: pointer;
            padding: 10px;
            background: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
        }
        
        .info-header::after {
            content: "‚ñº";
            font-size: 0.8em;
        }
        
        .info-content {
            display: none;
            margin-top: 10px;
            border: 1px solid var(--border-color);
            padding: 15px;
            border-radius: 6px;
            background: white;
        }
        
        .quick-preset-container {
            margin: 10px 0;
            display: flex;
            gap: 8px;
        }
        #quickPresetInput {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: white;
        }
        #quickSaveBtn {
            padding: 10px 16px;
            background: var(--success-color);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        
        #quickSaveBtn:hover {
            background: #6bb06e;
        }
        
        .saved-item-container {
        	display: flex;
        	align-items: center;
        	margin-bottom: 8px;
        }
        
        .saved-item-name {
        	flex-grow: 1;
        	text-align: left;
        }
        
        #scrollToTopBtn {
            position: fixed;
            bottom: 25px;
            right: 25px;
            display: none;
            z-index: 99;
            padding: 12px 16px;
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            transition: all 0.2s ease;
        }
        #scrollToTopBtn:hover {
            background-color: var(--accent-color);
            transform: translateY(-2px);
        }
        
        .accordion-container {
            width: 100%;
            margin: 12px 0;
        }
        .accordion-btn {
            width: 100%;
            padding: 12px 15px;
            text-align: left;
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            transition: all 0.2s ease;
        }
        .accordion-btn:hover {
            background-color: #4c5e6f;
        }
        .accordion-btn::after {
            content: "‚ñº";
            font-size: 0.8em;
        }
        .accordion-btn.expanded::after {
            content: "‚ñ≤";
        }
        .accordion-content {
            display: none;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-top: none;
            border-radius: 0 0 6px 6px;
            background: white;
        }
        @media (max-width: 600px) {
            .accordion-btn {
                font-size: 0.9em;
                padding: 10px 12px;
            }
             /* –£–º–µ–Ω—å—à–µ–Ω–∏–µ –æ—Ç—Å—Ç—É–ø–∞ main-content –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —ç–∫—Ä–∞–Ω–∞—Ö –¥–ª—è –ª—É—á—à–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ */
            .main-content {
                padding: 10px; 
            }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .control, .accordion-content {
            animation: fadeIn 0.3s ease-out;
        }
        
        /* –ù–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è WAV –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ */
        .wav-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }
        
        .wav-row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .wav-param {
            flex: 1;
            min-width: 150px;
        }
        
        .wav-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
        }
        
        .wav-modal-content {
            background-color: var(--background-color);
            margin: 10% auto;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
        
        .progress-container {
            margin: 15px 0;
            height: 20px;
            background-color: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background-color: var(--accent-color);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .wav-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
        }
        
        .wav-option {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ */
        .visualizer-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 10px 0;
        }
        
        .visualizer-canvas {
            width: 100%;
            height: 200px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background-color: #000;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–ª—è –≥—Ä–æ–º–∫–æ—Å—Ç–∏ */
        .volume-control {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .volume-input {
            width: 60px !important;
            text-align: center;
        }
        
        .volume-icon {
            font-size: 16px;
            color: var(--secondary-color);
        }
        /* –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ç–∏–ª–∏ –¥–ª—è —à–∞–ø–∫–∏ (Navbar) */
        .navbar-custom {
            background-color: var(--primary-color) !important;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            padding-top: 5px !important; 
            padding-bottom: 5px !important; 
            min-height: 45px; /* –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –¥–ª—è –∫–æ—Ä–æ—Ç–∫–æ–π —à–∞–ø–∫–∏ */
        }
        /*–£–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –∏–∫–æ–Ω–∫–∏ –º–µ–Ω—é */
        .navbar-toggler-icon {
            width: 1.2em;
            height: 1.2em;
        }
        /* –°—Ç–∏–ª—å –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ –≤ —à–∞–ø–∫–µ */
        .navbar-brand-custom {
            color: var(--accent-color) !important;
            font-weight: 600;
        }
        /* –°—Ç–∏–ª—å –¥–ª—è –≤—Å–ø–ª—ã–≤–∞—é—â–µ–≥–æ –º–µ–Ω—é (Offcanvas) */
        .offcanvas-custom {
            background-color: var(--primary-color);
        }
        .offcanvas-header {
            border-bottom: 1px solid var(--secondary-color);
        }

        /* –û—Ç—Å—Ç—É–ø –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
        .main-content {
            padding: 20px 10px 10px 10px;
            flex-grow: 1; 
        }
        /* –°—Ç–∏–ª—å –¥–ª—è –ø–æ–¥–≤–∞–ª–∞ (Footer) */
        .footer-custom {
            background-color: var(--primary-color);
            box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.1);
            /* –£–±—Ä–∞–Ω–æ width: 100%; —Ç.–∫. fixed-bottom –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–æ–ª–Ω—É—é —à–∏—Ä–∏–Ω—É viewport */
            padding-top: 5px !important;
            padding-bottom: 5px !important;
            min-height: 40px; /* –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –¥–ª—è –∫–æ—Ä–æ—Ç–∫–æ–≥–æ –ø–æ–¥–≤–∞–ª–∞ */
        }
        .footer-custom p {
            color: var(--accent-color) !important;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <!-- –®–∞–ø–∫–∞ (Header/Navbar) —Å –∫–Ω–æ–ø–∫–æ–π –≤—Å–ø–ª—ã–≤–∞—é—â–µ–≥–æ –º–µ–Ω—é -->
    <nav class="navbar navbar-dark navbar-custom fixed-top">
        <div class="container-fluid">
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
            <span class="navbar-brand navbar-brand-custom me-auto ms-3 h1">–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —á–∞—Å—Ç–æ—Ç</span>
            
            <!-- –ö–Ω–æ–ø–∫–∞ –≤—Å–ø–ª—ã–≤–∞—é—â–µ–≥–æ –º–µ–Ω—é (Offcanvas Trigger) —Å–ø—Ä–∞–≤–∞ -->
            <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar" aria-label="–û—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <!-- –í—Å–ø–ª—ã–≤–∞—é—â–µ–µ –º–µ–Ω—é (Offcanvas) -->
            <div class="offcanvas offcanvas-end offcanvas-custom" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel">
                <div class="offcanvas-header">
                    <h5 class="offcanvas-title navbar-brand-custom" id="offcanvasNavbarLabel">–ù–∞–≤–∏–≥–∞—Ü–∏—è</h5>
                    <!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –¥–ª—è —Ç–µ–º–Ω–æ–≥–æ —Ñ–æ–Ω–∞ -->
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="–ó–∞–∫—Ä—ã—Ç—å"></button>
                </div>
                <div class="offcanvas-body">
                    <!-- –°—Å—ã–ª–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≤–∏–¥–µ –∫–Ω–æ–ø–æ–∫ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ -->
                    <div class="d-grid gap-2">
                        <a href="./kolokol0018.html" class="btn btn-outline-light">–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–æ–ª–æ–∫–æ–ª—å–Ω–æ–≥–æ –∑–≤–æ–Ω–∞</a>
                        <a href="./calc_music.html" class="btn btn-outline-light">–ê–Ω–∞–ª–∏–∑ –º—É–∑—ã–∫–∞–ª—å–Ω–æ–≥–æ —Å—Ç—Ä–æ—è —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π</a>
                        <a href="./processorG.html" class="btn btn-outline-light">–ê—É–¥–∏–æ–ø–ª–µ–µ—Ä —Ñ–∞–∑–æ–≤—Ä–∞—â–∞—Ç–µ–ª—å</a>
                        <a href="./Raman-ir-uv.html" class="btn btn-outline-light">–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä —Å–ø–µ–∫—Ç—Ä–æ–≤ –≤ –∑–≤—É–∫</a>
                        <hr class="text-white-50">
                        <a href="./LICENSE" class="btn btn-outline-light">–õ–∏—Ü–µ–Ω–∑–∏–æ–Ω–Ω–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ</a>
                        <a href="./README.md" class="btn btn-outline-light">–û –ø—Ä–æ–≥—Ä–∞–º–º–µ</a>
                        <a href="https://meweryk.github.io/Wave-of-land/index.html" class="btn btn-outline-light">–ï—â—ë –ø—Ä–æ–µ–∫—Ç—ã</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>


    <div class="main-content">
    
    <div class="control">
        <div style="display: flex; gap: 8px; margin-bottom: 10px;">
            <button id="toggleBtn" class="main-btn">–°—Ç–∞—Ä—Ç</button>
            <button id="addFrequency" class="main-btn">+ –î–æ–±–∞–≤–∏—Ç—å —á–∞—Å—Ç–æ—Ç—É</button>
            <button class="main-btn info-button" onclick="openModal()">i</button>
        </div>
        
        <div class="wave-controls">
            <button id="sineBtn" class="wave-btn active">–°–∏–Ω—É—Å</button>
            <button id="squareBtn" class="wave-btn">–ú–µ–∞–Ω–¥—Ä</button>
            <button id="cycleFrequencies" class="wave-btn">–ø–µ—Ä–µ–±–æ—Ä —á–∞—Å—Ç–æ—Ç</button>
        </div>
        
        <div class="fm-controls">
            <input type="checkbox" id="fmEnabled">
            <span class="fm-label">FM –º–æ–¥—É–ª—è—Ü–∏—è:</span>
            
            <span class="fm-label">–ß–∞—Å—Ç–æ—Ç–∞ (–ì—Ü):</span>
            <input type="number" id="fmFreq" min="0" max="100" value="0" step="0.001" style="width: 80px;">
            
            <span class="fm-label">–î–µ–≤–∏–∞—Ü–∏—è (%):</span>
            <input type="number" id="fmDepth" min="0" max="5" value="0" step="0.01" style="width: 70px;">
        </div>
    </div>
    
    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ -->
    <div class="control">
        <h6 style="text-align: center;">–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã—Ö–æ–¥–Ω–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞</h3>
        <div class="visualizer-container">
            <canvas id="oscilloscopeCanvas" class="visualizer-canvas"></canvas>
            <canvas id="lissajousCanvas" class="visualizer-canvas"></canvas>
        </div>
    </div>
    
    <div class="accordion-container">
        <button class="accordion-btn" onclick="toggleAccordion('freqAccordion')">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–∞—Å—Ç–æ—Ç</button>
        <div class="accordion-content" id="freqAccordion">
            <div id="frequencyControls" class="control"></div>
        </div>
    </div>
    
    <div class="accordion-container">
        <button class="accordion-btn" onclick="toggleAccordion('colorAccordion')">–¢–∞–±–ª–∏—Ü–∞ —Ü–≤–µ—Ç–æ–≤</button>
        <div class="accordion-content" id="colorAccordion">
            <table>
                <thead>
                    <tr>
                        <th>–ó–≤—É–∫ (–ì—Ü)</th>
                        <th>–°–≤–µ—Ç (–¢–ì—Ü)</th>
                        <th>–î–ª–∏–Ω–∞ –≤–æ–ª–Ω—ã</th>
                        <th>–¶–≤–µ—Ç</th>
                    </tr>
                </thead>
                <tbody id="results"></tbody>
            </table>
        </div>
    </div>
    
    <div class="control-block">
        <button id="saveListBtn" title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–ø–∏—Å–æ–∫">üíæ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
        <button id="exportBtn">–≠–∫—Å–ø–æ—Ä—Ç</button>
        <button id="importBtn">–ò–º–ø–æ—Ä—Ç</button>
        <input type="file" id="csvFileInput" accept=".csv" style="display: none;">
    </div>
    
    <button id="saveToWavBtn" class="main-btn" style="width: calc(100% - 20px); margin: 0 10px; display: none;">
    	–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ WAV —Ñ–∞–π–ª
    </button>
    
    <div class="control-block">
        <div class="quick-preset-container">
            <input type="text" id="quickPresetInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —á–∞—Å—Ç–æ—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ: —á–∞—Å—Ç–æ—Ç–∞,–≥—Ä–æ–º–∫–æ—Å—Ç—å; —á–∞—Å—Ç–æ—Ç–∞,–≥—Ä–æ–º–∫–æ—Å—Ç—å; ...">
            <button id="quickSaveBtn" title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–µ—Å–µ—Ç">üíæ</button>
        </div>
    </div>
    
    <div class="save-list-container control">
        <div class="saved-lists-header" onclick="toggleSavedLists()">
            –°–ø–∏—Å–æ–∫ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —á–∞—Å—Ç–æ—Ç
        </div>
        <div class="saved-lists-content" id="savedListsContent"></div>
    </div>
    
    <div class="info-container control">
        <div class="info-header" onclick="toggleInfo()">
            –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —á–∞—Å—Ç–æ—Ç–∞—Ö –ø–ª–∞–Ω–µ—Ç –∏ –î–ù–ö
        </div>
        <div class="info-content mb-2" id="infoContent">
            <ul>
                <li>–ò–¥–µ–∞–ª—å–Ω—ã–π 5-–π –∫–ª—é—á –î–ù–ö: –≥–∞—Ä–º–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å
                    —á–∞—Å—Ç–æ—Ç–∞–º–∏ D 288 –ì—Ü –∏ –ê 432 –ì—Ü, –æ–Ω —è–≤–ª—è–µ—Ç—Å—è –∫—Ä–∞–µ—É–≥–æ–ª—å–Ω—ã–º –∫–∞–º–Ω–µ–º –∫–æ–ª–ª–µ–∫—Ü–∏–∏.</li>
                <li>–ò–¥–µ–∞–ª—å–Ω–∞—è 5-—è –∫–ª–∞–≤–∏—à–∞ F/C: –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ —á–∞—Å—Ç–æ—Ç—É F 324 –ì—Ü –∏ –° 512 –ì—Ü, –ø—Ä–µ–¥–ª–∞–≥–∞—è –Ω–æ–≤–æ–µ –∏–∑–º–µ—Ä–µ–Ω–∏–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –≥–∞—Ä–º–æ–Ω–∏–∫.</li>
                <li>–î–µ–ª—å—Ç–∞-–∫–ª–∞–≤–∏—à–∞: —É–Ω–∏–∫–∞–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ –Ω–æ—Ç—É D –Ω–∞ –æ–±–æ–∏—Ö –∫–æ–Ω—Ü–∞—Ö —Å–æ —Å–º–µ—â–µ–Ω–∏–µ–º –Ω–∞ 3 –ì—Ü, —Å–æ–∑–¥–∞–≤–∞—è –¥–µ–ª—å—Ç–∞-–±–∏–Ω–∞—É—Ä–∞–ª—å–Ω—É—é —á–∞—Å—Ç–æ—Ç—É, —Å–ø–æ—Å–æ–±—Å—Ç–≤—É—é—â—É—é –≥–ª—É–±–æ–∫–æ–π –º–µ–¥–∏—Ç–∞—Ü–∏–∏ –∏ —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏.</li>
                <li>–¢–µ—Ç–∞-–∫–ª—é—á: –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –Ω–æ—Ç—É –ê –Ω–∞ –æ–±–æ–∏—Ö –∫–æ–Ω—Ü–∞—Ö –∏ —Å–º–µ—â–µ–Ω –Ω–∞ 6 –ì—Ü, –æ–Ω —Å–æ–∑–¥–∞–µ—Ç —Ç–µ—Ç–∞-–±–∏–Ω–∞—É—Ä–∞–ª—å–Ω—É—é —á–∞—Å—Ç–æ—Ç—É, —Å–ø–æ—Å–æ–±—Å—Ç–≤—É—é—â—É—é —Å–æ—Å—Ç–æ—è–Ω–∏—é —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–Ω–æ–≥–æ –æ—Å–æ–∑–Ω–∞–Ω–∏—è –∏ –æ—Ç–∫—Ä—ã–≤–∞—è –¥–æ—Å—Ç—É–ø –∫ –ø–æ–¥—Å–æ–∑–Ω–∞–Ω–∏—é.</li>
            </ul>
            <h3>–¢–æ–Ω–∞ –ø–ª–∞–Ω–µ—Ç</h3>
            <ul>
                <li>
                    <b>–¢–æ–Ω –ú–µ—Ä–∫—É—Ä–∏—è.</b><br>  			
                    141.27 Hz<br>    			
                    –¶–≤–µ—Ç: —Å–∏–Ω–µ-–∑–µ–ª–µ–Ω—ã–π<br>   			
                    –ß–∞–∫—Ä–∞: –í–∏—à—É–¥—Ö–∞ –≥–æ—Ä–ª–æ–≤–∞—è —á–∞–∫—Ä–∞<br>    			
                    –≠—Ñ—Ñ–µ–∫—Ç: –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ü–µ–Ω—Ç—Ä —Ä–µ—á–∏, –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—é –∏ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—É—é –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å.
                </li>
                <li>
                    <b>–¢–æ–Ω –í–µ–Ω–µ—Ä—ã.</b><br>  			
                    221.23 Hz<br>    			
                    –¶–≤–µ—Ç: –∂–µ–ª—Ç–æ-–æ—Ä–∞–Ω–∂–µ–≤—ã–π<br>    			
                    –ß–∞–∫ra: –ê–¥–∂–Ω–∞ –Ω–∞–¥–±—Ä–æ–≤–Ω–∞—è —á–∞–∫—Ä–∞, —Ç—Ä–µ—Ç–∏–π –≥–ª–∞–∑<br>    			
                    –≠—Ñ—Ñ–µ–∫—Ç: –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—ã—Å—à—É—é –ª—é–±–æ–≤–Ω—É—é —ç–Ω–µ—Ä–≥–∏—é –∏ —Å—Ç—Ä–µ–º–ª–µ–Ω–∏–µ –∫ –≥–∞—Ä–º–æ–Ω–∏–∏.
                </li>
                <li>
                    <b>–¢–æ–Ω –ú–∞—Ä—Å–∞.</b><br>    			
                    144.72 Hz<br>    			
                    –¶–≤–µ—Ç: —Å–∏–Ω–∏–π<br>    			
                    –≠—Ñ—Ñ–µ–∫—Ç: –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–∏–ª—É –≤–æ–ª–∏ –∏ —Å—Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é —ç–Ω–µ—Ä–≥–∏—é
                </li>
                <li>			
                    <b>–¢–æ–Ω –Æ–ø–∏—Ç–µ—Ä–∞.</b><br>    			
                    183.58 Hz<br>    			
                    –¶–≤–µ—Ç: –∫—Ä–∞—Å–Ω—ã–π<br>    			
                    –≠—Ñ—Ñ–µ–∫—Ç: –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–≤–æ—Ä—á–µ—Å–∫—É—é —Å–∏–ª—É.
                </li>
                <li>    			
                    <b>–¢–æ–Ω –°–∞—Ç—É—Ä–Ω.</b><br>   			
                    147.85 Hz<br>   			
                    –¶–≤–µ—Ç: —Å–∏–Ω–∏–π<br>  			
                    –≠—Ñ—Ñ–µ–∫—Ç: —É—Å–∏–ª–∏–≤–∞–µ—Ç –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—é –∏ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å.
                </li>
                <li>
                    <b>–¢–æ–Ω –£—Ä–∞–Ω–∞.</b><br>    			
                    207.36 Hz<br>    			
                    –¶–≤–µ—Ç: –æ—Ä–∞–Ω–∂–µ–≤—ã–π<br>    			
                    –≠—Ñ—Ñ–µ–∫—Ç: –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–∏–ª—É —É–¥–∏–≤–ª–µ–Ω–∏—è –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, –æ–±–ª–∞–¥–∞–µ—Ç –ø–µ—Ä–≤–æ–±—ã—Ç–Ω–æ–π –∏ —ç—Ä–æ—Ç–∏—á–µ—Å–∫–æ–π —Å–∏–ª–æ–π.    			
                </li>
                <li>
                    <b>–¢–æ–Ω –ù–µ–ø—Ç—É–Ω–∞.</b><br>    			
                    211.44 Hz<br>    			
                    –¶–≤–µ—Ç: –æ—Ä–∞–Ω–∂–µ–≤—ã–π<br>    			
                    –≠—Ñ—Ñ–µ–∫—Ç: –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∏–Ω—Ç—É–∏—Ü–∏—é, –ø–æ–¥—Å–æ–∑–Ω–∞–Ω–∏–µ –∏ —É—Å–∏–ª–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–∂–∏–≤–∞–Ω–∏—è –≤–æ —Å–Ω–µ.    			
                </li>
                <li>
                    <b>–¢–æ–Ω –ü–ª—É—Ç–æ–Ω–∞.</b><br>   			
                    140.64 Hz<br>			
                    –¶–≤–µ—Ç: —Å–∏–Ω–µ-–∑–µ–ª–µ–Ω—ã–π<br>   			
                    –≠—Ñ—Ñ–µ–∫—Ç: –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–∞–≥–∏—á–µ—Å–∫—É—é –≥—Ä—É–ø–ø–æ–≤—É—é –¥–∏–Ω–∞–º–∏–∫—É –∏ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –æ–±—â–µ—Å—Ç–≤–∞.
                </li>
                <li>
                    <b>–¢–æ–Ω –°–æ–ª–Ω—Ü–∞.</b><br>   			
                    126.22 Hz<br>    			
                    –¶–≤–µ—Ç: –∂–µ–ª—Ç–æ-–∑–µ–ª–µ–Ω—ã–π<br>   			
                    –ß–∞–∫ra: –ú–∞–Ω–∏–ø—Éura —Å–æ–ª–Ω–µ—á–Ω–æ–µ —Å–ø–ª–µ—Ç–µ–Ω–∏–µ	(Xapa)<br>    			
                    –≠—Ñ—Ñ–µ–∫—Ç: —É—Å–∏–ª–∏–≤–∞–µ—Ç –æ—â—É—â–µ–Ω–∏–µ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ –º–∞–≥–∏—á–µ—Å–∫–æ–º –∏ —Ç—Ä–∞–Ω—Å—Ü–µ–Ω–¥–µ–Ω—Ç–Ω–æ–º.<br>   			
                    –°–æ–ª–Ω—Ü–µ —ç—Ç–æ —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–π —Ü–µ–Ω—Ç—Ä –Ω–∞—à–µ–π —Å–æ–ª–Ω–µ—á–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã. –û–Ω–æ —è–≤–ª—è–µ—Ç—Å—è —Ü–µ–Ω—Ç—Ä–æ–º –ø—Ä–∏—Ç—è–∂–µ–Ω–∏—è, –≤–æ–∫—Ä—É–≥ –∫–æ—Ç–æ—Ä–æ–≥–æ –≤—Ä–∞—â–∞—é—Ç—Å—è –ó–µ–º–ª—è –∏ –¥—Ä—É–≥–∏–µ –ø–ª–∞–Ω–µ—Ç—ã. –ü–æ—ç—Ç–æ–º—É —á–∞—Å—Ç–æ—Ç–∞ —Å–æ–ª–Ω—Ü–∞ —Å–≤—è–∑–∞–Ω–∞ —Å –ø—Å–∏—Ö–∏—á–µ—Å–∫–∏–º —Ü–µ–Ω—Ç—Ä–æ–º. –í –î–∑–µ–Ω–µ —ç—Ç–∞ —Ç–æ—á–∫–∞ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –•–∞—Ä–∞. –¢–æ–Ω —Å–æ–ª–Ω—Ü–∞ —ç—Ç–æ –≥—Ä–∞–Ω–∏—Ü–∞ –º–µ–∂–¥—É –ò–Ω—å –∏ –Ø–Ω, –º–µ–∂–¥—É —ç—Ç–æ–π –∏ –¥—Ä—É–≥–æ–π —Å—Ç–æ—Ä–æ–Ω–æ–π. –û–Ω –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –∏–∑ –≤—ã—Å—à–µ–≥–æ –∏–∑–º–µ—Ä–µ–Ω–∏—è –∏, –ª–∏—à–µ–Ω–Ω–æ–π —Ä–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è, —Å–∏–º–≤–æ–ª–∏–∑–∏—Ä—É–µ—Ç –Ω–µ—á—Ç–æ –º–∞–≥–∏—á–µ—Å–∫–æ–µ –∏ —Ç—Ä–∞–Ω—Å—Ü–µ–Ω–¥–µ–Ω—Ç–Ω–æ–µ. 			
                    –°–æ–ª–Ω–µ—á–Ω—ã–π —Ç–æ–Ω —Å–ª–µ–¥—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ —Ä–∞–±–æ—Ç—ã —Å –¥—Ä—É–≥–∏–º–∏ —Ç–æ–Ω–∞–º–∏ –∏ –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å –¥–ª—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö –ø—Ä–∞–∫—Ç–∏–∫–æ–≤.
                </li>
            </ul>   
            <p>–û—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–µ <a href="https://www.planetware.de/octave/">Planetware</a>, –≥–¥–µ –º–æ–∂–Ω–æ —Å–∫–∞—á–∞—Ç—å —ç—Ç–∏ —Ç–æ–Ω–∞.
           </p>
        </div>        
    </div>
    
    <button id="scrollToTopBtn" title="–ù–∞–≤–µ—Ä—Ö">‚Üë</button>

    <div id="infoModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä–µ</h3>
            <p>–≠—Ç–æ –ø—Ä–æ—Å—Ç–æ–π —Å–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —á–∞—Å—Ç–æ—Ç –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–æ–¥–∏–Ω—Å–∫–æ–≥–æ –±—É–±–ª–∏–∫–∞.</p>
            
            <ul>
            <li>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä–æ–≤</li>
            <li>–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä–∞ –∫–∞–Ω–∞–ª–∞: –ø—Ä–∞–≤–æ–≥–æ (R), –ª–µ–≤–æ–≥–æ (L) –∏–ª–∏ –≤—ã–≤–æ–¥–∞ –Ω–∞ –¥–≤–∞ —Å—Ä–∞–∑—É (–°)</li>
            <li>–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–¥–≤–∏–≥–∞ —Ñ–∞–∑—ã (–¥–æ 180¬∞) –º–µ–∂–¥—É –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä–∞–º–∏</li>
            <li>–†–∞—Å—á—ë—Ç –¥–ª–∏–Ω—ã –≤–æ–ª–Ω—ã –≤ –≤–∏–¥–∏–º–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ –ø—Ä–∏ –æ–∫—Ç–∞–≤–Ω–æ–º —É–≤–µ–ª–∏—á–µ–Ω–∏–∏ —á–∞—Å—Ç–æ—Ç—ã –∑–≤—É–∫–∞</li>
            <li>–¶–≤–µ—Ç–æ–≤–∞—è —à–∫–∞–ª–∞ –¥–ª–∏–Ω—ã –≤–æ–ª–Ω—ã</li>
            <li>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥—Ä–æ–º–∫–æ—Å—Ç–∏ –∫–∞–∂–¥–æ–≥–æ –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä–∞ –≤ % –æ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –≥—Ä–æ–º–∫–æ—Å—Ç–∏</li>
            </ul>
            <h3>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:</h3>
            <ul>
            <li>–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–∞—Å—Ç–æ—Ç—ã –≤ –Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è</li>
            <li><strong>–í–∞–∂–Ω–æ:</strong> –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤—ã–≤–æ–¥–æ–≤ –Ω–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è—Ö ‚Äî —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –æ—Å—Ç–∞–Ω–æ–≤–∫—É –∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫</li>
            <li>–ü–µ—Ä–µ—Ö–æ–¥ —Ñ–∞–∑—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ –Ω–æ–≤–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞</li>
            <li>–î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∞–º–ø–ª–∏—Ç—É–¥—ã –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∫–ª–∏–ø–ø–∏–Ω–≥–∞</li>
            <li>–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∫–æ–º–ø—Ä–µ—Å—Å–æ—Ä –¥–ª—è –º—è–≥–∫–æ–≥–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å–∏–≥–Ω–∞–ª–∞</li>
            <li>–ü–µ—Ä–µ–±–æ—Ä —á–∞—Å—Ç–æ—Ç: –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–µ—Ç –ø–æ 2 —á–∞—Å—Ç–æ—Ç—ã —Å –≤–≤–µ–¥—ë–Ω–Ω–æ–≥–æ –ø—Ä–µ—Å–µ—Ç–∞, –∫–∞–∂–¥—É—é –ø–∞—Ä—É —á–∞—Å—Ç–æ—Ç –ø–æ 3 –º–∏–Ω—É—Ç—ã, –ø–æ—Å–ª–µ —á–µ–≥–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è</li>
            <li>–ì—Ä–æ–º–∫–æ—Å—Ç—å –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä–æ–≤: –µ—Å–ª–∏ –ø–æ–ª–µ –≥—Ä–æ–º–∫–æ—Å—Ç–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —É–∫–∞–∑–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –∏–Ω–∞—á–µ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</li>
            <li>–§–æ—Ä–º–∞—Ç –±—ã—Å—Ç—Ä–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: "—á–∞—Å—Ç–æ—Ç–∞,–≥—Ä–æ–º–∫–æ—Å—Ç—å; —á–∞—Å—Ç–æ—Ç–∞,–≥—Ä–æ–º–∫–æ—Å—Ç—å; ..."</li>
            </ul>
            <h3>FM –º–æ–¥—É–ª—è—Ü–∏—è –≤ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–µ</h3>
            <p>–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ç–æ—á–Ω–∞—è —á–∞—Å—Ç–æ—Ç–Ω–∞—è –º–æ–¥—É–ª—è—Ü–∏—è (FM) –ø–æ —Ñ–æ—Ä–º—É–ª–µ:</p>
            <p><strong>f(t) = f‚ÇÄ + Œîf √ó sin(2œÄf‚Çòt)</strong></p>
            <p>–≥–¥–µ:</p>
            <ul>
                <li><strong>f(t)</strong> - –º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è —á–∞—Å—Ç–æ—Ç–∞</li>
                <li><strong>f‚ÇÄ</strong> - –æ—Å–Ω–æ–≤–Ω–∞—è —á–∞—Å—Ç–æ—Ç–∞ –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä–∞</li>
                <li><strong>Œîf</strong> - –¥–µ–≤–∏–∞—Ü–∏—è —á–∞—Å—Ç–æ—Ç—ã (Œîf = f‚ÇÄ √ó depth / 100)</li>
                <li><strong>f‚Çò</strong> - —á–∞—Å—Ç–æ—Ç–∞ –º–æ–¥—É–ª—è—Ü–∏–∏</li>
            </ul>
            
            <h4>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:</h4>
            <ul>
                <li><strong>–í–∫–ª—é—á–µ–Ω–∏–µ:</strong> —Ñ–ª–∞–∂–æ–∫ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç/–¥–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç FM –º–æ–¥—É–ª—è—Ü–∏—é</li>
                <li><strong>–ß–∞—Å—Ç–æ—Ç–∞ –º–æ–¥—É–ª—è—Ü–∏–∏:</strong> 0-100 –ì—Ü (—à–∞–≥ 0.001 –ì—Ü)</li>
                <li><strong>–î–µ–≤–∏–∞—Ü–∏—è:</strong> 0-5% –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π —á–∞—Å—Ç–æ—Ç—ã (—à–∞–≥ 0.01%)</li>
            </ul>
            
            <p>FM –º–æ–¥—É–ª—è—Ü–∏—è –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫–æ –≤—Å–µ–º –∞–∫—Ç–∏–≤–Ω—ã–º –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä–∞–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.</p>
            <p>–ü—Ä–æ–µ–∫—Ç —Å–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä–∞ —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —á–∞—Å—Ç–æ—Ç –∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –∫–∞—Ç—É—à–∫–∏ <strong>–†–æ–¥–æ–§–æ–Ω</strong>, —Å–¥–µ–ª–∞–Ω–Ω–æ–π –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É <strong>–ú–∞—Ä–∫–æ –†–æ–¥–∏–Ω–∞</strong>.</p>
        </div>
    </div>
    
    <div id="namePromptModal" class="name-prompt-modal">
        <div class="name-prompt-content">
            <h3>–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞</h3>
            <p>–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è –≤–∞—à–µ–≥–æ —Å–ø–∏—Å–∫–∞ —á–∞—Å—Ç–æ—Ç:</p>
            <input type="text" id="listNameInput" style="width: 100%; padding: 8px; margin: 10px 0; box-sizing: border-box;">
            <div style="display: flex; justify-content: space-between;">
                <button onclick="document.getElementById('namePromptModal').style.display = 'none'">–û—Ç–º–µ–Ω–∞</button>
                <button onclick="confirmSaveList()" style="background: #4CAF50; color: white;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è WAV -->
    <div id="wavModal" class="wav-modal">
        <div class="wav-modal-content">
            <h3 id="wavModalTitle">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–µ—Å–µ—Ç –≤ WAV —Ñ–∞–π–ª</h3>
            
            <div class="wav-options">
                <div class="wav-option">
                    <input type="checkbox" id="wavFmEnabled" checked>
                    <label for="wavFmEnabled">FM –º–æ–¥—É–ª—è—Ü–∏—è</label>
                </div>
                
                <div class="wav-option">
                    <input type="checkbox" id="wavStereo" checked>
                    <label for="wavStereo">–°—Ç–µ—Ä–µ–æ</label>
                </div>
                
                <div class="wav-option">
                    <input type="checkbox" id="wavCompress" checked>
                    <label for="wavCompress">–ö–æ–º–ø—Ä–µ—Å—Å–∏—è</label>
                </div>
            </div>
            
            <div class="wav-controls">
                <div class="wav-row">
                    <div class="wav-param">
                        <label for="wavDuration">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—Å–µ–∫):</label>
                        <input type="number" id="wavDuration" min="1" max="600" value="180" style="width: 100%;">
                    </div>
                    
                    <div class="wav-param">
                        <label for="wavSampleRate">–ß–∞—Å—Ç–æ—Ç–∞ –¥–∏—Å–∫—Ä.:</label>
                        <select id="wavSampleRate" style="width: 100%;">                          
                            <option value="48000" selected>48 kHz</option>
                            <option value="24000">24 kHz</option>
                        </select>
                    </div>
                </div>
                
                <div class="wav-row">
                    <div class="wav-param">
                        <label for="wavBitDepth">–ë–∏—Ç–æ–≤–∞—è –≥–ª—É–±–∏–Ω–∞:</label>
                        <select id="wavBitDepth" style="width: 100%;">
                            <option value="16">16 –±–∏—Ç</option>
                            <option value="24">24 –±–∏—Ç–∞</option>
                            <option value="32">32 –±–∏—Ç–∞</option>
                        </select>
                    </div>
                    
                    <div class="wav-param">
                        <label for="wavVolume">–ì—Ä–æ–º–∫–æ—Å—Ç—å (%):</label>
                        <input type="range" id="wavVolume" min="0" max="100" value="100" style="width: 100%;">
                    </div>
                </div>
            </div>
            
            <div class="progress-container">
                <div id="wavProgress" class="progress-bar"></div>
            </div>
            <p id="wavStatus">–ì–æ—Ç–æ–≤ –∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏...</p>
            
            <div style="display: flex; justify-content: space-between; margin-top: 20px;">
                <button onclick="document.getElementById('wavModal').style.display = 'none'">–û—Ç–º–µ–Ω–∞</button>
                <button onclick="startWavGeneration()" style="background: #4CAF50; color: white;">–ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>
        </div>
    </div>
    </div>

    <!-- –ü–æ–¥–≤–∞–ª (Footer) - –¢–µ–ø–µ—Ä—å —Å fixed-bottom –¥–ª—è –ø–æ–ª–Ω–æ–π —à–∏—Ä–∏–Ω—ã -->
    <footer class="footer-custom py-2 text-center fixed-bottom">
        <p class="m-0 small">–ê–≤—Ç–æ—Ä</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
    <script>
        let audioContext;
        let isPlaying = false;
        const channels = new Map();
        let currentWaveType = 'sine';
        let masterGain;
        let fmOscillator;
        let fmEnabled = false;
        let fmFreq = 0;
        let fmDepth = 0;
        let currentPresetName = null;
        let wavWorker;
        
        let isFrequencyCycling = false;
        let cycleInterval;
        let countdownInterval;
        let currentPairIndex = 0;
        let currentPairOscillators = [];
        let totalCycleTime = 0;
        let remainingTime = 0;
        let frequencyPairs = [];
        
        const frequencyListsStorageKey = 'savedFrequencyLists';
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
        let oscilloscopeCanvas, lissajousCanvas;
        let oscilloscopeCtx, lissajousCtx;
        let leftAnalyser, rightAnalyser;
        let visualizerAnimationId;
        
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
        const visualizerConfig = {
            visibleSamples: 1024,
            amplitudeScale: 0.8,
            lineWidth: 2,
            leftChannelColor: '#00ff00',
            rightChannelColor: '#ff0000'
        };
        
        function getSavedFrequencyLists() {
            const saved = localStorage.getItem(frequencyListsStorageKey);
            return saved ? JSON.parse(saved) : {};
        }
        
        function saveFrequencyLists(lists) {
            localStorage.setItem(frequencyListsStorageKey, JSON.stringify(lists));
        }
        
        function showNamePrompt() {
            document.getElementById('namePromptModal').style.display = 'block';
            document.getElementById('listNameInput').value = '';
            document.getElementById('listNameInput').focus();
        }
        
        function confirmSaveList() {
            const listName = document.getElementById('listNameInput').value.trim();
            if (!listName) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞');
                return;
            }
            
            saveCurrentList(listName);
            document.getElementById('namePromptModal').style.display = 'none';
        }
        
        function saveCurrentList(listName) {
            const frequencyItems = document.querySelectorAll('.frequency-item');
            const frequencies = [];
            
            frequencyItems.forEach(item => {
                const id = item.dataset.id;
                const freq = parseFloat(item.querySelector('.freq-range').value);
                const phaseShift = parseFloat(item.querySelector('.phase-shift').value);
                const pan = parseFloat(item.querySelector('.pan-selector').value);
                const volume = item.querySelector('.volume-input').value.trim();
                
                frequencies.push({
                    freq: parseFloat(freq.toFixed(6)),
                    phaseShift: parseFloat(phaseShift.toFixed(3)),
                    pan: parseFloat(pan.toFixed(3)),
                    volume: volume ? parseFloat(volume) : null
                });
            });
            
            const fmParams = {
                enabled: document.getElementById('fmEnabled').checked,
                freq: parseFloat(parseFloat(document.getElementById('fmFreq').value || 0).toFixed(6)),
                depth: parseFloat(parseFloat(document.getElementById('fmDepth').value || 0).toFixed(3))
            };
            
            const listData = {
                frequencies,
                fm: fmParams
            };
            
            const savedLists = getSavedFrequencyLists();
            savedLists[listName] = listData;
            saveFrequencyLists(savedLists);
            
            renderSavedLists();
            
            currentPresetName = listName;
            document.getElementById('saveToWavBtn').style.display = 'block';
            
            alert(`–°–ø–∏—Å–æ–∫ "${listName}" —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!`);
        }
        
        function renderSavedLists() {
            const savedLists = getSavedFrequencyLists();
            const container = document.getElementById('savedListsContent');
            container.innerHTML = '';
            
            if (Object.keys(savedLists).length === 0) {
                container.innerHTML = '<p>–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤</p>';
                return;
            }
            
            const sortedNames = Object.keys(savedLists).sort();
            
            sortedNames.forEach(name => {
                const containerDiv = document.createElement('div');
                containerDiv.className = 'saved-item-container';
                
                const btn = document.createElement('button');
                btn.className = 'saved-list-btn saved-item-name';
                btn.textContent = name;
                btn.onclick = () => applyFrequencyList(name, savedLists[name]);
                
                const deleteBtn = document.createElement('div');
                deleteBtn.className = 'delete-preset-btn';
                deleteBtn.textContent = '√ó';
                deleteBtn.onclick = (e) => {
                    e.stopPropagation();
                    deleteSavedList(name);
                };
                
                containerDiv.appendChild(btn);
                containerDiv.appendChild(deleteBtn);
                container.appendChild(containerDiv);
            });
        }
        
        function deleteSavedList(name) {
            if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø—Ä–µ—Å–µ—Ç "${name}"?`)) {
                const savedLists = getSavedFrequencyLists();
                delete savedLists[name];
                saveFrequencyLists(savedLists);
                renderSavedLists();
            }
        }
        
        function toggleSavedLists() {
            const content = document.getElementById('savedListsContent');
            content.style.display = content.style.display === 'block' ? 'none' : 'block';
            renderSavedLists();
        }
        
        function applyFrequencyList(listName, listData) {
        if (isPlaying) {
        togglePlayback();
        }
        if (isFrequencyCycling) {
        stopFrequencyCycle();
        }
        
        document.querySelectorAll('.frequency-item').forEach(item => item.remove());
        document.querySelectorAll('tr[data-id]').forEach(row => row.remove());
        
        listData.frequencies.forEach(item => {
        const id = createFrequencyControl(item.freq);
        
        const lastItem = document.querySelector(`.frequency-item[data-id="${id}"]`);
        
        lastItem.querySelector('.phase-shift').value = item.phaseShift;
        lastItem.querySelector('.phase-value').textContent = `${item.phaseShift}¬∞`;
        lastItem.querySelector('.pan-selector').value = item.pan;
        
        if (item.volume !== null && item.volume !== undefined) {
        lastItem.querySelector('.volume-input').value = item.volume;
        }
        
        updateVisualization(id, item.freq);
        });
        
        document.getElementById('fmEnabled').checked = listData.fm.enabled;
        document.getElementById('fmFreq').value = listData.fm.freq;
        document.getElementById('fmDepth').value = listData.fm.depth;
        updateFMParams();
        
        document.querySelectorAll('.frequency-item').forEach(item => {
        const id = item.dataset.id;
        const freq = parseFloat(item.querySelector('.freq-range').value);
        updateVisualization(id, freq);
        });
        
        currentPresetName = listName;
        document.getElementById('saveToWavBtn').style.display = 'block';
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ WAV
        document.getElementById('saveToWavBtn').textContent = 
        `–°–æ—Ö—Ä–∞–Ω–∏—Ç—å "${listName}" –≤ WAV —Ñ–∞–π–ª`;
        
        alert(`–°–ø–∏—Å–æ–∫ "${listName}" —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω!`);
        }

        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                masterGain = audioContext.createGain();
                masterGain.gain.value = 0.8;
                masterGain.connect(audioContext.destination);
                
                // –°–æ–∑–¥–∞–µ–º –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä—ã –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
                const splitter = audioContext.createChannelSplitter(2);
                masterGain.connect(splitter);
                
                leftAnalyser = audioContext.createAnalyser();
                rightAnalyser = audioContext.createAnalyser();
                leftAnalyser.fftSize = 2048;
                rightAnalyser.fftSize = 2048;
                
                splitter.connect(leftAnalyser, 0);
                splitter.connect(rightAnalyser, 1);
                
                fmOscillator = audioContext.createOscillator();
                fmOscillator.type = 'sine';
                fmOscillator.frequency.value = 0;
                fmOscillator.start();
            }
        }

        function createOscillatorChain(freq, pan, phaseShift = 0, volume = null) {
            const oscillator = audioContext.createOscillator();
            const panner = audioContext.createStereoPanner();
            const delayNode = audioContext.createDelay();
            const gainNode = audioContext.createGain();
            
            oscillator.type = currentWaveType;
            oscillator.frequency.setValueAtTime(freq, audioContext.currentTime);
            panner.pan.value = pan;
            delayNode.delayTime.value = phaseShift / (360 * freq);
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≥—Ä–æ–º–∫–æ—Å—Ç—å: –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–∞ - –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ—ë, –∏–Ω–∞—á–µ 1 (–±—É–¥–µ—Ç –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–æ)
            if (volume !== null && volume !== undefined) {
                gainNode.gain.value = volume / 100; // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç—ã –≤ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç
            } else {
                gainNode.gain.value = 1;
            }
            
            oscillator.connect(delayNode);
            delayNode.connect(gainNode);
            gainNode.connect(panner);
            panner.connect(masterGain);
            
            let fmGain = null;
            if (fmEnabled) {
                const deviation = freq * (fmDepth / 100);
                
                fmGain = audioContext.createGain();
                fmGain.gain.value = deviation;
                
                fmOscillator.connect(fmGain);
                fmGain.connect(oscillator.frequency);
            }
            
            return { 
                oscillator, 
                panner, 
                delayNode, 
                gainNode,
                fmGain,
                panValue: pan,
                volume: volume
            };
        }

        function calculateLightParameters(frequency) {
            const C = 299792458;
            let lightFreq = frequency;
            let octaves = 0;

            while (lightFreq < 400e12 && octaves++ < 50) lightFreq *= 2;

            const wavelength = (C / lightFreq) * 1e9;

            if (wavelength >= 380 && wavelength <= 780) {
                return {
                    lightFreq: lightFreq / 1e12,
                    wavelength: wavelength.toFixed(1) + ' –Ω–º',
                    color: wavelengthToColor(wavelength)
                };
            }
            return null;
        }

        function wavelengthToColor(wl) {
            wl = Math.max(380, Math.min(780, wl));
            let r, g, b, factor;

            if (wl < 440) {
                r = (wl - 380) / 60; g = 0; b = 1;
            } else if (wl < 490) {
                r = 0; g = (wl - 440) / 50; b = 1;
            } else if (wl < 510) {
                r = 0; g = 1; b = (510 - wl) / 20;
            } else if (wl < 580) {
                r = (wl - 510) / 70; g = 1; b = 0;
            } else if (wl < 645) {
                r = 1; g = (645 - wl) / 65; b = 0;
            } else {
                r = 1; g = 0; b = 0;
            }

            factor = wl > 700 ? 0.3 : wl < 420 ? 0.3 + 0.7 * (wl - 380) / 40 : 1;
            const gamma = 0.8;

            return `rgb(${[
                Math.round(255 * Math.pow(r * factor, gamma)),
                Math.round(255 * Math.pow(g * factor, gamma)),
                Math.round(255 * Math.pow(b * factor, gamma))
            ].join(',')})`;
        }

        function updateVisualization(id, frequency) {
            const data = calculateLightParameters(frequency);
            const row = document.querySelector(`tr[data-id="${id}"]`);
            if (!data || !row) return;

            const formattedFrequency = parseFloat(frequency.toFixed(6)).toLocaleString('ru-RU', {
                minimumFractionDigits: 3,
                maximumFractionDigits: 6
            });

            row.innerHTML = `
                <td>${formattedFrequency}</td>
                <td>${data.lightFreq.toFixed(3)}</td>
                <td>${data.wavelength}</td>
                <td><div class="color-box" style="background:${data.color}"></div></td>
            `;
        }

        function updateDividers() {
            const container = document.getElementById('frequencyControls');
            const items = container.querySelectorAll('.frequency-item');
            container.querySelectorAll('.divider').forEach(div => div.remove());
            items.forEach((item, index) => {
                if (index < items.length - 1) {
                    const divider = document.createElement('div');
                    divider.className = 'divider';
                    item.after(divider);
                }
            });
        }

        function createFrequencyControl(defaultFrequency = 432, defaultVolume = null) {
            const id = Date.now().toString();
            const div = document.createElement('div');
            div.className = 'frequency-item';
            div.dataset.id = id;
            
            const volumeValue = defaultVolume !== null ? defaultVolume : '';
            
            div.innerHTML = `
                <input type="range" class="freq-range" min="1" max="20000" value="${defaultFrequency}" step="0.001" style="width: 120px;">
                <input type="number" class="freq-number" value="${defaultFrequency}" step="0.001" style="width: 80px;">
                <br>
                <div class="phase-control">
                    <input type="range" class="phase-shift" min="0" max="180" value="0" step="0.1" style="width: 160px;">
                    <span class="phase-value">0¬∞</span>
                </div>
                <select class="pan-selector" style="width: 45px;">
                    <option value="-1">L</option>
                    <option value="0" selected>C</option>
                    <option value="1">R</option>
                </select>
                <div class="volume-control">
                    <span class="volume-icon">üîä</span>
                    <input type="number" class="volume-input" min="0" max="100" value="${volumeValue}" placeholder="%" title="–ì—Ä–æ–º–∫–æ—Å—Ç—å –≤ % (–æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –∞–≤—Ç–æ)">
                </div>
                <button class="remove-btn" onclick="removeFrequency('${id}')">√ó</button>
            `;

            const freqRange = div.querySelector('.freq-range');
            const freqNumber = div.querySelector('.freq-number');
            const phaseShift = div.querySelector('.phase-shift');
            const phaseValue = div.querySelector('.phase-value');
            const volumeInput = div.querySelector('.volume-input');

            freqNumber.addEventListener('input', () => {
                const sanitized = freqNumber.value.replace(',', '.');
                const val = parseFloat(sanitized);
                if (!isNaN(val)) {
                    freqRange.value = val;
                    updateVisualization(id, val);
                    if (channels.has(id)) {
                        channels.get(id).oscillator.frequency.setValueAtTime(val, audioContext.currentTime);
                        
                        if (fmEnabled && channels.get(id).fmGain) {
                            const deviation = val * (fmDepth / 100);
                            channels.get(id).fmGain.gain.value = deviation;
                        }
                    }
                }
            });

            freqRange.addEventListener('input', () => {
                const val = parseFloat(freqRange.value);
                freqNumber.value = val;
                updateVisualization(id, val);
                if (channels.has(id)) {
                    channels.get(id).oscillator.frequency.setValueAtTime(val, audioContext.currentTime);
                    
                    if (fmEnabled && channels.get(id).fmGain) {
                        const deviation = val * (fmDepth / 100);
                        channels.get(id).fmGain.gain.value = deviation;
                    }
                }
            });

            phaseShift.addEventListener('input', () => {
                const deg = parseFloat(phaseShift.value);
                phaseValue.textContent = `${deg.toFixed(1)}¬∞`;
                if (channels.has(id)) {
                    const { oscillator, delayNode } = channels.get(id);
                    const freq = oscillator.frequency.value;
                    delayNode.delayTime.value = deg / (360 * freq);
                }
            });

            volumeInput.addEventListener('input', () => {
                if (channels.has(id)) {
                    const volumeValue = volumeInput.value.trim();
                    if (volumeValue === '') {
                        // –ï—Å–ª–∏ –ø–æ–ª–µ –ø—É—Å—Ç–æ–µ - –∏—Å–ø–æ–ª—å–∑—É–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é
                        recalculateGains();
                    } else {
                        const volume = parseFloat(volumeValue);
                        if (!isNaN(volume) && volume >= 0 && volume <= 100) {
                            channels.get(id).gainNode.gain.value = volume / 100;
                        }
                    }
                }
            });

            document.getElementById('frequencyControls').appendChild(div);
            updateDividers();

            const row = document.createElement('tr');
            row.dataset.id = id;
            document.getElementById('results').appendChild(row);
            updateVisualization(id, defaultFrequency);
            
            return id;
        }

        function removeFrequency(id) {
            document.querySelector(`.frequency-item[data-id="${id}"]`)?.remove();
            document.querySelector(`tr[data-id="${id}"]`)?.remove();
            if (channels.has(id)) {
                channels.get(id).oscillator.stop();
                channels.delete(id);
                recalculateGains(); // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –≥—Ä–æ–º–∫–æ—Å—Ç–∏ –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è
            }
            updateDividers();
        }

        function setWaveType(type) {
            currentWaveType = type;
            
            document.querySelectorAll('.wave-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`${type}Btn`).classList.add('active');
            
            if (isPlaying) {
                channels.forEach(chain => {
                    chain.oscillator.type = type;
                });
            }
            
            if (isFrequencyCycling) {
                currentPairOscillators.forEach(chain => {
                    chain.oscillator.type = type;
                });
            }
        }
        
        function togglePlayback() {
            if (isFrequencyCycling) {
                stopFrequencyCycle();
            }
            
            initAudio();
            isPlaying = !isPlaying;
            const toggleBtn = document.getElementById('toggleBtn');
            toggleBtn.textContent = isPlaying ? '–°—Ç–æ–ø' : '–°—Ç–∞—Ä—Ç';
            toggleBtn.classList.toggle('active', isPlaying);
            
            document.getElementById('addFrequency').disabled = isPlaying;
            document.getElementById('cycleFrequencies').disabled = isPlaying;
            toggleBtn.disabled = false;
            
            if (isPlaying) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –ø–æ–ª–µ –≥—Ä–æ–º–∫–æ—Å—Ç–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ–µ
                const hasCustomVolumes = Array.from(document.querySelectorAll('.volume-input'))
                    .some(input => input.value.trim() !== '');
                
                if (hasCustomVolumes) {
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≥—Ä–æ–º–∫–æ—Å—Ç–∏
                    document.querySelectorAll('.frequency-item').forEach(item => {
                        const id = item.dataset.id;
                        const freq = parseFloat(item.querySelector('.freq-range').value);
                        const pan = parseFloat(item.querySelector('.pan-selector').value);
                        const deg = parseFloat(item.querySelector('.phase-shift').value);
                        const volumeInput = item.querySelector('.volume-input');
                        const volumeValue = volumeInput.value.trim();
                        
                        let volume = null;
                        if (volumeValue !== '') {
                            volume = parseFloat(volumeValue);
                            if (isNaN(volume) || volume < 0 || volume > 100) {
                                volume = 100; // –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –µ—Å–ª–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ
                            }
                        }
                        
                        const chain = createOscillatorChain(freq, pan, deg, volume);
                        channels.set(id, chain);
                        chain.oscillator.start();
                    });
                } else {
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é
                    recalculateGains();
                }
            } else {
                channels.forEach(chain => {
                    chain.oscillator.stop();
                });
                channels.clear();
                document.getElementById('addFrequency').disabled = false;
                document.getElementById('cycleFrequencies').disabled = false;
            }
            
            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π
            if (isPlaying) {
                oscilloscopeCtx.clearRect(0, 0, oscilloscopeCanvas.width, oscilloscopeCanvas.height);
                lissajousCtx.clearRect(0, 0, lissajousCanvas.width, lissajousCanvas.height);
                
                visualizerAnimationId = requestAnimationFrame(drawVisualizer);
            } else {
                cancelAnimationFrame(visualizerAnimationId);
            }
        }

        function recalculateGains() {
            if (!isPlaying) return;
            
            // –í—ã—á–∏—Å–ª—è–µ–º —Å—É–º–º–∞—Ä–Ω—ã–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –¥–ª—è –ª–µ–≤–æ–≥–æ –∏ –ø—Ä–∞–≤–æ–≥–æ –∫–∞–Ω–∞–ª–æ–≤
            let totalLeftGain = 0;
            let totalRightGain = 0;
            
            document.querySelectorAll('.frequency-item').forEach(item => {
                const pan = parseFloat(item.querySelector('.pan-selector').value);
                const leftGain = pan <= 0 ? 1 : 1 - pan;
                const rightGain = pan >= 0 ? 1 : 1 + pan;
                totalLeftGain += leftGain;
                totalRightGain += rightGain;
            });
            
            const maxGain = Math.max(totalLeftGain, totalRightGain, 1);
            const gainValue = 1 / maxGain;
            
            document.querySelectorAll('.frequency-item').forEach(item => {
                const id = item.dataset.id;
                const freq = parseFloat(item.querySelector('.freq-range').value);
                const pan = parseFloat(item.querySelector('.pan-selector').value);
                const deg = parseFloat(item.querySelector('.phase-shift').value);
                
                if (!channels.has(id)) {
                    const chain = createOscillatorChain(freq, pan, deg, null);
                    channels.set(id, chain);
                    chain.oscillator.start();
                }
                
                channels.get(id).gainNode.gain.value = gainValue;
            });
        }

        function startFrequencyCycle() {
            if (isPlaying) {
                togglePlayback();
            }
            
            const frequencyItems = document.querySelectorAll('.frequency-item');
            if (frequencyItems.length === 0) {
                alert('–î–æ–±–∞–≤—å—Ç–µ —á–∞—Å—Ç–æ—Ç—ã –¥–ª—è –ø–µ—Ä–µ–±–æ—Ä–∞');
                return;
            }
            
            frequencyPairs = [];
            const frequencies = [];
            
            frequencyItems.forEach(item => {
                const id = item.dataset.id;
                const freq = parseFloat(item.querySelector('.freq-range').value);
                const phaseShift = parseFloat(item.querySelector('.phase-shift').value);
                const pan = parseFloat(item.querySelector('.pan-selector').value);
                const volumeInput = item.querySelector('.volume-input');
                const volumeValue = volumeInput.value.trim();
                let volume = null;
                if (volumeValue !== '') {
                    volume = parseFloat(volumeValue);
                    if (isNaN(volume) || volume < 0 || volume > 100) {
                        volume = 100;
                    }
                }
                
                frequencies.push({ id, freq, phaseShift, pan, volume });
            });
            
            for (let i = 0; i < frequencies.length; i += 2) {
                const pair = frequencies.slice(i, i + 2);
                frequencyPairs.push(pair);
            }
            
            if (frequencyPairs.length === 0) return;
            
            totalCycleTime = frequencyPairs.length * 3 * 60;
            remainingTime = totalCycleTime;
            
            isFrequencyCycling = true;
            const cycleBtn = document.getElementById('cycleFrequencies');
            cycleBtn.classList.add('active');
            cycleBtn.textContent = formatTime(remainingTime);
            
            document.getElementById('addFrequency').disabled = true;
            document.getElementById('toggleBtn').disabled = true;
            cycleBtn.disabled = false;
            
            currentPairIndex = 0;
            playFrequencyPair(frequencyPairs[currentPairIndex]);
            
            cycleInterval = setInterval(() => {
                stopCurrentPair();
                currentPairIndex++;
                
                if (currentPairIndex < frequencyPairs.length) {
                    playFrequencyPair(frequencyPairs[currentPairIndex]);
                } else {
                    stopFrequencyCycle();
                }
            }, 3 * 60 * 1000);
            
            countdownInterval = setInterval(() => {
                remainingTime--;
                cycleBtn.textContent = formatTime(remainingTime);
                
                if (remainingTime <= 0) {
                    clearInterval(countdownInterval);
                }
            }, 1000);
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é
            visualizerAnimationId = requestAnimationFrame(drawVisualizer);
        }
        
        function stopFrequencyCycle() {
            clearInterval(cycleInterval);
            clearInterval(countdownInterval);
            stopCurrentPair();
            
            isFrequencyCycling = false;
            const cycleBtn = document.getElementById('cycleFrequencies');
            cycleBtn.classList.remove('active');
            cycleBtn.textContent = '–ø–µ—Ä–µ–±–æ—Ä —á–∞—Å—Ç–æ—Ç';
            
            document.getElementById('addFrequency').disabled = false;
            document.getElementById('toggleBtn').disabled = false;
            cycleBtn.disabled = false;
            
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é
            cancelAnimationFrame(visualizerAnimationId);
        }
        
        function playFrequencyPair(pair) {
            initAudio();
            stopCurrentPair();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≥—Ä–æ–º–∫–æ—Å—Ç–∏
            const hasCustomVolumes = pair.some(freqItem => freqItem.volume !== null);
            
            if (hasCustomVolumes) {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≥—Ä–æ–º–∫–æ—Å—Ç–∏
                currentPairOscillators = [];
                pair.forEach(freqItem => {
                    const { freq, pan, phaseShift, volume } = freqItem;
                    const chain = createOscillatorChain(freq, pan, phaseShift, volume);
                    chain.oscillator.start();
                    currentPairOscillators.push(chain);
                });
            } else {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é
                let leftSum = 0;
                let rightSum = 0;
                
                pair.forEach(freqItem => {
                    const pan = freqItem.pan;
                    leftSum += pan <= 0 ? 1 : 1 - pan;
                    rightSum += pan >= 0 ? 1 : 1 + pan;
                });
                
                const maxSum = Math.max(leftSum, rightSum, 1);
                const normalizationFactor = 1 / maxSum;
                
                currentPairOscillators = [];
                pair.forEach(freqItem => {
                    const { freq, pan, phaseShift } = freqItem;
                    const chain = createOscillatorChain(freq, pan, phaseShift, null);
                    chain.gainNode.gain.value = normalizationFactor * 0.5;
                    chain.oscillator.start();
                    currentPairOscillators.push(chain);
                });
            }
        }
        
        function stopCurrentPair() {
            currentPairOscillators.forEach(chain => {
                try {
                    chain.oscillator.stop();
                    chain.oscillator.disconnect();
                    
                    if (chain.fmGain) {
                        chain.fmGain.disconnect();
                    }
                } catch (e) {
                    console.log("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä–∞", e);
                }
            });
            currentPairOscillators = [];
        }
        
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
        }
        
        function exportPresets() {
            const fileName = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ (–±–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è)', 'frequency') || 'frequency';
            const fullFileName = `${fileName}.csv`;
            
            const savedLists = getSavedFrequencyLists();
            
            let csvContent = "preset_name,freq,phase,pan,volume,fm_enabled,fm_freq,fm_depth\n";
            
            for (const [presetName, presetData] of Object.entries(savedLists)) {
                const fmEnabled = presetData.fm.enabled ? 1 : 0;
                const fmFreq = parseFloat(presetData.fm.freq).toFixed(6);
                const fmDepth = parseFloat(presetData.fm.depth).toFixed(3);
                
                presetData.frequencies.forEach(freqItem => {
                    const { freq, phaseShift, pan, volume } = freqItem;
                    const formattedFreq = parseFloat(freq).toFixed(6);
                    const formattedPhase = parseFloat(phaseShift).toFixed(3);
                    const formattedPan = parseFloat(pan).toFixed(3);
                    const formattedVolume = volume !== null ? volume.toString() : '';
                    
                    csvContent += `"${presetName}",${formattedFreq},${formattedPhase},${formattedPan},${formattedVolume},${fmEnabled},${fmFreq},${fmDepth}\n`;
                });
            }
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            
            link.setAttribute("href", url);
            link.setAttribute("download", fullFileName);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }
        
        function importPresets(file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const content = e.target.result;
                const lines = content.split('\n').filter(line => line.trim() !== '');
                
                if (lines.length < 1 || !lines[0].includes('preset_name')) {
                    alert('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç CSV —Ñ–∞–π–ª–∞');
                    return;
                }
                
                const newPresets = {};
                
                for (let i = 1; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (!line) continue;
                    
                    const values = line.split(',');
                    if (values.length < 8) continue;
                    
                    const presetName = values[0].replace(/^"|"$/g, '');
                    const freq = parseFloat(values[1]);
                    const phase = parseFloat(values[2]);
                    const pan = parseFloat(values[3]);
                    const volumeStr = values[4].trim();
                    const volume = volumeStr !== '' ? parseFloat(volumeStr) : null;
                    const fmEnabled = parseInt(values[5]) === 1;
                    const fmFreq = parseFloat(values[6]);
                    const fmDepth = parseFloat(values[7]);
                    
                    if (!newPresets[presetName]) {
                        newPresets[presetName] = {
                            frequencies: [],
                            fm: { enabled: fmEnabled, freq: fmFreq, depth: fmDepth }
                        };
                    }
                    
                    newPresets[presetName].frequencies.push({
                        freq: parseFloat(freq.toFixed(6)),
                        phaseShift: parseFloat(phase.toFixed(3)),
                        pan: parseFloat(pan.toFixed(3)),
                        volume: volume
                    });
                }
                
                const savedLists = getSavedFrequencyLists();
                const mergedPresets = { ...savedLists, ...newPresets };
                saveFrequencyLists(mergedPresets);
                renderSavedLists();
                alert('–ü—Ä–µ—Å–µ—Ç—ã —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!');
            };
            
            reader.readAsText(file);
        }
        
        function toggleInfo() {
            const content = document.getElementById('infoContent');
            content.style.display = content.style.display === 'block' ? 'none' : 'block';
        }
        
        function savePresetFromString() {
            const input = document.getElementById('quickPresetInput').value.trim();
            if (!input) {
                alert('–í–≤–µ–¥–∏—Ç–µ —á–∞—Å—Ç–æ—Ç—ã');
                return;
            }

            // –ü–∞—Ä—Å–∏–º —Å—Ç—Ä–æ–∫—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ: "—á–∞—Å—Ç–æ—Ç–∞,–≥—Ä–æ–º–∫–æ—Å—Ç—å; —á–∞—Å—Ç–æ—Ç–∞,–≥—Ä–æ–º–∫–æ—Å—Ç—å; ..."
            const frequencyPairs = input.split(';').map(pair => pair.trim()).filter(pair => pair !== '');
            const frequencies = [];
            
            for (let i = 0; i < frequencyPairs.length; i++) {
                const pair = frequencyPairs[i];
                const parts = pair.split(',').map(part => part.trim());
                
                if (parts.length < 1) continue;
                
                // –ü–∞—Ä—Å–∏–º —á–∞—Å—Ç–æ—Ç—É
                const freqStr = parts[0].replace(',', '.');
                const freq = parseFloat(freqStr);
                if (isNaN(freq)) {
                    alert(`–ù–µ–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç–æ—Ç–∞: ${parts[0]}`);
                    return;
                }
                
                // –ü–∞—Ä—Å–∏–º –≥—Ä–æ–º–∫–æ—Å—Ç—å (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–∞)
                let volume = null;
                if (parts.length >= 2) {
                    const volumeStr = parts[1].replace(',', '.');
                    volume = parseFloat(volumeStr);
                    if (isNaN(volume) || volume < 0 || volume > 100) {
                        alert(`–ù–µ–≤–µ—Ä–Ω–∞—è –≥—Ä–æ–º–∫–æ—Å—Ç—å: ${parts[1]}. –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç 0 –¥–æ 100`);
                        return;
                    }
                }
                
                // –°–æ–∑–¥–∞–µ–º –ø–∞—Ä—É –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä–æ–≤ –¥–ª—è —Å—Ç–µ—Ä–µ–æ —ç—Ñ—Ñ–µ–∫—Ç–∞
                frequencies.push({
                    freq: freq,
                    phaseShift: 0,
                    pan: -1,
                    volume: volume
                });
                
                frequencies.push({
                    freq: freq,
                    phaseShift: 90,
                    pan: 1,
                    volume: volume
                });
            }

            const fmParams = {
                enabled: false,
                freq: 0,
                depth: 0
            };

            const presetName = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ—Å–µ—Ç–∞ –¥–ª—è –≤–≤–µ–¥—ë–Ω–Ω–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —á–∞—Å—Ç–æ—Ç:');
            if (!presetName) return;

            const presetData = {
                frequencies,
                fm: fmParams
            };

            const savedLists = getSavedFrequencyLists();
            savedLists[presetName] = presetData;
            saveFrequencyLists(savedLists);
            renderSavedLists();
            document.getElementById('quickPresetInput').value = '';
            alert(`–ü—Ä–µ—Å–µ—Ç "${presetName}" —Å–æ—Ö—Ä–∞–Ω–µ–Ω!`);
        }

        function initScrollTopButton() {
            const scrollBtn = document.getElementById('scrollToTopBtn');
            
            window.addEventListener('scroll', () => {
                if (window.scrollY > 300) {
                    scrollBtn.style.display = 'block';
                } else {
                    scrollBtn.style.display = 'none';
                }
            });
            
            scrollBtn.addEventListener('click', () => {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            });
        }
        
        function toggleAccordion(id) {
            const content = document.getElementById(id);
            const btn = content.previousElementSibling;
            
            if (content.style.display === 'block') {
                content.style.display = 'none';
                btn.classList.remove('expanded');
            } else {
                content.style.display = 'block';
                btn.classList.add('expanded');
            }
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ WAV
        function openWavModal() {
        if (!currentPresetName) {
        alert('–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –ø—Ä–µ—Å–µ—Ç');
        return;
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å –∏–º–µ–Ω–µ–º –ø—Ä–µ—Å–µ—Ç–∞
        document.querySelector('.wav-modal-content h3').textContent = 
        `–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–µ—Å–µ—Ç "${currentPresetName}" –≤ WAV —Ñ–∞–π–ª`;
        
        // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º FM –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏
        document.getElementById('wavFmEnabled').checked = document.getElementById('fmEnabled').checked;
        document.getElementById('wavModal').style.display = 'block';
        }
        
        function startWavGeneration() {
        console.log('=== DEBUG WAV GENERATION ===');
        console.log('currentPresetName:', currentPresetName);
        console.log('waveType:', currentWaveType);
        console.log('fmEnabled:', document.getElementById('wavFmEnabled').checked);
        
        const preset = getSavedFrequencyLists()[currentPresetName];
        if (!preset) {
        alert('–ü—Ä–µ—Å–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω: ' + currentPresetName);
        return;
        }        
        
        const config = {
        presetName: currentPresetName, // ‚úÖ –ê–∫—Ç—É–∞–ª—å–Ω–æ–µ –∏–º—è –ø—Ä–µ—Å–µ—Ç–∞
        frequencies: preset.frequencies,
        waveType: currentWaveType, // ‚úÖ –ê–∫—Ç—É–∞–ª—å–Ω—ã–π —Ç–∏–ø –≤–æ–ª–Ω—ã
        fmEnabled: document.getElementById('wavFmEnabled').checked, // ‚úÖ –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ FM –∏–∑ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        fmFreq: parseFloat(document.getElementById('fmFreq').value),
        fmDepth: parseFloat(document.getElementById('fmDepth').value),duration: parseFloat(document.getElementById('wavDuration').value),
        sampleRate: parseInt(document.getElementById('wavSampleRate').value),
        bitDepth: parseInt(document.getElementById('wavBitDepth').value),
        volume: parseFloat(document.getElementById('wavVolume').value) / 100,
        stereo: document.getElementById('wavStereo').checked,
        //normalize: document.getElementById('wavNormalize').checked,
        compress: document.getElementById('wavCompress').checked
        };
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –≤ Web Worker
        if (!wavWorker) {
        wavWorker = new Worker(URL.createObjectURL(new Blob([
        `(${wavWorkerFunction.toString()})()`
        ], {type: 'application/javascript'})));
        
        wavWorker.onmessage = function(e) {
        if (e.data.type === 'progress') {
        document.getElementById('wavProgress').style.width = `${e.data.value}%`;
        document.getElementById('wavStatus').textContent = `–ì–µ–Ω–µ—Ä–∞—Ü–∏—è: ${Math.round(e.data.value)}%`;
        }
        else if (e.data.type === 'complete') {
        const blob = new Blob([e.data.wavData], { type: 'audio/wav' });
        const url = URL.createObjectURL(blob);
        
        const a = document.createElement('a');
        a.href = url;
        a.download = generateWavFilename();
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        document.getElementById('wavStatus').textContent = '–ì–æ—Ç–æ–≤–æ! –§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω';
        setTimeout(() => {
        document.getElementById('wavModal').style.display = 'none';
        }, 2000);
        }
        else if (e.data.type === 'error') {
        document.getElementById('wavStatus').textContent = '–û—à–∏–±–∫–∞: ' + e.data.message;
        }
        };
        }
        
        document.getElementById('wavStatus').textContent = '–ù–∞—á–∞–ª–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏...';
        wavWorker.postMessage(config);
        }
        
        function generateWavFilename() {
        // –í—Å–µ–≥–¥–∞ –ø–æ–ª—É—á–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –º–æ–º–µ–Ω—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
        const presetName = currentPresetName || 'unknown';
        const waveType = currentWaveType;
        const fmEnabled = document.getElementById('wavFmEnabled').checked;
        
        const waveChar = waveType === 'sine' ? 's' : 'm';
        const fmChar = fmEnabled ? 'f' : '';
        
        return `${presetName}_${waveChar}${fmChar}.wav`;
        }
        
        // Web Worker —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ WAV
        function wavWorkerFunction() {
            self.onmessage = function(e) {
                const config = e.data;
                const sampleRate = config.sampleRate;
                const duration = config.duration;
                const numSamples = Math.floor(duration * sampleRate);
                const numChannels = config.stereo ? 2 : 1;
                const buffer = new ArrayBuffer(44 + numSamples * numChannels * 2);
                const view = new DataView(buffer);
                
                // Write WAV header
                function writeString(view, offset, string) {
                    for (let i = 0; i < string.length; i++) {
                        view.setUint8(offset + i, string.charCodeAt(i));
                    }
                }
                
                writeString(view, 0, 'RIFF');
                view.setUint32(4, 36 + numSamples * numChannels * 2, true);
                writeString(view, 8, 'WAVE');
                writeString(view, 12, 'fmt ');
                view.setUint32(16, 16, true);
                view.setUint16(20, 1, true); // PCM format
                view.setUint16(22, numChannels, true);
                view.setUint32(24, sampleRate, true);
                view.setUint32(28, sampleRate * numChannels * 2, true); // byte rate
                view.setUint16(32, numChannels * 2, true); // block align
                view.setUint16(34, 16, true); // bits per sample
                writeString(view, 36, 'data');
                view.setUint32(40, numSamples * numChannels * 2, true);
                
                // Generate audio data
                const dataOffset = 44;
                const samples = new Float32Array(numSamples * numChannels);
                const volume = config.volume;
                
                // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —á–∞—Å—Ç–æ—Ç—ã —Å FM –º–æ–¥—É–ª—è—Ü–∏–µ–π
                function calculateFrequency(baseFreq, time, fmFreq, fmDepth) {
                    if (!config.fmEnabled) return baseFreq;
                    return baseFreq + baseFreq * (fmDepth / 100) * Math.sin(2 * Math.PI * fmFreq * time);
                }
                
                // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
                for (let i = 0; i < numSamples; i++) {
                    const time = i / sampleRate;
                    
                    // –°—É–º–º–∏—Ä—É–µ–º –≤—Å–µ —á–∞—Å—Ç–æ—Ç—ã
                    for (const freq of config.frequencies) {
                        const effectiveFreq = calculateFrequency(freq.freq, time, config.fmFreq, config.fmDepth);
                        const phaseShift = freq.phaseShift * (Math.PI / 180);
                        let channelValue = 0;
                        
                        if (config.waveType === 'sine') {
                            channelValue = Math.sin(2 * Math.PI * effectiveFreq * time + phaseShift);
                        } else { // square wave
                            const period = 1 / effectiveFreq;
                            const position = (time % period) / period;
                            channelValue = position < 0.5 ? 1 : -1;
                        }
                        
                        // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫—É—é –≥—Ä–æ–º–∫–æ—Å—Ç—å –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–∞
                        let gain = 1;
                        if (freq.volume !== null && freq.volume !== undefined) {
                            gain = freq.volume / 100;
                        }
                        
                        channelValue *= gain;
                        
                        // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–∞–Ω–æ—Ä–∞–º–∏—Ä–æ–≤–∞–Ω–∏–µ
                        if (config.stereo) {
                            const pan = freq.pan;
                            const leftGain = pan <= 0 ? 1 : 1 - pan;
                            const rightGain = pan >= 0 ? 1 : 1 + pan;
                            
                            samples[i * numChannels] += channelValue * leftGain;
                            samples[i * numChannels + 1] += channelValue * rightGain;
                        } else {
                            samples[i] += channelValue;
                        }
                    }
                    
                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –∫–∞–∂–¥—ã–µ 1000 —Å—ç–º–ø–ª–æ–≤
                    if (i % 1000 === 0) {
                        const progress = (i / numSamples) * 100;
                        self.postMessage({ type: 'progress', value: progress });
                    }
                }
                
                // –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è —É–º–Ω–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è
                // –£–º–Ω–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è - –ø—Ä–æ–≤–µ—Ä—è–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –∞–º–ø–ª–∏—Ç—É–¥—É
                let maxAmplitude = 0;
                for (let i = 0; i < samples.length; i++) {
                if (Math.abs(samples[i]) > maxAmplitude) maxAmplitude = Math.abs(samples[i]);
                }
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–∏—Ç—É–∞—Ü–∏–∏
                if (maxAmplitude > 1.0) {
                // –°–ª—É—á–∞–π 1: –û–±–Ω–∞—Ä—É–∂–µ–Ω –∫–ª–∏–ø–ø–∏–Ω–≥ - –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º –¥–æ 0.99
                const normalizeFactor = 0.99 / maxAmplitude;
                for (let i = 0; i < samples.length; i++) {
                samples[i] *= normalizeFactor * volume;
                }
                console.log(`–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç –∫–ª–∏–ø–ø–∏–Ω–≥–∞: ${maxAmplitude.toFixed(3)} ‚Üí 0.99`);
                } else if (maxAmplitude > 0 && maxAmplitude < 1.0) {
                // –°–ª—É—á–∞–π 2: –°–∏–≥–Ω–∞–ª —Ç–∏—Ö–∏–π - —É—Å–∏–ª–∏–≤–∞–µ–º –¥–æ 1.0
                const normalizeFactor = 1.0 / maxAmplitude;
                for (let i = 0; i < samples.length; i++) {
                samples[i] *= normalizeFactor * volume;
                }
                console.log(`–£—Å–∏–ª–µ–Ω–∏–µ —Ç–∏—Ö–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞: ${maxAmplitude.toFixed(3)} ‚Üí 1.0`);
                } else if (maxAmplitude === 1.0) {
                // –°–ª—É—á–∞–π 3: –ò–¥–µ–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å - –ø—Ä–æ—Å—Ç–æ –ø—Ä–∏–º–µ–Ω—è–µ–º –≥—Ä–æ–º–∫–æ—Å—Ç—å
                for (let i = 0; i < samples.length; i++) {
                samples[i] *= volume;
                }
                console.log('–ò–¥–µ–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å, –ø—Ä–∏–º–µ–Ω—è–µ–º –≥—Ä–æ–º–∫–æ—Å—Ç—å');
                } else {
                // –°–ª—É—á–∞–π 4: –¢–∏—à–∏–Ω–∞ (maxAmplitude = 0)
                for (let i = 0; i < samples.length; i++) {
                samples[i] *= volume;
                }
                console.log('–¢–∏—Ö–∏–π —Å–∏–≥–Ω–∞–ª, –ø—Ä–∏–º–µ–Ω—è–µ–º –≥—Ä–æ–º–∫–æ—Å—Ç—å');
                }
                
                // –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –≤ –±—É—Ñ–µ—Ä
                let index = dataOffset;
                for (let i = 0; i < samples.length; i++) {
                    const s = Math.max(-1, Math.min(1, samples[i]));
                    const val = s < 0 ? s * 32768 : s * 32767;
                    view.setInt16(index, val, true);
                    index += 2;
                }
                
                self.postMessage({ type: 'complete', wavData: buffer });
            };
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä–∞
        function initVisualizer() {
            oscilloscopeCanvas = document.getElementById('oscilloscopeCanvas');
            lissajousCanvas = document.getElementById('lissajousCanvas');
            oscilloscopeCtx = oscilloscopeCanvas.getContext('2d');
            lissajousCtx = lissajousCanvas.getContext('2d');
            
            oscilloscopeCanvas.width = oscilloscopeCanvas.offsetWidth;
            oscilloscopeCanvas.height = oscilloscopeCanvas.offsetHeight;
            
            lissajousCanvas.width = lissajousCanvas.offsetWidth;
            lissajousCanvas.height = lissajousCanvas.offsetHeight;
        }
        
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä–∞ —Å –¥–≤—É–º—è –∫–∞–Ω–∞–ª–∞–º–∏
        function drawVisualizer() {
            if (!isPlaying && !isFrequencyCycling) {
                cancelAnimationFrame(visualizerAnimationId);
                return;
            }
            
            if (!leftAnalyser || !rightAnalyser) return;
            
            const oscWidth = oscilloscopeCanvas.width;
            const oscHeight = oscilloscopeCanvas.height;
            const lissWidth = lissajousCanvas.width;
            const lissHeight = lissajousCanvas.height;
            
            oscilloscopeCtx.clearRect(0, 0, oscWidth, oscHeight);
            lissajousCtx.clearRect(0, 0, lissWidth, lissHeight);
            
            const bufferLength = leftAnalyser.fftSize;
            const leftData = new Uint8Array(bufferLength);
            const rightData = new Uint8Array(bufferLength);
            
            leftAnalyser.getByteTimeDomainData(leftData);
            rightAnalyser.getByteTimeDomainData(rightData);
            
            const visibleSamples = Math.min(bufferLength, visualizerConfig.visibleSamples);
            const startIndex = Math.max(0, Math.floor(bufferLength / 2 - visibleSamples / 2));
            const sliceWidth = oscWidth / visibleSamples;
            
            // –†–∏—Å—É–µ–º –ª–µ–≤—ã–π –∫–∞–Ω–∞–ª
            oscilloscopeCtx.beginPath();
            oscilloscopeCtx.strokeStyle = visualizerConfig.leftChannelColor;
            oscilloscopeCtx.lineWidth = visualizerConfig.lineWidth;
            
            let x = 0;
            for (let i = 0; i < visibleSamples; i++) {
                const index = startIndex + i;
                const amplitude = (leftData[index] - 128) / 128;
                const y = oscHeight / 2 + amplitude * (oscHeight / 2 * visualizerConfig.amplitudeScale);
                
                if (i === 0) {
                    oscilloscopeCtx.moveTo(x, y);
                } else {
                    oscilloscopeCtx.lineTo(x, y);
                }
                
                x += sliceWidth;
            }
            oscilloscopeCtx.stroke();
            
            // –†–∏—Å—É–µ–º –ø—Ä–∞–≤—ã–π –∫–∞–Ω–∞–ª
            oscilloscopeCtx.beginPath();
            oscilloscopeCtx.strokeStyle = visualizerConfig.rightChannelColor;
            oscilloscopeCtx.lineWidth = visualizerConfig.lineWidth;
            
            x = 0;
            for (let i = 0; i < visibleSamples; i++) {
                const index = startIndex + i;
                const amplitude = (rightData[index] - 128) / 128;
                const y = oscHeight / 2 + amplitude * (oscHeight / 2 * visualizerConfig.amplitudeScale);
                
                if (i === 0) {
                    oscilloscopeCtx.moveTo(x, y);
                } else {
                    oscilloscopeCtx.lineTo(x, y);
                }
                
                x += sliceWidth;
            }
            oscilloscopeCtx.stroke();
            
            // –†–∏—Å—É–µ–º —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—É—é –ª–∏–Ω–∏—é
            oscilloscopeCtx.beginPath();
            oscilloscopeCtx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
            oscilloscopeCtx.lineWidth = 1;
            oscilloscopeCtx.moveTo(0, oscHeight / 2);
            oscilloscopeCtx.lineTo(oscWidth, oscHeight / 2);
            oscilloscopeCtx.stroke();
            
            // –†–∏—Å—É–µ–º —Ñ–∏–≥—É—Ä—É –õ–∏—Å—Å–∞–∂—É
            lissajousCtx.beginPath();
            lissajousCtx.strokeStyle = '#FF00FF';
            lissajousCtx.lineWidth = 1;
            
            const squareSize = Math.min(lissWidth, lissHeight) * 0.8;
            const centerX = lissWidth / 2;
            const centerY = lissHeight / 2;
            
            for (let i = 0; i < visibleSamples; i++) {
                const index = startIndex + i;
                const xAmplitude = (leftData[index] - 128) / 128;
                const yAmplitude = (rightData[index] - 128) / 128;
                
                const x = centerX + xAmplitude * squareSize / 2;
                const y = centerY + yAmplitude * squareSize / 2;
                
                if (i === 0) {
                    lissajousCtx.moveTo(x, y);
                } else {
                    lissajousCtx.lineTo(x, y);
                }
            }
            
            lissajousCtx.stroke();
            
            // –†–∏—Å—É–µ–º –ø–µ—Ä–µ–∫—Ä–µ—Å—Ç–∏–µ
            lissajousCtx.beginPath();
            lissajousCtx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
            lissajousCtx.lineWidth = 1;
            lissajousCtx.moveTo(centerX, centerY - squareSize/2);
            lissajousCtx.lineTo(centerX, centerY + squareSize/2);
            lissajousCtx.moveTo(centerX - squareSize/2, centerY);
            lissajousCtx.lineTo(centerX + squareSize/2, centerY);
            lissajousCtx.stroke();
            
            visualizerAnimationId = requestAnimationFrame(drawVisualizer);
        }

        document.getElementById('addFrequency').addEventListener('click', () => {
            createFrequencyControl();
        });

        document.getElementById('toggleBtn').addEventListener('click', togglePlayback);

        document.getElementById('sineBtn').addEventListener('click', () => setWaveType('sine'));
        document.getElementById('squareBtn').addEventListener('click', () => setWaveType('square'));
        
        document.getElementById('fmEnabled').addEventListener('change', updateFMParams);
        document.getElementById('fmFreq').addEventListener('input', updateFMParams);
        document.getElementById('fmDepth').addEventListener('input', updateFMParams);
        
        document.getElementById('saveListBtn').addEventListener('click', showNamePrompt);
        
        document.getElementById('cycleFrequencies').addEventListener('click', () => {
            if (isFrequencyCycling) {
                stopFrequencyCycle();
            } else {
                startFrequencyCycle();
            }
        });
        
        document.getElementById('exportBtn').addEventListener('click', exportPresets);
        document.getElementById('importBtn').addEventListener('click', () => {
            document.getElementById('csvFileInput').click();
        });
        document.getElementById('csvFileInput').addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                importPresets(e.target.files[0]);
                e.target.value = '';
            }
        });
        
        document.getElementById('quickSaveBtn').addEventListener('click', savePresetFromString);
        document.getElementById('saveToWavBtn').addEventListener('click', openWavModal);

        function openModal() {
            document.getElementById('infoModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('infoModal').style.display = 'none';
        }

        function updateFMParams() {
            fmEnabled = document.getElementById('fmEnabled').checked;
            fmFreq = parseFloat(parseFloat(document.getElementById('fmFreq').value || 0).toFixed(6));
            fmDepth = parseFloat(parseFloat(document.getElementById('fmDepth').value || 0).toFixed(3));
            
            if (fmOscillator) {
                fmOscillator.frequency.value = fmFreq;
            }
            
            if (isPlaying) {
                channels.forEach((chain, id) => {
                    const item = document.querySelector(`.frequency-item[data-id="${id}"]`);
                    if (item) {
                        const freq = parseFloat(item.querySelector('.freq-range').value);
                        
                        if (chain.fmGain && !fmEnabled) {
                            chain.fmGain.disconnect();
                            chain.oscillator.frequency.value = freq;
                        } else if (!chain.fmGain && fmEnabled) {
                            const deviation = freq * (fmDepth / 100);
                            chain.fmGain = audioContext.createGain();
                            chain.fmGain.gain.value = deviation;
                            fmOscillator.connect(chain.fmGain);
                            chain.fmGain.connect(chain.oscillator.frequency);
                        } else if (chain.fmGain && fmEnabled) {
                            const deviation = freq * (fmDepth / 100);
                            chain.fmGain.gain.value = deviation;
                        }
                    }
                });
            }
            
            if (isFrequencyCycling && currentPairOscillators.length > 0) {
                currentPairOscillators.forEach(chain => {
                    const freq = chain.oscillator.frequency.value;
                    
                    if (fmEnabled) {
                        const deviation = freq * (fmDepth / 100);
                        
                        if (!chain.fmGain) {
                            chain.fmGain = audioContext.createGain();
                            fmOscillator.connect(chain.fmGain);
                            chain.fmGain.connect(chain.oscillator.frequency);
                        }
                        
                        chain.fmGain.gain.value = deviation;
                    } else if (chain.fmGain) {
                        chain.fmGain.disconnect();
                        chain.fmGain = null;
                    }
                });
            }
        }

        window.onclick = function(event) {
        
            const modal = document.getElementById('infoModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
            
            const nameModal = document.getElementById('namePromptModal');
            if (event.target === nameModal) {
                nameModal.style.display = 'none';
            }
            
            const wavModal = document.getElementById('wavModal');
            if (event.target === wavModal) {
                wavModal.style.display = 'none';
            }
        }
        
        window.addEventListener('DOMContentLoaded', () => {
            createFrequencyControl(432);
            renderSavedLists();
            initScrollTopButton();
            initVisualizer();
            
            document.getElementById('freqAccordion').style.display = 'block';
            document.getElementById('colorAccordion').style.display = 'block';
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
            window.addEventListener('resize', initVisualizer);
        });
    </script>
    <script>
        if('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js', { scope: '/midi/' })
            .then(reg => console.log('SW registered'))
            .catch(err => console.error('SW error:', err));
        }
    </script>
</body>
</html>
