<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="/midi/manifest.json">
    <link rel="icon" href="icon-192.png">
    <meta name="theme-color" content="#2c3e50">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —á–∞—Å—Ç–æ—Ç —Å FM –º–æ–¥—É–ª—è—Ü–∏–µ–π</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 10px;
            max-width: 800px;
            font-size: 0.9em;
        }
        li {
            font-size: 0.8em;
        }
        .control {
            margin: 10px;
            padding: 10px;
            border: 1px solid #ddd;
            background: #f8f8f8;
        }
        .frequency-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
            position: relative;
        }
        .divider {
            height: 1px;
            background: #ccc;
            margin: 10px 0;
            width: 100%;
        }
        .color-box {
            width: 25px;
            height: 25px;
            border: 1px solid #aaa;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 5px;
            border: 1px solid #ddd;
            text-align: center;
        }
        input[type="range"] {
            width: 120px;
            height: 4px;
        }
        input[type="range"].phase-shift {
            width: 160px;
            height: 3px;
        }
        input[type="range"].phase-shift::-webkit-slider-thumb {
            background: #2ecc71;
        }
        input[type="range"].phase-shift::-moz-range-thumb {
            background: #2ecc71;
        }
        button {
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 3px;
            font-size: 0.9em;
        }
        .main-btn {
            background: #e0e0e0;
            border: 1px solid #ccc;
        }
        button.main-btn.active {
            background-color: #90ee90;
            border-color: #5cb85c;
        }
        .remove-btn {
            background: #ff4444;
            color: white;
            border: 1px solid #cc0000;
        }
        .pan-selector {
            margin: 0 5px;
            padding: 3px;
            width: 60px;
            font-size: 0.9em;
        }
        .phase-control {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        input[type="number"] {
            font-size: 0.9em;
            padding: 3px;
            width: 80px; /* –£–≤–µ–ª–∏—á–∏–º —à–∏—Ä–∏–Ω—É –¥–ª—è –¥—Ä–æ–±–Ω—ã—Ö —á–∏—Å–µ–ª */
        }
        .wave-controls {
            margin-top: 10px;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        .wave-btn {
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 3px;
            font-size: 0.9em;
            background: #e0e0e0;
            border: 1px solid #ccc;
        }
        .wave-btn.active {
            background-color: #90ee90;
            border-color: #5cb85c;
        }
        .fm-controls {
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
            padding: 8px;
            background: #eef;
            border-radius: 4px;
            border: 1px solid #ddf;
        }
        .fm-label {
            font-weight: bold;
            color: #333;
        }
        /* –ö–Ω–æ–ø–∫–∞ */
        .info-button {
            font-size: 18px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            text-align: center;
            cursor: pointer;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ (—Ñ–æ–Ω) */
        .modal {
            display: none; 
            position: fixed;
            z-index: 1;
            left: 0; top: 0;
            width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        /* –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –æ–∫–Ω–∞ */
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border-radius: 10px;
            width: 300px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            position: relative;
            max-height: 80vh; /* –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–ª—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ */
            overflow-y: auto; /* –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–ª—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ */
        }

        /* –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è */
        .close {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 18px;
            font-weight: bold;
            color: #aaa;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }
        
        /* –ù–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤ */
        .save-list-container {
            margin: 10px 0;
        }
        
        .saved-lists-header {
            cursor: pointer;
            padding: 8px;
            background: #7e7e90;
            color: white;
            border: 1px solid #ccc;
            border-radius: 3px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .saved-lists-header::after {
            content: "‚ñº";
            font-size: 0.8em;
        }
        
        .saved-lists-content {
            display: none;
            margin-top: 5px;
            border: 1px solid #ddd;
            padding: 5px;
            border-radius: 3px;
            background: #f9f9f9;
        }
        
        .saved-list-btn {
            display: block;
            width: 100%;
            margin: 5px 0;
            padding: 8px;
            text-align: left;
            background: #e9e9e9;
            border: 1px solid #ccc;
            border-radius: 3px;
            cursor: pointer;
        }
        
        .saved-list-btn:hover {
            background: #d9d9d9;
        }
        
        #saveListBtn, #exportBtn, #importBtn {
            margin-top: 20px;
            padding: 8px 15px;
            background: #4CAF50;
            color: white;
            border: none;
            margin-right: 5px;
        }
        
        #exportBtn {
            background: #2196F3;
        }
        
        #importBtn {
            background: #FF9800;
        }
        
        .name-prompt-modal {
            display: none;
            position: fixed;
            z-index: 2;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .name-prompt-content {
            background-color: #fefefe;
            margin: 20% auto;
            padding: 20px;
            border-radius: 5px;
            width: 300px;
        }
        
        /* –°—Ç–∏–ª—å –¥–ª—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫ */
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ */
        .saved-item-container {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .saved-item-name {
            flex-grow: 1;
            text-align: left;
        }
        
        .delete-preset-btn {
            background: #ff4444;
            color: white;
            border: 1px solid #cc0000;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            margin-left: 8px;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –±–ª–æ–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ */
        .info-container {
            margin: 10px 0;
        }
        
        .info-header {
            cursor: pointer;
            padding: 8px;
            background: #7e7e90;
            color: white;
            border: 1px solid #ccc;
            border-radius: 3px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .info-header::after {
            content: "‚ñº";
            font-size: 0.8em;
        }
        
        .info-content {
            display: none;
            margin-top: 10px;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 3px;
            background: #f9f9f9;
        }
        
        /* –ù–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–µ—Å–µ—Ç–∞ */
        .quick-preset-container {
            margin: 10px 0;
            display: flex;
            gap: 5px;
        }
        #quickPresetInput {
            flex-grow: 1;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }
        #quickSaveBtn {
            padding: 8px 15px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* –ö–Ω–æ–ø–∫–∞ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –≤–≤–µ—Ä—Ö */
        #scrollToTopBtn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: none;
            z-index: 99;
            padding: 10px 15px;
            background-color: #7e7e90;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        #scrollToTopBtn:hover {
            background-color: #0069d9;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∞–∫–∫–æ—Ä–¥–µ–æ–Ω–∞ */
        .accordion-container {
            width: 100%;
            margin: 10px 0;
        }
        .accordion-btn {
            width: 100%;
            padding: 12px;
            text-align: left;
            background-color: #7e7e90;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 1em;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .accordion-btn::after {
            content: "‚ñº";
            font-size: 0.8em;
        }
        .accordion-btn.expanded::after {
            content: "‚ñ≤";
        }
        .accordion-content {
            display: none;
            padding: 10px;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 3px 3px;
            background: #f8f8f8;
        }
        @media (max-width: 600px) {
            .accordion-btn {
                font-size: 0.9em;
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <h1>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —á–∞—Å—Ç–æ—Ç</h1> 
    <div class="control">
        <button id="toggleBtn" class="main-btn">–°—Ç–∞—Ä—Ç</button>
        <button id="addFrequency" class="main-btn">+ –î–æ–±–∞–≤–∏—Ç—å —á–∞—Å—Ç–æ—Ç—É</button>
        <button class="main-btn" onclick="openModal()">i</button>
        
        <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–æ—Ä–º–æ–π –≤–æ–ª–Ω—ã -->
        <div class="wave-controls">
            <button id="sineBtn" class="wave-btn active">–°–∏–Ω—É—Å</button>
            <button id="squareBtn" class="wave-btn">–ú–µ–∞–Ω–¥—Ä</button>
            <button id="cycleFrequencies" class="wave-btn">–ø–µ—Ä–µ–±–æ—Ä —á–∞—Å—Ç–æ—Ç</button>
        </div>
        
        <!-- FM –º–æ–¥—É–ª—è—Ü–∏—è - –≤—Å–µ –≤ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ -->
        <div class="fm-controls">
            <input type="checkbox" id="fmEnabled">
            <span class="fm-label">FM –º–æ–¥—É–ª—è—Ü–∏—è:</span>
            
            <span class="fm-label">–ß–∞—Å—Ç–æ—Ç–∞ (–ì—Ü):</span>
            <input type="number" id="fmFreq" min="0" max="100" value="0" step="0.001" style="width: 80px;">
            
            <span class="fm-label">–î–µ–≤–∏–∞—Ü–∏—è (%):</span>
            <input type="number" id="fmDepth" min="0" max="5" value="0" step="0.01" style="width: 70px;">
        </div>
    </div>
    
    <!-- –ê–∫–∫–æ—Ä–¥–µ–æ–Ω –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ —á–∞—Å—Ç–æ—Ç -->
    <div class="accordion-container">
        <button class="accordion-btn" onclick="toggleAccordion('freqAccordion')">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–∞—Å—Ç–æ—Ç</button>
        <div class="accordion-content" id="freqAccordion">
            <div id="frequencyControls" class="control"></div>
        </div>
    </div>
    
    <!-- –ê–∫–∫–æ—Ä–¥–µ–æ–Ω –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã —Ü–≤–µ—Ç–æ–≤ -->
    <div class="accordion-container">
        <button class="accordion-btn" onclick="toggleAccordion('colorAccordion')">–¢–∞–±–ª–∏—Ü–∞ —Ü–≤–µ—Ç–æ–≤</button>
        <div class="accordion-content" id="colorAccordion">
            <table>
                <thead>
                    <tr>
                        <th>–ó–≤—É–∫ (–ì—Ü)</th>
                        <th>–°–≤–µ—Ç (–¢–ì—Ü)</th>
                        <th>–î–ª–∏–Ω–∞ –≤–æ–ª–Ω—ã</th>
                        <th>–¶–≤–µ—Ç</th>
                    </tr>
                </thead>
                <tbody id="results"></tbody>
            </table>
        </div>
    </div>
    
    <!-- –ö–Ω–æ–ø–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è, —ç–∫—Å–ø–æ—Ä—Ç–∞ –∏ –∏–º–ø–æ—Ä—Ç–∞ -->
    <div class="control">
        <button id="saveListBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
        <button id="exportBtn">–≠–∫—Å–ø–æ—Ä—Ç</button>
        <button id="importBtn">–ò–º–ø–æ—Ä—Ç</button>
        <input type="file" id="csvFileInput" accept=".csv" style="display: none;">
    </div>
    
    <!-- –ë–ª–æ–∫ –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–µ—Å–µ—Ç–∞ -->
    <div class="control">
        <div class="quick-preset-container">
            <input type="text" id="quickPresetInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —á–∞—Å—Ç–æ—Ç—ã —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é –∏–ª–∏ —Ç–æ—á–∫—É —Å –∑–∞–ø—è—Ç–æ–π">
            <button id="quickSaveBtn" title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–µ—Å–µ—Ç">üíæ</button>
        </div>
    </div>
    
    <!-- –ë–ª–æ–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤ -->
    <div class="save-list-container control">
        <div class="saved-lists-header" onclick="toggleSavedLists()">
            –°–ø–∏—Å–æ–∫ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —á–∞—Å—Ç–æ—Ç
        </div>
        <div class="saved-lists-content" id="savedListsContent"></div>
    </div>
    
    <!-- –ë–ª–æ–∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —á–∞—Å—Ç–æ—Ç–∞—Ö –ø–ª–∞–Ω–µ—Ç –∏ –î–ù–ö -->
    <div class="info-container control">
        <div class="info-header" onclick="toggleInfo()">
            –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —á–∞—Å—Ç–æ—Ç–∞—Ö –ø–ª–∞–Ω–µ—Ç –∏ –î–ù–ö
        </div>
        <div class="info-content mb-2" id="infoContent">
            <ul>
                <li>–ò–¥–µ–∞–ª—å–Ω—ã–π 5-–π –∫–ª—é—á –î–ù–ö: –≥–∞—Ä–º–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å
                    —á–∞—Å—Ç–æ—Ç–∞–º–∏ D 288 –ì—Ü –∏ –ê 432 –ì—Ü, –æ–Ω —è–≤–ª—è–µ—Ç—Å—è –∫—Ä–∞–µ—É–≥–æ–ª—å–Ω—ã–º –∫–∞–º–Ω–µ–º –∫–æ–ª–ª–µ–∫—Ü–∏–∏.</li>
                <li>–ò–¥–µ–∞–ª—å–Ω–∞—è 5-—è –∫–ª–∞–≤–∏—à–∞ F/C: –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ —á–∞—Å—Ç–æ—Ç—É F 324 –ì—Ü –∏ –° 512 –ì—Ü, –ø—Ä–µ–¥–ª–∞–≥–∞—è –Ω–æ–≤–æ–µ –∏–∑–º–µ—Ä–µ–Ω–∏–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –≥–∞—Ä–º–æ–Ω–∏–∫.</li>
                <li>–î–µ–ª—å—Ç–∞-–∫–ª–∞–≤–∏—à–∞: —É–Ω–∏–∫–∞–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ –Ω–æ—Ç—É D –Ω–∞ –æ–±–æ–∏—Ö –∫–æ–Ω—Ü–∞—Ö —Å–æ —Å–º–µ—â–µ–Ω–∏–µ–º –Ω–∞ 3 –ì—Ü, —Å–æ–∑–¥–∞–≤–∞—è –¥–µ–ª—å—Ç–∞-–±–∏–Ω–∞—É—Ä–∞–ª—å–Ω—É—é —á–∞—Å—Ç–æ—Ç—É, —Å–ø–æ—Å–æ–±—Å—Ç–≤—É—é—â—É—é –≥–ª—É–±–æ–∫–æ–π –º–µ–¥–∏—Ç–∞—Ü–∏–∏ –∏ —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏.</li>
                <li>–¢–µ—Ç–∞-–∫–ª—é—á: –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –Ω–æ—Ç—É –ê –Ω–∞ –æ–±–æ–∏—Ö –∫–æ–Ω—Ü–∞—Ö –∏ —Å–º–µ—â–µ–Ω –Ω–∞ 6 –ì—Ü, –æ–Ω —Å–æ–∑–¥–∞–µ—Ç —Ç–µ—Ç–∞-–±–∏–Ω–∞—É—Ä–∞–ª—å–Ω—É—é —á–∞—Å—Ç–æ—Ç—É, —Å–ø–æ—Å–æ–±—Å—Ç–≤—É—é—â—É—é —Å–æ—Å—Ç–æ—è–Ω–∏—é —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–Ω–æ–≥–æ –æ—Å–æ–∑–Ω–∞–Ω–∏—è –∏ –æ—Ç–∫—Ä—ã–≤–∞—è –¥–æ—Å—Ç—É–ø –∫ –ø–æ–¥—Å–æ–∑–Ω–∞–Ω–∏—é.</li>
            </ul>
            <h3>–¢–æ–Ω–∞ –ø–ª–∞–Ω–µ—Ç</h3>
            <ul>
                <li>
                    <b>–¢–æ–Ω –ú–µ—Ä–∫—É—Ä–∏—è.</b><br>  			
                    141.27 Hz<br>    			
                    –¶–≤–µ—Ç: —Å–∏–Ω–µ-–∑–µ–ª–µ–Ω—ã–π<br>   			
                    –ß–∞–∫—Ä–∞: –í–∏—à—É–¥—Ö–∞ –≥–æ—Ä–ª–æ–≤–∞—è —á–∞–∫—Ä–∞<br>    			
                    –≠—Ñ—Ñ–µ–∫—Ç: –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ü–µ–Ω—Ç—Ä —Ä–µ—á–∏, –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—é –∏ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—É—é –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å.
                </li>
                <li>
                    <b>–¢–æ–Ω –í–µ–Ω–µ—Ä—ã.</b><br>  			
                    221.23 Hz<br>    			
                    –¶–≤–µ—Ç: –∂–µ–ª—Ç–æ-–æ—Ä–∞–Ω–∂–µ–≤—ã–π<br>    			
                    –ß–∞–∫ra: –ê–¥–∂–Ω–∞ –Ω–∞–¥–±—Ä–æ–≤–Ω–∞—è —á–∞–∫—Ä–∞, —Ç—Ä–µ—Ç–∏–π –≥–ª–∞–∑<br>    			
                    –≠—Ñ—Ñ–µ–∫—Ç: –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—ã—Å—à—É—é –ª—é–±–æ–≤–Ω—É—é —ç–Ω–µ—Ä–≥–∏—é –∏ —Å—Ç—Ä–µ–º–ª–µ–Ω–∏–µ –∫ –≥–∞—Ä–º–æ–Ω–∏–∏.
                </li>
                <li>
                    <b>–¢–æ–Ω –ú–∞—Ä—Å–∞.</b><br>    			
                    144.72 Hz<br>    			
                    –¶–≤–µ—Ç: —Å–∏–Ω–∏–π<br>    			
                    –≠—Ñ—Ñ–µ–∫—Ç: –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–∏–ª—É –≤–æ–ª–∏ –∏ —Å—Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é —ç–Ω–µ—Ä–≥–∏—é
                </li>
                <li>			
                    <b>–¢–æ–Ω –Æ–ø–∏—Ç–µ—Ä–∞.</b><br>    			
                    183.58 Hz<br>    			
                    –¶–≤–µ—Ç: –∫—Ä–∞—Å–Ω—ã–π<br>    			
                    –≠—Ñ—Ñ–µ–∫—Ç: –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–≤–æ—Ä—á–µ—Å–∫—É—é —Å–∏–ª—É.
                </li>
                <li>    			
                    <b>–¢–æ–Ω –°–∞—Ç—É—Ä–Ω.</b><br>   			
                    147.85 Hz<br>   			
                    –¶–≤–µ—Ç: —Å–∏–Ω–∏–π<br>  			
                    –≠—Ñ—Ñ–µ–∫—Ç: —É—Å–∏–ª–∏–≤–∞–µ—Ç –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—é –∏ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å.
                </li>
                <li>
                    <b>–¢–æ–Ω –£—Ä–∞–Ω–∞.</b><br>    			
                    207.36 Hz<br>    			
                    –¶–≤–µ—Ç: –æ—Ä–∞–Ω–∂–µ–≤—ã–π<br>    			
                    –≠—Ñ—Ñ–µ–∫—Ç: –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–∏–ª—É —É–¥–∏–≤–ª–µ–Ω–∏—è –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, –æ–±–ª–∞–¥–∞–µ—Ç –ø–µ—Ä–≤–æ–±—ã—Ç–Ω–æ–π –∏ —ç—Ä–æ—Ç–∏—á–µ—Å–∫–æ–π —Å–∏–ª–æ–π.    			
                </li>
                <li>
                    <b>–¢–æ–Ω –ù–µ–ø—Ç—É–Ω–∞.</b><br>    			
                    211.44 Hz<br>    			
                    –¶–≤–µ—Ç: –æ—Ä–∞–Ω–∂–µ–≤—ã–π<br>    			
                    –≠—Ñ—Ñ–µ–∫—Ç: –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∏–Ω—Ç—É–∏—Ü–∏—é, –ø–æ–¥—Å–æ–∑–Ω–∞–Ω–∏–µ –∏ —É—Å–∏–ª–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–∂–∏–≤–∞–Ω–∏—è –≤–æ —Å–Ω–µ.    			
                </li>
                <li>
                    <b>–¢–æ–Ω –ü–ª—É—Ç–æ–Ω–∞.</b><br>   			
                    140.64 Hz<br>			
                    –¶–≤–µ—Ç: —Å–∏–Ω–µ-–∑–µ–ª–µ–Ω—ã–π<br>   			
                    –≠—Ñ—Ñ–µ–∫—Ç: –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–∞–≥–∏—á–µ—Å–∫—É—é –≥—Ä—É–ø–ø–æ–≤—É—é –¥–∏–Ω–∞–º–∏–∫—É –∏ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –æ–±—â–µ—Å—Ç–≤–∞.
                </li>
                <li>
                    <b>–¢–æ–Ω –°–æ–ª–Ω—Ü–∞.</b><br>   			
                    126.22 Hz<br>    			
                    –¶–≤–µ—Ç: –∂–µ–ª—Ç–æ-–∑–µ–ª–µ–Ω—ã–π<br>   			
                    –ß–∞–∫ra: –ú–∞–Ω–∏–ø—Éura —Å–æ–ª–Ω–µ—á–Ω–æ–µ —Å–ø–ª–µ—Ç–µ–Ω–∏–µ	(Xapa)<br>    			
                    –≠—Ñ—Ñ–µ–∫—Ç: —É—Å–∏–ª–∏–≤–∞–µ—Ç –æ—â—É—â–µ–Ω–∏–µ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ –º–∞–≥–∏—á–µ—Å–∫–æ–º –∏ —Ç—Ä–∞–Ω—Å—Ü–µ–Ω–¥–µ–Ω—Ç–Ω–æ–º.<br>   			
                    –°–æ–ª–Ω—Ü–µ —ç—Ç–æ —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–π —Ü–µ–Ω—Ç—Ä –Ω–∞—à–µ–π —Å–æ–ª–Ω–µ—á–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã. –û–Ω–æ —è–≤–ª—è–µ—Ç—Å—è —Ü–µ–Ω—Ç—Ä–æ–º –ø—Ä–∏—Ç—è–∂–µ–Ω–∏—è, –≤–æ–∫—Ä—É–≥ –∫–æ—Ç–æ—Ä–æ–≥–æ –≤—Ä–∞—â–∞—é—Ç—Å—è –ó–µ–º–ª—è –∏ –¥—Ä—É–≥–∏–µ –ø–ª–∞–Ω–µ—Ç—ã. –ü–æ—ç—Ç–æ–º—É —á–∞—Å—Ç–æ—Ç–∞ —Å–æ–ª–Ω—Ü–∞ —Å–≤—è–∑–∞–Ω–∞ —Å –ø—Å–∏—Ö–∏—á–µ—Å–∫–∏–º —Ü–µ–Ω—Ç—Ä–æ–º. –í –î–∑–µ–Ω–µ —ç—Ç–∞ —Ç–æ—á–∫–∞ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –•–∞—Ä–∞. –¢–æ–Ω —Å–æ–ª–Ω—Ü–∞ —ç—Ç–æ –≥—Ä–∞–Ω–∏—Ü–∞ –º–µ–∂–¥—É –ò–Ω—å –∏ –Ø–Ω, –º–µ–∂–¥—É —ç—Ç–æ–π –∏ –¥—Ä—É–≥–æ–π —Å—Ç–æ—Ä–æ–Ω–æ–π. –û–Ω –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –∏–∑ –≤—ã—Å—à–µ–≥–æ –∏–∑–º–µ—Ä–µ–Ω–∏—è –∏, –ª–∏—à–µ–Ω–Ω—ã–π —Ä–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è, —Å–∏–º–≤–æ–ª–∏–∑–∏—Ä—É–µ—Ç –Ω–µ—á—Ç–æ –º–∞–≥–∏—á–µ—Å–∫–æ–µ –∏ —Ç—Ä–∞–Ω—Å—Ü–µ–Ω–¥–µ–Ω—Ç–Ω–æ–µ. 			
                    –°–æ–ª–Ω–µ—á–Ω—ã–π —Ç–æ–Ω —Å–ª–µ–¥—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ —Ä–∞–±–æ—Ç—ã —Å –¥—Ä—É–≥–∏–º–∏ —Ç–æ–Ω–∞–º–∏ –∏ –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å –¥–ª—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö –ø—Ä–∞–∫—Ç–∏–∫–æ–≤.
                </li>
            </ul>   
            <p>–û—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–µ <a href="https://www.planetware.de/octave/">Planetware</a>, –≥–¥–µ –º–æ–∂–Ω–æ —Å–∫–∞—á–∞—Ç—å —ç—Ç–∏ —Ç–æ–Ω–∞.
           </p>
        </div>        
    </div>

    <div class="text-center mb-2">
            <p><a href="https://meweryk.github.io/midi/kolokol0018.html">–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–æ–ª–æ–∫–æ–ª—å–Ω–æ–≥–æ –∑–≤–æ–Ω–∞</a><br>
                <a href="https://meweryk.github.io/midi/calc_music.html">–ê–Ω–∞–ª–∏–∑ –º—É–∑—ã–∫–∞–ª—å–Ω–æ–≥–æ —Å—Ç—Ä–æ—è —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π</a><br>
                <a href="https://meweryk.github.io/midi/processorG.html">–ê—É–¥–∏–æ–ø–ª–µ–µ—Ä —Ñ–∞–∑–æ–≤—Ä–∞—â–∞—Ç–µ–ª—å</a><br>
            <a href="https://meweryk.github.io/Wave-of-land/index.html">–ï—â—ë –ø—Ä–æ–µ–∫—Ç—ã</a></p>
    </div>
    <div class="text-center mb-1">
            <p>¬© –ê–≤—Ç–æ—Ä</p>
    </div>
    
    <!-- –ö–Ω–æ–ø–∫–∞ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –≤–≤–µ—Ä—Ö -->
    <button id="scrollToTopBtn" title="–ù–∞–≤–µ—Ä—Ö">‚Üë</button>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ -->
    <div id="infoModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä–µ</h3>
            <p>–≠—Ç–æ –ø—Ä–æ—Å—Ç–æ–π —Å–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —á–∞—Å—Ç–æ—Ç –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–æ–¥–∏–Ω—Å–∫–æ–≥–æ –±—É–±–ª–∏–∫–∞.</p>
            
            <ul>
            <li>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä–æ–≤</li>
            <li>–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä–∞ –∫–∞–Ω–∞–ª–∞: –ø—Ä–∞–≤–æ–≥–æ (R), –ª–µ–≤–æ–≥–æ (L) –∏–ª–∏ –≤—ã–≤–æ–¥–∞ –Ω–∞ –¥–≤–∞ —Å—Ä–∞–∑—É (–°)</li>
            <li>–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–¥–≤–∏–≥–∞ —Ñ–∞–∑—ã (–¥–æ 180¬∞) –º–µ–∂–¥—É –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä–∞–º–∏</li>
            <li>–†–∞—Å—á—ë—Ç –¥–ª–∏–Ω—ã –≤–æ–ª–Ω—ã –≤ –≤–∏–¥–∏–º–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ –ø—Ä–∏ –æ–∫—Ç–∞–≤–Ω–æ–º —É–≤–µ–ª–∏—á–µ–Ω–∏–∏ —á–∞—Å—Ç–æ—Ç—ã –∑–≤—É–∫–∞</li>
            <li>–¶–≤–µ—Ç–æ–≤–∞—è —à–∫–∞–ª–∞ –¥–ª–∏–Ω—ã –≤–æ–ª–Ω—ã</li>
            </ul>
            <h3>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:</h3>
            <ul>
            <li>–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–∞—Å—Ç–æ—Ç—ã –≤ –Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è</li>
            <li><strong>–í–∞–∂–Ω–æ:</strong> –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤—ã–≤–æ–¥–æ–≤ –Ω–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è—Ö ‚Äî —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –æ—Å—Ç–∞–Ω–æ–≤–∫—É –∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫</li>
            <li>–ü–µ—Ä–µ—Ö–æ–¥ —Ñ–∞–∑—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ –Ω–æ–≤–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞</li>
            <li>–î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∞–º–ø–ª–∏—Ç—É–¥—ã –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∫–ª–∏–ø–ø–∏–Ω–≥–∞</li>
            <li>–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∫–æ–º–ø—Ä–µ—Å—Å–æ—Ä –¥–ª—è –º—è–≥–∫–æ–≥–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å–∏–≥–Ω–∞–ª–∞</li>
            <li>–ü–µ—Ä–µ–±–æ—Ä —á–∞—Å—Ç–æ—Ç: –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–µ—Ç –ø–æ 2 —á–∞—Å—Ç–æ—Ç—ã —Å –≤–≤–µ–¥—ë–Ω–Ω–æ–≥–æ –ø—Ä–µ—Å–µ—Ç–∞, –∫–∞–∂–¥—É—é –ø–∞—Ä—É —á–∞—Å—Ç–æ—Ç –ø–æ 3 –º–∏–Ω—É—Ç—ã, –ø–æ—Å–ª–µ —á–µ–≥–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è</li>
            </ul>
            <h3>FM –º–æ–¥—É–ª—è—Ü–∏—è –≤ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–µ</h3>
            <p>–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ç–æ—á–Ω–∞—è —á–∞—Å—Ç–æ—Ç–Ω–∞—è –º–æ–¥—É–ª—è—Ü–∏—è (FM) –ø–æ —Ñ–æ—Ä–º—É–ª–µ:</p>
            <p><strong>f(t) = f‚ÇÄ + Œîf √ó sin(2œÄf‚Çòt)</strong></p>
            <p>–≥–¥–µ:</p>
            <ul>
                <li><strong>f(t)</strong> - –º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è —á–∞—Å—Ç–æ—Ç–∞</li>
                <li><strong>f‚ÇÄ</strong> - –æ—Å–Ω–æ–≤–Ω–∞—è —á–∞—Å—Ç–æ—Ç–∞ –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä–∞</li>
                <li><strong>Œîf</strong> - –¥–µ–≤–∏–∞—Ü–∏—è —á–∞—Å—Ç–æ—Ç—ã (Œîf = f‚ÇÄ √ó depth / 100)</li>
                <li><strong>f‚Çò</strong> - —á–∞—Å—Ç–æ—Ç–∞ –º–æ–¥—É–ª—è—Ü–∏–∏</li>
            </ul>
            
            <h4>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:</h4>
            <ul>
                <li><strong>–í–∫–ª—é—á–µ–Ω–∏–µ:</strong> —Ñ–ª–∞–∂–æ–∫ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç/–¥–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç FM –º–æ–¥—É–ª—è—Ü–∏—é</li>
                <li><strong>–ß–∞—Å—Ç–æ—Ç–∞ –º–æ–¥—É–ª—è—Ü–∏–∏:</strong> 0-100 –ì—Ü (—à–∞–≥ 0.001 –ì—Ü)</li>
                <li><strong>–î–µ–≤–∏–∞—Ü–∏—è:</strong> 0-5% –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π —á–∞—Å—Ç–æ—Ç—ã (—à–∞–≥ 0.01%)</li>
            </ul>
            
            <p>FM –º–æ–¥—É–ª—è—Ü–∏—è –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫–æ –≤—Å–µ–º –∞–∫—Ç–∏–≤–Ω—ã–º –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä–∞–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.</p>
            <p>–ü—Ä–æ–µ–∫—Ç —Å–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä–∞ —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —á–∞—Å—Ç–æ—Ç –∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –∫–∞—Ç—É—à–∫–∏ <strong>–†–æ–¥–æ–§–æ–Ω</strong>, —Å–¥–µ–ª–∞–Ω–Ω–æ–π –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É <strong>–ú–∞—Ä–∫–æ –†–æ–¥–∏–Ω–∞</strong>.</p>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤–≤–æ–¥–∞ –∏–º–µ–Ω–∏ -->
    <div id="namePromptModal" class="name-prompt-modal">
        <div class="name-prompt-content">
            <h3>–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞</h3>
            <p>–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è –≤–∞—à–µ–≥–æ —Å–ø–∏—Å–∫–∞ —á–∞—Å—Ç–æ—Ç:</p>
            <input type="text" id="listNameInput" style="width: 100%; padding: 8px; margin: 10px 0; box-sizing: border-box;">
            <div style="display: flex; justify-content: space-between;">
                <button onclick="document.getElementById('namePromptModal').style.display = 'none'">–û—Ç–º–µ–Ω–∞</button>
                <button onclick="confirmSaveList()" style="background: #4CAF50; color: white;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>
    <!-- Bootstrap JS (–Ω–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
    <script>
        let audioContext;
        let isPlaying = false;
        const channels = new Map();
        let currentWaveType = 'sine';
        let masterGain;
        let fmOscillator;
        let fmEnabled = false;
        let fmFreq = 0;
        let fmDepth = 0;
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –ø–µ—Ä–µ–±–æ—Ä–∞ —á–∞—Å—Ç–æ—Ç
        let isFrequencyCycling = false;
        let cycleInterval;
        let countdownInterval;
        let currentPairIndex = 0;
        let currentPairOscillators = [];
        let totalCycleTime = 0;
        let remainingTime = 0;
        let frequencyPairs = [];
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å localStorage
        const frequencyListsStorageKey = 'savedFrequencyLists';
        
        function getSavedFrequencyLists() {
            const saved = localStorage.getItem(frequencyListsStorageKey);
            return saved ? JSON.parse(saved) : {};
        }
        
        function saveFrequencyLists(lists) {
            localStorage.setItem(frequencyListsStorageKey, JSON.stringify(lists));
        }
        
        function showNamePrompt() {
            document.getElementById('namePromptModal').style.display = 'block';
            document.getElementById('listNameInput').value = '';
            document.getElementById('listNameInput').focus();
        }
        
        function confirmSaveList() {
            const listName = document.getElementById('listNameInput').value.trim();
            if (!listName) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞');
                return;
            }
            
            saveCurrentList(listName);
            document.getElementById('namePromptModal').style.display = 'none';
        }
        
        function saveCurrentList(listName) {
            // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ —Ç–µ–∫—É—â–∏—Ö —á–∞—Å—Ç–æ—Ç–∞—Ö
            const frequencyItems = document.querySelectorAll('.frequency-item');
            const frequencies = [];
            
            frequencyItems.forEach(item => {
                const id = item.dataset.id;
                const freq = parseFloat(item.querySelector('.freq-range').value);
                const phaseShift = parseFloat(item.querySelector('.phase-shift').value);
                const pan = parseFloat(item.querySelector('.pan-selector').value);
                
                frequencies.push({
                    freq: parseFloat(freq.toFixed(6)), // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é –¥–æ 6 –∑–Ω–∞–∫–æ–≤
                    phaseShift: parseFloat(phaseShift.toFixed(3)),
                    pan: parseFloat(pan.toFixed(3))
                });
            });
            
            // –°–æ–±–∏—Ä–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã FM –º–æ–¥—É–ª—è—Ü–∏–∏
            const fmParams = {
                enabled: document.getElementById('fmEnabled').checked,
                freq: parseFloat(parseFloat(document.getElementById('fmFreq').value || 0).toFixed(6)),
                depth: parseFloat(parseFloat(document.getElementById('fmDepth').value || 0).toFixed(3))
            };
            
            // –§–æ—Ä–º–∏—Ä—É–µ–º –æ–±—ä–µ–∫—Ç —Å–ø–∏—Å–∫–∞
            const listData = {
                frequencies,
                fm: fmParams
            };
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
            const savedLists = getSavedFrequencyLists();
            savedLists[listName] = listData;
            saveFrequencyLists(savedLists);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤
            renderSavedLists();
            
            alert(`–°–ø–∏—Å–æ–∫ "${listName}" —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!`);
        }
        
        function renderSavedLists() {
            const savedLists = getSavedFrequencyLists();
            const container = document.getElementById('savedListsContent');
            container.innerHTML = '';
            
            if (Object.keys(savedLists).length === 0) {
                container.innerHTML = '<p>–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤</p>';
                return;
            }
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É
            const sortedNames = Object.keys(savedLists).sort();
            
            sortedNames.forEach(name => {
                const containerDiv = document.createElement('div');
                containerDiv.className = 'saved-item-container';
                
                const btn = document.createElement('button');
                btn.className = 'saved-list-btn saved-item-name';
                btn.textContent = name;
                btn.onclick = () => applyFrequencyList(name, savedLists[name]);
                
                const deleteBtn = document.createElement('div');
                deleteBtn.className = 'delete-preset-btn';
                deleteBtn.textContent = '√ó';
                deleteBtn.onclick = (e) => {
                    e.stopPropagation();
                    deleteSavedList(name);
                };
                
                containerDiv.appendChild(btn);
                containerDiv.appendChild(deleteBtn);
                container.appendChild(containerDiv);
            });
        }
        
        function deleteSavedList(name) {
            if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø—Ä–µ—Å–µ—Ç "${name}"?`)) {
                const savedLists = getSavedFrequencyLists();
                delete savedLists[name];
                saveFrequencyLists(savedLists);
                renderSavedLists();
            }
        }
        
        function toggleSavedLists() {
            const content = document.getElementById('savedListsContent');
            content.style.display = content.style.display === 'block' ? 'none' : 'block';
            renderSavedLists();
        }
        
        function applyFrequencyList(listName, listData) {
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ —Ç–µ–∫—É—â–∏–µ –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä—ã
            if (isPlaying) {
                togglePlayback();
            }
            if (isFrequencyCycling) {
                stopFrequencyCycle();
            }
            
            // –û—á–∏—â–∞–µ–º —Ç–µ–∫—É—â–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            document.querySelectorAll('.frequency-item').forEach(item => item.remove());
            document.querySelectorAll('tr[data-id]').forEach(row => row.remove());
            
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            listData.frequencies.forEach(item => {
                const id = createFrequencyControl(item.freq);
                
                // –ù–∞—Ö–æ–¥–∏–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç
                const lastItem = document.querySelector(`.frequency-item[data-id="${id}"]`);
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                lastItem.querySelector('.phase-shift').value = item.phaseShift;
                lastItem.querySelector('.phase-value').textContent = `${item.phaseShift}¬∞`;
                lastItem.querySelector('.pan-selector').value = item.pan;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é
                updateVisualization(id, item.freq);
            });
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã FM
            document.getElementById('fmEnabled').checked = listData.fm.enabled;
            document.getElementById('fmFreq').value = listData.fm.freq;
            document.getElementById('fmDepth').value = listData.fm.depth;
            updateFMParams();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ —Å—Ç—Ä–æ–∫–∏ —Ç–∞–±–ª–∏—Ü—ã
            document.querySelectorAll('.frequency-item').forEach(item => {
                const id = item.dataset.id;
                const freq = parseFloat(item.querySelector('.freq-range').value);
                updateVisualization(id, freq);
            });
            
            alert(`–°–ø–∏—Å–æ–∫ "${listName}" —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω!`);
        }

        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // –°–æ–∑–¥–∞–µ–º –≥–ª–∞–≤–Ω—ã–π —É–∑–µ–ª —É—Å–∏–ª–µ–Ω–∏—è –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏
                masterGain = audioContext.createGain();
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—â–µ–µ —É—Å–∏–ª–µ–Ω–∏–µ –Ω–∞ 0.8 –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∫–ª–∏–ø–ø–∏–Ω–≥–∞
                masterGain.gain.value = 0.8;
                masterGain.connect(audioContext.destination);
                
                // –°–æ–∑–¥–∞–µ–º FM –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä (–±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è, –∫–æ–≥–¥–∞ FM –≤–∫–ª—é—á–µ–Ω)
                fmOscillator = audioContext.createOscillator();
                fmOscillator.type = 'sine';
                fmOscillator.frequency.value = 0;
                fmOscillator.start();
            }
        }

        function createOscillatorChain(freq, pan, phaseShift = 0) {
            const oscillator = audioContext.createOscillator();
            const panner = audioContext.createStereoPanner();
            const delayNode = audioContext.createDelay();
            const gainNode = audioContext.createGain(); // –£–∑–µ–ª —É—Å–∏–ª–µ–Ω–∏—è –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏
            
            oscillator.type = currentWaveType;
            oscillator.frequency.setValueAtTime(freq, audioContext.currentTime);
            panner.pan.value = pan;
            delayNode.delayTime.value = phaseShift / (360 * freq);
            
            // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∞–º–ø–ª–∏—Ç—É–¥—ã
            gainNode.gain.value = 1;
            
            // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ: oscillator -> delayNode -> gainNode -> panner -> masterGain
            oscillator.connect(delayNode);
            delayNode.connect(gainNode);
            gainNode.connect(panner);
            panner.connect(masterGain);
            
            // FM –º–æ–¥—É–ª—è—Ü–∏—è (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–∞)
            let fmGain = null;
            if (fmEnabled) {
                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –¥–µ–≤–∏–∞—Ü–∏—é –¥–ª—è —ç—Ç–æ–π —á–∞—Å—Ç–æ—Ç—ã
                const deviation = freq * (fmDepth / 100);
                
                // –°–æ–∑–¥–∞–µ–º —É–∑–µ–ª —É—Å–∏–ª–µ–Ω–∏—è –¥–ª—è –º–æ–¥—É–ª—è—Ü–∏–∏
                fmGain = audioContext.createGain();
                fmGain.gain.value = deviation;
                
                // –ü–æ–¥–∫–ª—é—á–∞–µ–º FM –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä –∫ —É—Å–∏–ª–∏—Ç–µ–ª—é, –∞ –∑–∞—Ç–µ–º –∫ —á–∞—Å—Ç–æ—Ç–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä–∞
                fmOscillator.connect(fmGain);
                fmGain.connect(oscillator.frequency);
            }

            return { 
                oscillator, 
                panner, 
                delayNode, 
                gainNode,
                fmGain // –î–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è FM
            };
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ FM
        function updateFMParams() {
            fmEnabled = document.getElementById('fmEnabled').checked;
            fmFreq = parseFloat(parseFloat(document.getElementById('fmFreq').value || 0).toFixed(6));
            fmDepth = parseFloat(parseFloat(document.getElementById('fmDepth').value || 0).toFixed(3));
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —á–∞—Å—Ç–æ—Ç—É FM –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä–∞
            if (fmOscillator) {
                fmOscillator.frequency.value = fmFreq;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä—ã
            if (isPlaying) {
                channels.forEach((chain, id) => {
                    const item = document.querySelector(`.frequency-item[data-id="${id}"]`);
                    if (item) {
                        const freq = parseFloat(item.querySelector('.freq-range').value);
                        
                        // –ï—Å–ª–∏ FM –±—ã–ª –≤–∫–ª—é—á–µ–Ω/–≤—ã–∫–ª—é—á–µ–Ω, –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä
                        if (chain.fmGain && !fmEnabled) {
                            // –û—Ç–∫–ª—é—á–∞–µ–º FM
                            chain.fmGain.disconnect();
                            chain.oscillator.frequency.value = freq;
                        } else if (!chain.fmGain && fmEnabled) {
                            // –í–∫–ª—é—á–∞–µ–º FM
                            const deviation = freq * (fmDepth / 100);
                            chain.fmGain = audioContext.createGain();
                            chain.fmGain.gain.value = deviation;
                            fmOscillator.connect(chain.fmGain);
                            chain.fmGain.connect(chain.oscillator.frequency);
                        } else if (chain.fmGain && fmEnabled) {
                            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–µ–≤–∏–∞—Ü–∏—é
                            const deviation = freq * (fmDepth / 100);
                            chain.fmGain.gain.value = deviation;
                        }
                    }
                });
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º FM –¥–ª—è —Ç–µ–∫—É—â–µ–π –ø–∞—Ä—ã –ø—Ä–∏ –ø–µ—Ä–µ–±–æ—Ä–µ
            if (isFrequencyCycling && currentPairOscillators.length > 0) {
                currentPairOscillators.forEach(chain => {
                    const freq = chain.oscillator.frequency.value;
                    
                    if (fmEnabled) {
                        const deviation = freq * (fmDepth / 100);
                        
                        // –ï—Å–ª–∏ FM –Ω–µ –±—ã–ª –ø–æ–¥–∫–ª—é—á–µ–Ω - —Å–æ–∑–¥–∞–µ–º
                        if (!chain.fmGain) {
                            chain.fmGain = audioContext.createGain();
                            fmOscillator.connect(chain.fmGain);
                            chain.fmGain.connect(chain.oscillator.frequency);
                        }
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º –¥–µ–≤–∏–∞—Ü–∏—é
                        chain.fmGain.gain.value = deviation;
                    } else if (chain.fmGain) {
                        // –û—Ç–∫–ª—é—á–∞–µ–º FM
                        chain.fmGain.disconnect();
                        chain.fmGain = null;
                    }
                });
            }
        }

        function calculateLightParameters(frequency) {
            const C = 299792458;
            let lightFreq = frequency;
            let octaves = 0;

            while (lightFreq < 400e12 && octaves++ < 50) lightFreq *= 2;

            const wavelength = (C / lightFreq) * 1e9;

            if (wavelength >= 380 && wavelength <= 780) {
                return {
                    lightFreq: lightFreq / 1e12,
                    wavelength: wavelength.toFixed(1) + ' –Ω–º',
                    color: wavelengthToColor(wavelength)
                };
            }
            return null;
        }

        function wavelengthToColor(wl) {
            wl = Math.max(380, Math.min(780, wl));
            let r, g, b, factor;

            if (wl < 440) {
                r = (wl - 380) / 60; g = 0; b = 1;
            } else if (wl < 490) {
                r = 0; g = (wl - 440) / 50; b = 1;
            } else if (wl < 510) {
                r = 0; g = 1; b = (510 - wl) / 20;
            } else if (wl < 580) {
                r = (wl - 510) / 70; g = 1; b = 0;
            } else if (wl < 645) {
                r = 1; g = (645 - wl) / 65; b = 0;
            } else {
                r = 1; g = 0; b = 0;
            }

            factor = wl > 700 ? 0.3 : wl < 420 ? 0.3 + 0.7 * (wl - 380) / 40 : 1;
            const gamma = 0.8;

            return `rgb(${[
                Math.round(255 * Math.pow(r * factor, gamma)),
                Math.round(255 * Math.pow(g * factor, gamma)),
                Math.round(255 * Math.pow(b * factor, gamma))
            ].join(',')})`;
        }

        function updateVisualization(id, frequency) {
            const data = calculateLightParameters(frequency);
            const row = document.querySelector(`tr[data-id="${id}"]`);
            if (!data || !row) return;

            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —á–∞—Å—Ç–æ—Ç—É –¥–æ —Ç—ã—Å—è—á–Ω—ã—Ö
            const formattedFrequency = parseFloat(frequency.toFixed(6)).toLocaleString('ru-RU', {
                minimumFractionDigits: 3,
                maximumFractionDigits: 6
            });

            row.innerHTML = `
                <td>${formattedFrequency}</td>
                <td>${data.lightFreq.toFixed(3)}</td>
                <td>${data.wavelength}</td>
                <td><div class="color-box" style="background:${data.color}"></div></td>
            `;
        }

        function updateDividers() {
            const container = document.getElementById('frequencyControls');
            const items = container.querySelectorAll('.frequency-item');
            container.querySelectorAll('.divider').forEach(div => div.remove());
            items.forEach((item, index) => {
                if (index < items.length - 1) {
                    const divider = document.createElement('div');
                    divider.className = 'divider';
                    item.after(divider);
                }
            });
        }

        function createFrequencyControl(defaultFrequency = 432) {
            const id = Date.now().toString();
            const div = document.createElement('div');
            div.className = 'frequency-item';
            div.dataset.id = id;
            div.innerHTML = `
                <input type="range" class="freq-range" min="1" max="20000" value="${defaultFrequency}" step="0.001" style="width: 120px;">
                <input type="number" class="freq-number" value="${defaultFrequency}" step="0.001" style="width: 80px;">
                <br>
                <div class="phase-control">
                    <input type="range" class="phase-shift" min="0" max="180" value="0" step="0.1" style="width: 160px;">
                    <span class="phase-value">0¬∞</span>
                </div>
                <select class="pan-selector" style="width: 45px;">
                    <option value="-1">L</option>
                    <option value="0" selected>C</option>
                    <option value="1">R</option>
                </select>
                <button class="remove-btn" onclick="removeFrequency('${id}')">√ó</button>
            `;

            const freqRange = div.querySelector('.freq-range');
            const freqNumber = div.querySelector('.freq-number');
            const phaseShift = div.querySelector('.phase-shift');
            const phaseValue = div.querySelector('.phase-value');

            freqNumber.addEventListener('input', () => {
                const sanitized = freqNumber.value.replace(',', '.');
                const val = parseFloat(sanitized);
                if (!isNaN(val)) {
                    freqRange.value = val;
                    updateVisualization(id, val);
                    if (channels.has(id)) {
                        channels.get(id).oscillator.frequency.setValueAtTime(val, audioContext.currentTime);
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º FM –¥–µ–≤–∏–∞—Ü–∏—é –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —á–∞—Å—Ç–æ—Ç—ã
                        if (fmEnabled && channels.get(id).fmGain) {
                            const deviation = val * (fmDepth / 100);
                            channels.get(id).fmGain.gain.value = deviation;
                        }
                    }
                }
            });

            freqRange.addEventListener('input', () => {
                const val = parseFloat(freqRange.value);
                freqNumber.value = val;
                updateVisualization(id, val);
                if (channels.has(id)) {
                    channels.get(id).oscillator.frequency.setValueAtTime(val, audioContext.currentTime);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º FM –¥–µ–≤–∏–∞—Ü–∏—é –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —á–∞—Å—Ç–æ—Ç—ã
                    if (fmEnabled && channels.get(id).fmGain) {
                        const deviation = val * (fmDepth / 100);
                        channels.get(id).fmGain.gain.value = deviation;
                    }
                }
            });

            phaseShift.addEventListener('input', () => {
                const deg = parseFloat(phaseShift.value);
                phaseValue.textContent = `${deg.toFixed(1)}¬∞`;
                if (channels.has(id)) {
                    const { oscillator, delayNode } = channels.get(id);
                    const freq = oscillator.frequency.value;
                    delayNode.delayTime.value = deg / (360 * freq);
                }
            });

            document.getElementById('frequencyControls').appendChild(div);
            updateDividers();

            const row = document.createElement('tr');
            row.dataset.id = id;
            document.getElementById('results').appendChild(row);
            updateVisualization(id, defaultFrequency);
            
            return id;
        }

        function removeFrequency(id) {
            document.querySelector(`.frequency-item[data-id="${id}"]`)?.remove();
            document.querySelector(`tr[data-id="${id}"]`)?.remove();
            if (channels.has(id)) {
                channels.get(id).oscillator.stop();
                channels.delete(id);
            }
            updateDividers();
        }

        function setWaveType(type) {
            currentWaveType = type;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫
            document.querySelectorAll('.wave-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`${type}Btn`).classList.add('active');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä—ã
            if (isPlaying) {
                channels.forEach(chain => {
                    chain.oscillator.type = type;
                });
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä—ã –ø—Ä–∏ –ø–µ—Ä–µ–±–æ—Ä–µ
            if (isFrequencyCycling) {
                currentPairOscillators.forEach(chain => {
                    chain.oscillator.type = type;
                });
            }
        }
        
        function togglePlayback() {
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–µ–±–æ—Ä –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –æ–±—ã—á–Ω–æ–≥–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
            if (isFrequencyCycling) {
                stopFrequencyCycle();
            }
            
            initAudio();
            isPlaying = !isPlaying;
            const toggleBtn = document.getElementById('toggleBtn');
            toggleBtn.textContent = isPlaying ? '–°—Ç–æ–ø' : '–°—Ç–∞—Ä—Ç';
            toggleBtn.classList.toggle('active', isPlaying);

            // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–Ω–æ–ø–æ–∫
            document.getElementById('addFrequency').disabled = isPlaying;
            document.getElementById('cycleFrequencies').disabled = isPlaying;
            toggleBtn.disabled = false;

            document.querySelectorAll('.frequency-item').forEach(item => {
                const id = item.dataset.id;
                const freq = parseFloat(item.querySelector('.freq-range').value);
                const pan = parseFloat(item.querySelector('.pan-selector').value);
                const deg = parseFloat(item.querySelector('.phase-shift').value);
                if (isPlaying) {
                    const chain = createOscillatorChain(freq, pan, deg);
                    channels.set(id, chain);
                    chain.oscillator.start();
                    
                    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∞–º–ø–ª–∏—Ç—É–¥—ã
                    const gainValue = 1 / Math.max(1, channels.size);
                    chain.gainNode.gain.value = gainValue;
                } else {
                    if (channels.has(id)) {
                        channels.get(id).oscillator.stop();
                        channels.delete(id);
                    }
                    // –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–Ω–æ–ø–æ–∫ –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ
                    document.getElementById('addFrequency').disabled = false;
                    document.getElementById('cycleFrequencies').disabled = false;
                }
            });
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–µ—Ä–µ–±–æ—Ä–∞ —á–∞—Å—Ç–æ—Ç
        function startFrequencyCycle() {
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—ã—á–Ω–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø–µ—Ä–µ–±–æ—Ä–∞
            if (isPlaying) {
                togglePlayback();
            }
            
            // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ —á–∞—Å—Ç–æ—Ç—ã
            const frequencyItems = document.querySelectorAll('.frequency-item');
            if (frequencyItems.length === 0) {
                alert('–î–æ–±–∞–≤—å—Ç–µ —á–∞—Å—Ç–æ—Ç—ã –¥–ª—è –ø–µ—Ä–µ–±–æ—Ä–∞');
                return;
            }
            
            // –§–æ—Ä–º–∏—Ä—É–µ–º –ø–∞—Ä—ã —á–∞—Å—Ç–æ—Ç
            frequencyPairs = [];
            const frequencies = [];
            
            frequencyItems.forEach(item => {
                const id = item.dataset.id;
                const freq = parseFloat(item.querySelector('.freq-range').value);
                const phaseShift = parseFloat(item.querySelector('.phase-shift').value);
                const pan = parseFloat(item.querySelector('.pan-selector').value);
                
                frequencies.push({ id, freq, phaseShift, pan });
            });
            
            // –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ –ø–∞—Ä—ã
            for (let i = 0; i < frequencies.length; i += 2) {
                const pair = frequencies.slice(i, i + 2);
                frequencyPairs.push(pair);
            }
            
            if (frequencyPairs.length === 0) return;
            
            // –í—ã—á–∏—Å–ª—è–µ–º –æ–±—â–µ–µ –≤—Ä–µ–º—è
            totalCycleTime = frequencyPairs.length * 3 * 60; // –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
            remainingTime = totalCycleTime;
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥
            isFrequencyCycling = true;
            const cycleBtn = document.getElementById('cycleFrequencies');
            cycleBtn.classList.add('active');
            cycleBtn.textContent = formatTime(remainingTime);
            
            // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–Ω–æ–ø–æ–∫
            document.getElementById('addFrequency').disabled = true;
            document.getElementById('toggleBtn').disabled = true;
            cycleBtn.disabled = false;
            
            // –ù–∞—á–∏–Ω–∞–µ–º —Å –ø–µ—Ä–≤–æ–π –ø–∞—Ä—ã
            currentPairIndex = 0;
            playFrequencyPair(frequencyPairs[currentPairIndex]);
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
            cycleInterval = setInterval(() => {
                stopCurrentPair();
                currentPairIndex++;
                
                if (currentPairIndex < frequencyPairs.length) {
                    playFrequencyPair(frequencyPairs[currentPairIndex]);
                } else {
                    stopFrequencyCycle();
                }
            }, 3 * 60 * 1000); // 3 –º–∏–Ω—É—Ç—ã
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –æ—Ç—Å—á–µ—Ç–∞
            countdownInterval = setInterval(() => {
                remainingTime--;
                cycleBtn.textContent = formatTime(remainingTime);
                
                if (remainingTime <= 0) {
                    clearInterval(countdownInterval);
                }
            }, 1000);
        }
        
        function stopFrequencyCycle() {
            clearInterval(cycleInterval);
            clearInterval(countdownInterval);
            stopCurrentPair();
            
            isFrequencyCycling = false;
            const cycleBtn = document.getElementById('cycleFrequencies');
            cycleBtn.classList.remove('active');
            cycleBtn.textContent = '–ø–µ—Ä–µ–±–æ—Ä —á–∞—Å—Ç–æ—Ç';
            
            // –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–Ω–æ–ø–æ–∫
            document.getElementById('addFrequency').disabled = false;
            document.getElementById('toggleBtn').disabled = false;
            cycleBtn.disabled = false;
        }
        
        function playFrequencyPair(pair) {
            initAudio();
            stopCurrentPair();
            
            currentPairOscillators = [];
            pair.forEach(freqItem => {
                const { freq, pan, phaseShift } = freqItem;
                const chain = createOscillatorChain(freq, pan, phaseShift);
                // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∞–º–ø–ª–∏—Ç—É–¥—ã –¥–ª—è –ø–∞—Ä—ã —á–∞—Å—Ç–æ—Ç
                chain.gainNode.gain.value = 0.5;
                chain.oscillator.start();
                currentPairOscillators.push(chain);
            });
        }
        
        function stopCurrentPair() {
            currentPairOscillators.forEach(chain => {
                try {
                    chain.oscillator.stop();
                    chain.oscillator.disconnect();
                    
                    // –û—Ç–∫–ª—é—á–∞–µ–º FM
                    if (chain.fmGain) {
                        chain.fmGain.disconnect();
                    }
                } catch (e) {
                    console.log("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä–∞", e);
                }
            });
            currentPairOscillators = [];
        }
        
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
        }
        
        // –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –ø—Ä–µ—Å–µ—Ç–æ–≤ –≤ CSV
        function exportPresets() {
            const fileName = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ (–±–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è)', 'frequency') || 'frequency';
            const fullFileName = `${fileName}.csv`;
            
            // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø—Ä–µ—Å–µ—Ç—ã
            const savedLists = getSavedFrequencyLists();
            
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ CSV —Ñ–æ—Ä–º–∞—Ç
            let csvContent = "preset_name,freq,phase,pan,fm_enabled,fm_freq,fm_depth\n";
            
            for (const [presetName, presetData] of Object.entries(savedLists)) {
                const fmEnabled = presetData.fm.enabled ? 1 : 0;
                const fmFreq = parseFloat(presetData.fm.freq).toFixed(6);
                const fmDepth = parseFloat(presetData.fm.depth).toFixed(3);
                
                presetData.frequencies.forEach(freqItem => {
                    const { freq, phaseShift, pan } = freqItem;
                    // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —á–∏—Å–ª–∞ –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
                    const formattedFreq = parseFloat(freq).toFixed(6);
                    const formattedPhase = parseFloat(phaseShift).toFixed(3);
                    const formattedPan = parseFloat(pan).toFixed(3);
                    
                    csvContent += `"${presetName}",${formattedFreq},${formattedPhase},${formattedPan},${fmEnabled},${fmFreq},${fmDepth}\n`;
                });
            }
            
            // –°–æ–∑–¥–∞–µ–º Blob –∏ —Å—Å—ã–ª–∫—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            
            link.setAttribute("href", url);
            link.setAttribute("download", fullFileName);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // –ò–º–ø–æ—Ä—Ç –ø—Ä–µ—Å–µ—Ç–æ–≤ –∏–∑ CSV
        function importPresets(file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const content = e.target.result;
                const lines = content.split('\n').filter(line => line.trim() !== '');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
                if (lines.length < 1 || !lines[0].includes('preset_name')) {
                    alert('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç CSV —Ñ–∞–π–ª–∞');
                    return;
                }
                
                // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç –¥–ª—è –Ω–æ–≤—ã—Ö –ø—Ä–µ—Å–µ—Ç–æ–≤
                const newPresets = {};
                
                // –ü–∞—Ä—Å–∏–º —Å—Ç—Ä–æ–∫–∏ –Ω–∞—á–∏–Ω–∞—è —Å 1 (–ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫)
                for (let i = 1; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (!line) continue;
                    
                    // –†–∞–∑–¥–µ–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è, —É—á–∏—Ç—ã–≤–∞—è –∫–∞–≤—ã—á–∫–∏
                    const values = line.split(',');
                    if (values.length < 7) continue;
                    
                    // –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                    const presetName = values[0].replace(/^"|"$/g, '');
                    const freq = parseFloat(values[1]);
                    const phase = parseFloat(values[2]);
                    const pan = parseFloat(values[3]);
                    const fmEnabled = parseInt(values[4]) === 1;
                    const fmFreq = parseFloat(values[5]);
                    const fmDepth = parseFloat(values[6]);
                    
                    // –°–æ–∑–¥–∞–µ–º –ø—Ä–µ—Å–µ—Ç –µ—Å–ª–∏ –µ–≥–æ –µ—â–µ –Ω–µ—Ç
                    if (!newPresets[presetName]) {
                        newPresets[presetName] = {
                            frequencies: [],
                            fm: { enabled: fmEnabled, freq: fmFreq, depth: fmDepth }
                        };
                    }
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º —á–∞—Å—Ç–æ—Ç—É –≤ –ø—Ä–µ—Å–µ—Ç
                    newPresets[presetName].frequencies.push({
                        freq: parseFloat(freq.toFixed(6)),
                        phaseShift: parseFloat(phase.toFixed(3)),
                        pan: parseFloat(pan.toFixed(3))
                    });
                }
                
                // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ –ø—Ä–µ—Å–µ—Ç—ã
                const savedLists = getSavedFrequencyLists();
                
                // –û–±—ä–µ–¥–∏–Ω—è–µ–º —Å –Ω–æ–≤—ã–º–∏ (–Ω–æ–≤—ã–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—é—Ç —Å—Ç–∞—Ä—ã–µ —Å —Ç–µ–º –∂–µ –∏–º–µ–Ω–µ–º)
                const mergedPresets = { ...savedLists, ...newPresets };
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ –ø—Ä–µ—Å–µ—Ç—ã
                saveFrequencyLists(mergedPresets);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                renderSavedLists();
                
                alert('–ü—Ä–µ—Å–µ—Ç—ã —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!');
            };
            
            reader.readAsText(file);
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
        function toggleInfo() {
            const content = document.getElementById('infoContent');
            content.style.display = content.style.display === 'block' ? 'none' : 'block';
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–µ—Å–µ—Ç–∞ –∏–∑ —Å—Ç—Ä–æ–∫–∏ —á–∞—Å—Ç–æ—Ç
        function savePresetFromString() {
            const input = document.getElementById('quickPresetInput').value.trim();
            if (!input) {
                alert('–í–≤–µ–¥–∏—Ç–µ —á–∞—Å—Ç–æ—Ç—ã');
                return;
            }

            // –†–∞–∑–¥–µ–ª—è–µ–º —Å—Ç—Ä–æ–∫—É –∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —á–∏—Å–ª–∞
            const freqStrings = input.split(/[,;]+/).map(s => s.trim()).filter(s => s);
            const frequencies = [];
            
            for (let i = 0; i < freqStrings.length; i++) {
                const num = parseFloat(freqStrings[i].replace(',', '.'));
                if (isNaN(num)) {
                    alert(`–ù–µ–≤–µ—Ä–Ω–æ–µ —á–∏—Å–ª–æ: ${freqStrings[i]}`);
                    return;
                }
                
                // –î–ª—è —á—ë—Ç–Ω—ã—Ö (–ø–æ –∏–Ω–¥–µ–∫—Å—É) —á–∞—Å—Ç–æ—Ç: –ª–µ–≤—ã–π –∫–∞–Ω–∞–ª, 0¬∞
                // –î–ª—è –Ω–µ—á—ë—Ç–Ω—ã—Ö: –ø—Ä–∞–≤—ã–π –∫–∞–Ω–∞–ª, 90¬∞
                frequencies.push({
                    freq: num,
                    phaseShift: i % 2 === 0 ? 0 : 90,
                    pan: i % 2 === 0 ? -1 : 1
                });
            }

            // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã FM –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            const fmParams = {
                enabled: false,
                freq: 0,
                depth: 0
            };

            // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –∏–º—è –¥–ª—è –ø—Ä–µ—Å–µ—Ç–∞
            const presetName = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ—Å–µ—Ç–∞:');
            if (!presetName) return;

            // –§–æ—Ä–º–∏—Ä—É–µ–º –æ–±—ä–µ–∫—Ç –ø—Ä–µ—Å–µ—Ç–∞
            const presetData = {
                frequencies,
                fm: fmParams
            };

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
            const savedLists = getSavedFrequencyLists();
            savedLists[presetName] = presetData;
            saveFrequencyLists(savedLists);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            renderSavedLists();
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
            document.getElementById('quickPresetInput').value = '';
            
            alert(`–ü—Ä–µ—Å–µ—Ç "${presetName}" —Å–æ—Ö—Ä–∞–Ω–µ–Ω!`);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –≤–≤–µ—Ä—Ö
        function initScrollTopButton() {
            const scrollBtn = document.getElementById('scrollToTopBtn');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å/—Å–∫—Ä—ã–≤–∞—Ç—å –∫–Ω–æ–ø–∫—É –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ
            window.addEventListener('scroll', () => {
                if (window.scrollY > 300) {
                    scrollBtn.style.display = 'block';
                } else {
                    scrollBtn.style.display = 'none';
                }
            });
            
            // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤–≤–µ—Ä—Ö –ø—Ä–∏ –∫–ª–∏–∫–µ
            scrollBtn.addEventListener('click', () => {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∞–∫–∫–æ—Ä–¥–µ–æ–Ω–∞
        function toggleAccordion(id) {
            const content = document.getElementById(id);
            const btn = content.previousElementSibling;
            
            if (content.style.display === 'block') {
                content.style.display = 'none';
                btn.classList.remove('expanded');
            } else {
                content.style.display = 'block';
                btn.classList.add('expanded');
            }
        }

        document.getElementById('addFrequency').addEventListener('click', () => {
            createFrequencyControl();
        });

        document.getElementById('toggleBtn').addEventListener('click', togglePlayback);

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–Ω–æ–ø–æ–∫ –≤–æ–ª–Ω
        document.getElementById('sineBtn').addEventListener('click', () => setWaveType('sine'));
        document.getElementById('squareBtn').addEventListener('click', () => setWaveType('square'));
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è FM
        document.getElementById('fmEnabled').addEventListener('change', updateFMParams);
        document.getElementById('fmFreq').addEventListener('input', updateFMParams);
        document.getElementById('fmDepth').addEventListener('input', updateFMParams);
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞
        document.getElementById('saveListBtn').addEventListener('click', showNamePrompt);
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–±–æ—Ä–∞ —á–∞—Å—Ç–æ—Ç
        document.getElementById('cycleFrequencies').addEventListener('click', () => {
            if (isFrequencyCycling) {
                stopFrequencyCycle();
            } else {
                startFrequencyCycle();
            }
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞/–∏–º–ø–æ—Ä—Ç–∞
        document.getElementById('exportBtn').addEventListener('click', exportPresets);
        document.getElementById('importBtn').addEventListener('click', () => {
            document.getElementById('csvFileInput').click();
        });
        document.getElementById('csvFileInput').addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                importPresets(e.target.files[0]);
                e.target.value = ''; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
            }
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –±—ã—Å—Ç—Ä–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–µ—Å–µ—Ç–∞
        document.getElementById('quickSaveBtn').addEventListener('click', savePresetFromString);

        function openModal() {
            document.getElementById('infoModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('infoModal').style.display = 'none';
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –æ–±–ª–∞—Å—Ç–∏
        window.onclick = function(event) {
            const modal = document.getElementById('infoModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
            
            const nameModal = document.getElementById('namePromptModal');
            if (event.target === nameModal) {
                nameModal.style.display = 'none';
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('DOMContentLoaded', () => {
            // –°–æ–∑–¥–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            createFrequencyControl(432);
            renderSavedLists();
            initScrollTopButton();
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –∞–∫–∫–æ—Ä–¥–µ–æ–Ω—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            document.getElementById('freqAccordion').style.display = 'block';
            document.getElementById('colorAccordion').style.display = 'block';
        });
    </script>
    <script>
        if('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/midi/sw.js', { scope: '/midi/' })
            .then(reg => console.log('SW registered'))
            .catch(err => console.error('SW error:', err));
        }
    </script>
</body>
</html>
