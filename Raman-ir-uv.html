<!DOCTYPE html>
<html lang="ru">
<head>
    <!--
  Copyright 2024 meweryk

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.

    Лицензировано под Apache License, Version 2.0 (далее "Лицензия");
  вы не можете использовать этот файл кроме как в соответствии с Лицензией.
  Вы можете получить копию Лицензии по адресу:

      http://www.apache.org/licenses/LICENSE-2.0

  Если это не требуется по применимому законодательству или не согласовано в письменной форме,
  программное обеспечение, распространяемое по Лицензии, распространяется на условиях "КАК ЕСТЬ",
  БЕЗ каких-либо гарантий или условий явных или подразумеваемых.
-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Спектральный конвертер</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #e0e0e0;
            padding: 15px;
            min-height: 100vh;
            line-height: 1.4;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            background: rgba(47, 79, 79, 0.8);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: #FFDEAD;
            font-size: 1.4rem;
            font-weight: 300;
            letter-spacing: 0.5px;
        }

        .form-group {
            margin-bottom: 12px;
        }

        label {
            display: block;
            margin-bottom: 4px;
            font-weight: 500;
            color: #a0a0c0;
            font-size: 0.9rem;
        }

        input[type="text"] {
            width: 100%;
            padding: 10px;
            background: rgba(30, 30, 45, 0.8);
            border: 1px solid rgba(100, 100, 150, 0.3);
            border-radius: 6px;
            font-size: 0.9rem;
            color: #e0e0e0;
            transition: all 0.3s ease;
        }

        input[type="text"]:focus {
            border-color: #64ffda;
            outline: none;
            box-shadow: 0 0 0 2px rgba(100, 255, 218, 0.2);
        }

        /* Адаптивные текстовые поля для спектров */
        .spectrum-input {
            width: 100%;
            min-height: 45px;
            padding: 10px;
            background: rgba(30, 30, 45, 0.8);
            border: 1px solid rgba(100, 100, 150, 0.3);
            border-radius: 6px;
            font-size: 0.9rem;
            color: #e0e0e0;
            transition: all 0.3s ease;
            resize: vertical;
            overflow-y: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            line-height: 1.4;
        }

        .spectrum-input:focus {
            border-color: #64ffda;
            outline: none;
            box-shadow: 0 0 0 2px rgba(100, 255, 218, 0.2);
        }

        .btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #64ffda 0%, #00bcd4 100%);
            color: #1a1a2e;
            border: none;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s ease;
            letter-spacing: 0.5px;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(100, 255, 218, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .info-btn {
            position: fixed;
            top: 15px;
            right: 15px;
            width: 36px;
            height: 36px;
            background: rgba(100, 255, 218, 0.9);
            color: #1a1a2e;
            border: none;
            border-radius: 50%;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .info-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(100, 255, 218, 0.4);
        }

        .result {
            margin-top: 20px;
            padding: 15px;
            background: rgba(20, 30, 40, 0.6);
            border-radius: 6px;
            border-left: 3px solid #64ffda;
        }

        .result h3 {
            color: #64ffda;
            font-size: 0.95rem;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .sound-data {
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.85rem;
            line-height: 1.4;
            background: rgba(10, 15, 25, 0.8);
            padding: 10px;
            border-radius: 4px;
            border: 1px solid rgba(100, 255, 218, 0.2);
            white-space: pre-wrap;
            word-wrap: break-word;
            color: #64ffda;
        }

        .database {
            margin-top: 25px;
            padding: 15px;
            background: rgba(20, 30, 40, 0.6);
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .database h3 {
            color: #64ffda;
            font-size: 0.95rem;
            margin-bottom: 12px;
            font-weight: 500;
        }

        .search-container {
            margin-bottom: 12px;
        }

        .search-input {
            width: 100%;
            padding: 8px 10px;
            background: rgba(20, 20, 35, 0.8);
            border: 1px solid rgba(100, 100, 150, 0.3);
            border-radius: 6px;
            font-size: 0.85rem;
            color: #e0e0e0;
        }

        .search-input:focus {
            border-color: #64ffda;
            outline: none;
            box-shadow: 0 0 0 2px rgba(100, 255, 218, 0.2);
        }

        .substance-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 8px;
            max-height: 180px;
            overflow-y: auto;
        }

        /* Контейнер для пары кнопок */
        .substance-pair {
            display: flex;
            gap: 0;
            border-radius: 4px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        /* Кнопка вещества */
        .substance-btn {
            flex: 1;
            padding: 8px 12px;
            background: rgba(40, 45, 70, 0.8);
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
            color: #e0e0e0;
            text-align: left;
            min-height: 35px;
            display: flex;
            align-items: center;
            border-radius: 4px 0 0 4px;
        }

        .substance-btn:hover {
            background: rgba(60, 65, 90, 0.9);
            transform: translateY(-1px);
        }

        /* Кнопка удаления */
        .delete-btn {
            padding: 8px 12px;
            background: rgba(255, 71, 87, 0.9);
            color: white;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
            font-weight: bold;
            min-width: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0 4px 4px 0;
        }

        .delete-btn:hover {
            background: rgba(255, 55, 66, 1);
            transform: translateY(-1px);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: linear-gradient(135deg, #1e1e2e 0%, #252536 100%);
            padding: 25px;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid rgba(100, 255, 218, 0.2);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
        }

        .modal h2 {
            color: #64ffda;
            margin-bottom: 15px;
            font-size: 1.2rem;
            font-weight: 500;
        }

        .modal p {
            margin-bottom: 10px;
            line-height: 1.5;
            font-size: 0.9rem;
            color: #c0c0d0;
        }

        .modal ul {
            margin-left: 20px;
            margin-bottom: 15px;
        }

        .modal li {
            margin-bottom: 5px;
            font-size: 0.9rem;
            color: #c0c0d0;
        }

        .close-btn {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 15px;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
        }
        
        footer { 
            text-align: center; 
            margin-top: 25px; 
            padding: 15px 0; 
            border-top: 1px solid rgba(255, 255, 255, 0.1); 
        }
        
        footer p { 
            margin: 4px 0; 
            font-size: 0.8rem;
            color: #a0a0c0;
        }
        
        footer a {
            color: #64ffda;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        footer a:hover {
            color: #00bcd4;
            text-decoration: underline;
        }
        
        .author { 
            margin-top: 12px; 
            color: #8888aa;
            font-size: 0.75rem;
        }

        /* Стилизация скроллбара */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(20, 20, 35, 0.5);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(100, 255, 218, 0.5);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(100, 255, 218, 0.7);
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 1.2rem;
            }
            
            input[type="text"] {
                padding: 8px;
                font-size: 0.85rem;
            }
            
            .spectrum-input {
                padding: 8px;
                font-size: 0.85rem;
                min-height: 40px;
            }
            
            .btn {
                padding: 10px;
                font-size: 0.85rem;
            }
            
            .substance-list {
                grid-template-columns: 1fr;
            }
            
            .substance-btn {
                padding: 6px 10px;
                font-size: 0.8rem;
            }
            
            .delete-btn {
                padding: 6px 10px;
                font-size: 0.8rem;
                min-width: 30px;
            }
            
            .info-btn {
                top: 10px;
                right: 10px;
                width: 32px;
                height: 32px;
                font-size: 14px;
            }
            
            .modal-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <button class="info-btn" onclick="showInfo()">i</button>

    <div class="container">
        <h1>Конвертер спектров в звук</h1>
        
        <div class="form-group">
            <label for="substance">Вещество:</label>
            <input type="text" id="substance" placeholder="Введите название вещества">
        </div>
        
        <div class="form-group">
            <label for="link">Ссылка:</label>
            <input type="text" id="link" placeholder="Введите ссылку">
        </div>
        
        <div class="form-group">
            <label for="raman">Спектры сдвиг Раман (см⁻¹):</label>
            <textarea class="spectrum-input" id="raman" placeholder="Формат: 656.346, 17; 648.494, 23" rows="1"></textarea>
        </div>
        
        <div class="form-group">
            <label for="ir">Спектры поглощения IR (см⁻¹):</label>
            <textarea class="spectrum-input" id="ir" placeholder="Формат: 400.200, 50; 500.800, 30" rows="1"></textarea>
        </div>
        
        <div class="form-group">
            <label for="uv">Спектры поглощения UV (см⁻¹):</label>
            <textarea class="spectrum-input" id="uv" placeholder="Формат: 700.400, 25; 800.900, 45" rows="1"></textarea>
        </div>
        
        <button class="btn" onclick="convertToSound()">Перевод в спектры звука</button>
        
        <div class="result" id="result" style="display: none;">
            <h3>Звуковые спектры (частота, громкость):</h3>
            <div class="sound-data" id="soundOutput"></div>
        </div>

        <div class="database" id="database" style="display: none;">
            <h3>База веществ:</h3>
            <div class="search-container">
                <input type="text" id="searchInput" class="search-input" placeholder="Найти вещество...">
            </div>
            <div class="substance-list" id="substanceList"></div>
        </div>
    </div>

    <div class="modal" id="infoModal">
        <div class="modal-content">
            <h2>Информация о программе</h2>
            <p><strong>Преобразование спектров вещества в низкочастотный ряд с перерасчётом громкости</strong></p>
            
            <p><strong>Правила записи в поля ввода:</strong></p>
            <ul>
                <li>Каждый спектр записывается в формате: <strong>спектр, интенсивность</strong></li>
                <li>Спектры разделяются точкой с запятой: <strong>;</strong></li>
                <li>Пример: <strong>656.346, 17; 648.494, 23; 317.594, 12</strong></li>
                <li>Если интенсивность не указана, она считается равной <strong>50</strong> единиц</li>
                <li>Десятичные дроби разделяются точкой: <strong>656.346</strong></li>
            </ul>
            
            <p><strong>Методика преобразования:</strong></p>
            <ul>
                <li>Спектры преобразуются в герцовый диапазон</li>
                <li>Интенсивности пересчитываются в проценты от общей суммы</li>
                <li>Сумма процентных интенсивностей по всем спектрам не превышает 100%</li>
            </ul>
            
            <button class="close-btn" onclick="hideInfo()">Закрыть</button>
        </div>
    </div>
    
    <footer>
    <p><a href="https://meweryk.github.io/midi/index.html">Генератор частот</a></p>
    <p><a href="https://meweryk.github.io/midi/calc_music.html">Анализ музыкального строя</a></p>
    <p class="author">Автор</p>
    </footer>

    <script>
        // Константы для расчета
        const SPEED_OF_LIGHT = 299792458; // м/с
        const CM_TO_HZ_FACTOR = 100 * SPEED_OF_LIGHT; // 29979245800
        const DIVISION_FACTOR = Math.pow(2, 37); // 137438953472
        const STORAGE_KEY = 'spectraDatabase';
        const DEFAULT_INTENSITY = 50;

        // Функция для автоподстройки высоты текстовых полей
        function autoResizeTextarea(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = (textarea.scrollHeight) + 'px';
        }

        // Функция для парсинга спектров с интенсивностями
        function parseSpectraWithIntensity(inputString) {
            if (!inputString.trim()) return { spectra: [], intensities: [] };
            
            const pairs = inputString.split(';')
                .map(pair => pair.trim())
                .filter(pair => pair !== '');
            
            const spectra = [];
            const intensities = [];
            
            pairs.forEach(pair => {
                const parts = pair.split(',');
                if (parts.length >= 1) {
                    const spectrum = parseFloat(parts[0].trim());
                    let intensity = DEFAULT_INTENSITY;
                    
                    if (parts.length >= 2 && parts[1].trim() !== '') {
                        intensity = parseFloat(parts[1].trim());
                    }
                    
                    if (!isNaN(spectrum)) {
                        spectra.push(spectrum);
                        intensities.push(isNaN(intensity) ? DEFAULT_INTENSITY : intensity);
                    }
                }
            });
            
            return { spectra, intensities };
        }

        // Функция для конвертации спектров в звук
        function convertSpectrumToSound(spectrumArray) {
            return spectrumArray.map(wavenumber => {
                const frequencyHz = wavenumber * CM_TO_HZ_FACTOR;
                return frequencyHz / DIVISION_FACTOR;
            });
        }

        // Функция для расчета процентных интенсивностей
        function calculatePercentageIntensities(allIntensities) {
            const totalIntensity = allIntensities.reduce((sum, intensity) => sum + intensity, 0);
            return allIntensities.map(intensity => (intensity / totalIntensity) * 100);
        }

        // Функция для форматирования чисел с точностью до 3 знаков
        function formatNumber(num) {
            return num.toFixed(3);
        }

        // Функция для отображения звуковых данных в новом формате
        function displaySoundData(soundData, percentageData) {
            const soundOutput = document.getElementById('soundOutput');
            let allOscillators = [];

            // Собираем все осцилляторы в один массив
            if (soundData.раман && soundData.раман.length > 0) {
                soundData.раман.forEach((freq, index) => {
                    allOscillators.push({
                        frequency: freq,
                        volume: percentageData.раман[index]
                    });
                });
            }

            if (soundData.ir && soundData.ir.length > 0) {
                soundData.ir.forEach((freq, index) => {
                    allOscillators.push({
                        frequency: freq,
                        volume: percentageData.ir[index]
                    });
                });
            }

            if (soundData.uv && soundData.uv.length > 0) {
                soundData.uv.forEach((freq, index) => {
                    allOscillators.push({
                        frequency: freq,
                        volume: percentageData.uv[index]
                    });
                });
            }

            // Формируем строку в требуемом формате
            const oscillatorsString = allOscillators.map(osc => 
                `${formatNumber(osc.frequency)}, ${formatNumber(osc.volume)}`
            ).join('; ');

            soundOutput.textContent = oscillatorsString || 'Нет данных для отображения';
        }

        // Функция для сохранения в localStorage
        function saveToLocalStorage(data) {
            let database = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
            database[data.вещество] = data;
            localStorage.setItem(STORAGE_KEY, JSON.stringify(database));
        }

        // Функция для удаления вещества из localStorage
        function deleteSubstance(substanceName) {
            if (confirm(`Вы уверены, что хотите удалить вещество "${substanceName}"?`)) {
                let database = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
                delete database[substanceName];
                localStorage.setItem(STORAGE_KEY, JSON.stringify(database));
                loadSubstanceDatabase(); // Перезагружаем базу
            }
        }

        // Функция для фильтрации веществ
        function filterSubstances() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const substancePairs = document.querySelectorAll('.substance-pair');
            
            substancePairs.forEach(pair => {
                const substanceName = pair.querySelector('.substance-btn').textContent.toLowerCase();
                if (substanceName.includes(searchTerm)) {
                    pair.style.display = 'flex';
                } else {
                    pair.style.display = 'none';
                }
            });
        }

        // Функция для загрузки базы веществ
        function loadSubstanceDatabase() {
            const database = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
            const substanceList = document.getElementById('substanceList');
            const searchInput = document.getElementById('searchInput');
            
            if (Object.keys(database).length === 0) {
                document.getElementById('database').style.display = 'none';
                return;
            }

            substanceList.innerHTML = '';
            const substances = Object.keys(database).sort();
            
            substances.forEach(substance => {
                // Создаем контейнер для пары кнопок
                const pairContainer = document.createElement('div');
                pairContainer.className = 'substance-pair';
                
                // Кнопка вещества
                const substanceBtn = document.createElement('button');
                substanceBtn.className = 'substance-btn';
                substanceBtn.textContent = substance;
                substanceBtn.title = `Загрузить данные для ${substance}`;
                substanceBtn.onclick = () => loadSubstanceData(database[substance]);
                
                // Кнопка удаления
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-btn';
                deleteBtn.textContent = '×';
                deleteBtn.title = `Удалить ${substance}`;
                deleteBtn.onclick = () => deleteSubstance(substance);
                
                // Добавляем кнопки в контейнер
                pairContainer.appendChild(substanceBtn);
                pairContainer.appendChild(deleteBtn);
                substanceList.appendChild(pairContainer);
            });

            // Сбрасываем поле поиска и показываем базу
            searchInput.value = '';
            document.getElementById('database').style.display = 'block';
        }

        // Функция для загрузки данных вещества в форму
        function loadSubstanceData(data) {
            document.getElementById('substance').value = data.вещество || '';
            document.getElementById('link').value = data.ссылка || '';
            
            // Восстанавливаем данные в формате для полей ввода
            if (data.спектры?.раман && data.интенсивности?.раман) {
                const ramanText = data.спектры.раман.map((spectrum, index) => 
                    `${spectrum}, ${data.интенсивности.раман[index]}`
                ).join('; ');
                document.getElementById('raman').value = ramanText;
                autoResizeTextarea(document.getElementById('raman'));
            } else {
                document.getElementById('raman').value = '';
                autoResizeTextarea(document.getElementById('raman'));
            }
            
            if (data.спектры?.ir && data.интенсивности?.ir) {
                const irText = data.спектры.ir.map((spectrum, index) => 
                    `${spectrum}, ${data.интенсивности.ir[index]}`
                ).join('; ');
                document.getElementById('ir').value = irText;
                autoResizeTextarea(document.getElementById('ir'));
            } else {
                document.getElementById('ir').value = '';
                autoResizeTextarea(document.getElementById('ir'));
            }
            
            if (data.спектры?.uv && data.интенсивности?.uv) {
                const uvText = data.спектры.uv.map((spectrum, index) => 
                    `${spectrum}, ${data.интенсивности.uv[index]}`
                ).join('; ');
                document.getElementById('uv').value = uvText;
                autoResizeTextarea(document.getElementById('uv'));
            } else {
                document.getElementById('uv').value = '';
                autoResizeTextarea(document.getElementById('uv'));
            }
            
            // Показываем звуковые данные если они есть
            if (data.звук && data.процентныеИнтенсивности) {
                displaySoundData(data.звук, data.процентныеИнтенсивности);
                document.getElementById('result').style.display = 'block';
            } else {
                document.getElementById('result').style.display = 'none';
            }
        }

        // Основная функция конвертации
        function convertToSound() {
            const substance = document.getElementById('substance').value.trim();
            const link = document.getElementById('link').value.trim();
            const ramanInput = document.getElementById('raman').value;
            const irInput = document.getElementById('ir').value;
            const uvInput = document.getElementById('uv').value;

            if (!substance) {
                alert('Пожалуйста, введите название вещества');
                return;
            }

            // Парсим данные с интенсивностями
            const ramanData = parseSpectraWithIntensity(ramanInput);
            const irData = parseSpectraWithIntensity(irInput);
            const uvData = parseSpectraWithIntensity(uvInput);

            // Собираем все интенсивности для расчета процентов
            const allIntensities = [
                ...ramanData.intensities,
                ...irData.intensities,
                ...uvData.intensities
            ];

            if (allIntensities.length === 0) {
                alert('Пожалуйста, введите хотя бы один спектр');
                return;
            }

            // Рассчитываем процентные интенсивности
            const percentageIntensities = calculatePercentageIntensities(allIntensities);
            
            // Распределяем проценты по типам спектров
            let currentIndex = 0;
            const percentageData = {
                раман: percentageIntensities.slice(currentIndex, currentIndex + ramanData.intensities.length)
            };
            currentIndex += ramanData.intensities.length;
            
            percentageData.ir = percentageIntensities.slice(currentIndex, currentIndex + irData.intensities.length);
            currentIndex += irData.intensities.length;
            
            percentageData.uv = percentageIntensities.slice(currentIndex, currentIndex + uvData.intensities.length);

            const substanceData = {
                вещество: substance,
                ссылка: link || '',
                спектры: {
                    раман: ramanData.spectra,
                    ir: irData.spectra,
                    uv: uvData.spectra
                },
                интенсивности: {
                    раман: ramanData.intensities,
                    ir: irData.intensities,
                    uv: uvData.intensities
                },
                звук: {},
                процентныеИнтенсивности: percentageData
            };

            // Конвертируем спектры в звук
            if (ramanData.spectra.length > 0) {
                substanceData.звук.раман = convertSpectrumToSound(ramanData.spectra);
            }

            if (irData.spectra.length > 0) {
                substanceData.звук.ir = convertSpectrumToSound(irData.spectra);
            }

            if (uvData.spectra.length > 0) {
                substanceData.звук.uv = convertSpectrumToSound(uvData.spectra);
            }

            // Сохраняем в localStorage
            saveToLocalStorage(substanceData);
            
            // Показываем звуковые данные
            displaySoundData(substanceData.звук, percentageData);
            document.getElementById('result').style.display = 'block';
            
            // Обновляем базу веществ
            loadSubstanceDatabase();
        }

        // Функции для модального окна
        function showInfo() {
            document.getElementById('infoModal').style.display = 'flex';
        }

        function hideInfo() {
            document.getElementById('infoModal').style.display = 'none';
        }

        // Закрытие модального окна по клику вне его
        window.onclick = function(event) {
            const modal = document.getElementById('infoModal');
            if (event.target === modal) {
                hideInfo();
            }
        }

        // Инициализация при загрузке страницы
        document.addEventListener('DOMContentLoaded', function() {
            loadSubstanceDatabase();
            
            // Добавляем обработчики для автоподстройки высоты текстовых полей
            const spectrumInputs = document.querySelectorAll('.spectrum-input');
            spectrumInputs.forEach(input => {
                // Инициализация высоты при загрузке
                autoResizeTextarea(input);
                
                // Обработчик изменения содержимого
                input.addEventListener('input', function() {
                    autoResizeTextarea(this);
                    document.getElementById('result').style.display = 'none';
                });
            });
            
            const regularInputs = document.querySelectorAll('input[type="text"]');
            regularInputs.forEach(input => {
                input.addEventListener('input', function() {
                    document.getElementById('result').style.display = 'none';
                });
            });
            
            // Добавляем обработчик для поля поиска
            document.getElementById('searchInput').addEventListener('input', filterSubstances);
        });
    </script>
</body>
</html>
